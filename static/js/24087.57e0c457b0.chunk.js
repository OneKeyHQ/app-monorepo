"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[24087],{593827:(e,r,t)=>{t.d(r,{L:()=>WalletAvatar});var n=t(503668),a=t.n(n),o=t(490343),s=t(491180),i=t(258988),l=t(831085);function WalletAvatarBase({size:e,img:r,wallet:t}){var n,a,d=r||t?.avatarInfo?.img;return d?s.A.isHwHiddenWallet({wallet:t})?(0,l.jsx)(o.Icon,{size:"$10",name:"LockSolid",color:"$iconSubdued"}):(0,l.jsxs)(o.Image,{size:e,children:[(0,l.jsx)(o.Image.Source,{source:null!=(n=i.UO[d])?n:i.UO.bear}),(0,l.jsx)(o.Image.Fallback,{delayMs:300,justifyContent:"center",alignItems:"center",children:(0,l.jsx)(o.SizableText,{children:null!=(a=t?.avatarInfo?.emoji)?a:""})})]}):null}function WalletAvatar({size:e="$10",status:r,badge:t,img:n,wallet:s}){return(0,l.jsxs)(o.Stack,{w:e,h:e,justifyContent:"center",alignItems:"center",children:[(0,l.jsx)(WalletAvatarBase,{size:e,img:n,wallet:s}),"connected"===r?(0,l.jsx)(o.Stack,{position:"absolute",bottom:-2,right:-2,bg:"$bgSidebar",p:"$0.5",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(o.Stack,{borderRadius:"$full",w:"$2.5",h:"$2.5",bg:"$bgSuccessStrong"})}):null,a()(t)?null:(0,l.jsx)(o.Stack,{position:"absolute",h:"$4",px:"$0.5",justifyContent:"center",bottom:-2,right:-1,bg:"$bgSubdued",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(o.SizableText,{size:"$bodySm",textAlign:"center",children:t})})]})}},326745:(e,r,t)=>{t.d(r,{u:()=>useAppRoute});var n=t(654266);function useAppRoute(){return(0,n.lq)()}},973066:(e,r,t)=>{t.d(r,{i:()=>FirmwareChangeLogContentView,z:()=>FirmwareChangeLogView});var n=t(586330),a=t(514041),o=t(908867),s=t(490343),i=t(610421),l=t(259227),d=t(334439),u=t(773831),c=t(225555),g=t(355422),p=t(443791),f=t(831085);function ChangeLogMarkdown({changelog:e}){var[{locale:r}]=(0,l.useSettingsPersistAtom)(),[t,o]=(0,a.useState)(r);return(0,a.useEffect)((function(){(0,n.A)((function*(){"system"===r&&o(yield i.A.serviceSetting.getCurrentLocale())}))()}),[r]),(0,f.jsx)(s.Markdown,{children:e?.["zh-CN"===t?"zh-CN":"en-US"]||"No change log found."})}function ChangeLogSection({title:e,icon:r,isDone:t,updateInfo:n}){var i=(0,o.A)(),[l,u]=(0,a.useState)(t),c=(0,a.useCallback)((function(){u(!l)}),[l]);return(0,f.jsxs)(s.Stack,{children:[(0,f.jsxs)(s.XStack,{gap:"$3",py:"$2",ai:"center",onPress:c,children:[(0,f.jsx)(s.Icon,{name:r,size:"$5"}),(0,f.jsxs)(s.Stack,{flex:1,children:[(0,f.jsx)(s.SizableText,{size:"$bodyLgMedium",children:e}),(0,f.jsx)(s.SizableText,{size:"$bodyMd",color:t?"$textSubdued":"$textInfo",children:t?i.formatMessage({id:d.ETranslations.update_updated_to_latest_version},{version:n?.toVersion||i.formatMessage({id:d.ETranslations.global_unknown})}):i.formatMessage({id:d.ETranslations.global_version_is_available},{version:n?.toVersion||i.formatMessage({id:d.ETranslations.global_unknown})})})]}),(0,f.jsx)(s.IconButton,{icon:l?"ChevronDownSmallOutline":"ChevronTopSmallOutline",variant:"tertiary",onPress:c})]}),l?null:(0,f.jsxs)(s.Stack,{bg:"$bgStrong",p:"$5",borderRadius:"$3",children:[(0,f.jsx)(p.Y,{fromVersion:n?.fromVersion,toVersion:n?.toVersion}),(0,f.jsx)(ChangeLogMarkdown,{changelog:n?.changelog})]})]})}function FirmwareChangeLogContentView({result:e,isDone:r}){var t=(0,o.A)();return(0,f.jsxs)(s.Stack,{mt:"$8",children:[e?.updateInfos?.bootloader?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:d.ETranslations.global_bootloader}),icon:"StorageOutline",updateInfo:e?.updateInfos?.bootloader,isDone:r}):null,e?.updateInfos?.ble?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:d.ETranslations.global_bluetooth}),icon:"BluetoothOutline",updateInfo:e?.updateInfos?.ble,isDone:r}):null,e?.updateInfos?.firmware?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:d.ETranslations.global_firmware}),icon:"LaunchOutline",updateInfo:e?.updateInfos?.firmware,isDone:r}):null]})}function FirmwareChangeLogView({result:e}){var r=(0,o.A)(),[,t]=(0,l.useFirmwareUpdateStepInfoAtom)(),{showCheckList:n}=(0,u.B)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(c.nv,{onConfirmText:r.formatMessage({id:d.ETranslations.update_update_now}),onConfirm:function(){t({step:l.EFirmwareUpdateSteps.showCheckList,payload:void 0}),n({result:e})}}),(0,f.jsxs)(s.Stack,{children:[(0,f.jsx)(g.N,{result:e}),(0,f.jsx)(FirmwareChangeLogContentView,{result:e})]})]})}},88569:(e,r,t)=>{t.d(r,{m:()=>FirmwareInstallingView,V:()=>FirmwareInstallingViewBase});var n=t(514041),a=t(490343),o=t(259227),s=t(908867),i=t(334439),l=t(773831),d=t(973066),u=t(723337),c=t(225555),g=t(831085);function FirmwareUpdateDone({result:e}){var r=(0,s.A)(),t=(0,l.B)();return(0,g.jsxs)(a.Stack,{children:[(0,g.jsx)(u.u,{icon:"CheckRadioSolid",tone:"success",title:r.formatMessage({id:i.ETranslations.update_all_updates_complete})}),(0,g.jsx)(d.i,{result:e,isDone:!0}),(0,g.jsx)(c.nv,{onConfirmText:r.formatMessage({id:i.ETranslations.global_got_it}),onConfirm:function(){t.closeUpdateModal()}})]})}var p=t(853748),f=t(99202),m=t(355422);function FirmwareInstallingViewBase({result:e,isDone:r,tipMessage:t,retryInfo:o,progressBarKey:s}){(0,g.jsx)(m.N,{result:e});var i=(0,n.useMemo)((function(){return r?(0,g.jsx)(FirmwareUpdateDone,{result:e}):o?(0,g.jsx)(p.uH.InstallingErrors,{retryInfo:o,result:e,lastFirmwareTipMessage:t}):(0,g.jsx)(f.D,{lastFirmwareTipMessage:t,isDone:r},s)}),[r,s,e,o,t]);return(0,g.jsx)(a.Stack,{children:i})}function FirmwareInstallingView({result:e,isDone:r}){var[t]=(0,o.useFirmwareUpdateStepInfoAtom)(),[a]=(0,o.useFirmwareUpdateRetryAtom)(),[s]=(0,o.useHardwareUiStateAtom)(),i=(0,n.useRef)(0);t.step===o.EFirmwareUpdateSteps.updateStart&&(i.current=t.payload.startAtTime);var l=s?.payload?.firmwareTipData?.message,[d,u]=(0,n.useState)();return(0,n.useEffect)((function(){l&&u(l)}),[l]),(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(FirmwareInstallingViewBase,{result:e,isDone:r,tipMessage:d,retryInfo:a,progressBarKey:i.current})})}},411252:(e,r,t)=>{t.d(r,{p:()=>FirmwareLatestVersionInstalled});var n=t(908867),a=t(490343),o=t(334439),s=t(831085);function FirmwareLatestVersionInstalled(){var e=(0,n.A)();return(0,s.jsxs)(a.Stack,{ai:"center",jc:"center",h:500,children:[(0,s.jsx)(a.Icon,{size:"$14",name:"CheckRadioSolid",color:"$iconSuccess"}),(0,s.jsx)(a.SizableText,{my:"$6",size:"$headingLg",children:e.formatMessage({id:o.ETranslations.update_latest_version})})]})}},723337:(e,r,t)=>{t.d(r,{u:()=>FirmwareUpdateBaseMessageView});var n=t(514041),a=t(908867),o=t(490343),s=t(726130),i=t(334439),l=(t(663522),t(831085)),getColors=function(e){switch(e){case"destructive":return{iconWrapperBg:"$bgCritical",iconColor:"$iconCritical"};case"warning":return{iconWrapperBg:"$bgCaution",iconColor:"$iconCaution"};case"success":return{iconWrapperBg:"$bgSuccess",iconColor:"$iconSuccess"};default:return{iconWrapperBg:"$bgStrong",iconColor:"$icon"}}};function UpdateErrorTroubleshooting(){var e,r=(0,a.A)();e=i.ETranslations.update_troubleshoot_connection_issues;var t=r.formatMessage({id:e,defaultMessage:"If you have any questions, please refer to the troubleshooting guide."}).split("\n");return(0,l.jsx)(o.Stack,{children:t.map((function(e,r){return e.includes("<url>")?(0,l.jsx)(o.RichSizeableText,{size:"$bodyMd",color:"$textSubdued",linkList:{url:{url:s.ks}},children:e},r):(0,l.jsx)(o.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e},r)}))})}function FirmwareUpdateBaseMessageView({icon:e,title:r,tone:t,message:a,linkList:s,displayTroubleshooting:i}){var d=(0,n.useCallback)((function(){return e?.endsWith("Solid")?(0,l.jsx)(o.Icon,{name:e,size:"$14",color:getColors(t).iconColor}):(0,l.jsx)(o.Stack,{alignSelf:"flex-start",p:"$3",borderRadius:"$full",bg:getColors(t).iconWrapperBg,children:(0,l.jsx)(o.Icon,{name:e,size:"$7",color:getColors(t).iconColor})})}),[e,t]);return(0,l.jsxs)(o.Stack,{py:"$6",gap:"$5",children:[(0,l.jsxs)(o.Stack,{children:[e?d():null,r?(0,l.jsx)(o.SizableText,{my:"$4",size:"$heading2xl",children:r}):null,a?(0,l.jsx)(o.RichSizeableText,{size:"$bodyLg",color:"$textSubdued",linkList:s,children:a}):null]}),i?(0,l.jsx)(UpdateErrorTroubleshooting,{}):null]})}},853748:(e,r,t)=>{t.d(r,{_V:()=>EnterBootModeGuide,uH:()=>h,RH:()=>useFirmwareUpdateErrors});var n=t(586330),a=t(514041),o=t(813362),s=t(908867),i=t(490343),l=t(259227),d=t(726130),u=t(319357),c=t(514527),g=t(334439),p=t(117746),f=t(100645),m=t(610421);const w=t.p+"static/media/enter-boot-guide-mini.e82812de54d81a27fd02.png";var _=t(723337),x=t(225555),v=t(831085);function CommonError({message:e,title:r,icon:t,displayTroubleshooting:n}){var a=(0,s.A)();return(0,v.jsx)(_.u,{icon:t,tone:"destructive",title:r||a.formatMessage({id:g.ETranslations.global_an_error_occurred}),message:e,displayTroubleshooting:n})}function ShouldUpdateBridge({result:e}){var r=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(_.u,{icon:"InfoCircleOutline",title:r.formatMessage({id:g.ETranslations.update_outdated_version_detected}),message:r.formatMessage({id:g.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:d.F3}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,p.Dr)(d.F3)},onConfirmText:r.formatMessage({id:g.ETranslations.global_view_tutorial})})]})}function ShouldUpdateByWeb(){var e=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(_.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:g.ETranslations.update_update_in_official_web_tool}),message:e.formatMessage({id:g.ETranslations.update_update_in_official_web_tool_desc}),linkList:{url:{url:d.BZ}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,p.Dr)(d.BZ)},onConfirmText:e.formatMessage({id:g.ETranslations.global_visit_website})})]})}function HowToUpdateFullResource(){var e=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(_.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:g.ETranslations.update_outdated_version_detected}),message:e.formatMessage({id:g.ETranslations.update_outdated_version_detected_desc}),linkList:{url:{url:d.Kj}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,p.Dr)(d.Kj)},onConfirmText:e.formatMessage({id:g.ETranslations.global_view_tutorial})})]})}function EnterBootModeGuide({deviceType:e}){var r=(0,s.A)();return"mini"===e?(0,v.jsxs)(i.Stack,{mb:"$6",children:[(0,v.jsx)(i.Image,{w:353,h:224,source:w}),(0,v.jsx)(i.SizableText,{size:"$headingMd",children:r.formatMessage({id:g.ETranslations.update_manually_entering_bootloader_mode})}),(0,v.jsx)(i.SizableText,{mt:"$2",color:"$textSubdued",children:r.formatMessage({id:g.ETranslations.update_manually_entering_bootloader_mode_desc})})]}):(0,v.jsx)(i.Stack,{mb:"$6",children:(0,v.jsx)(i.RichSizeableText,{mt:"$2",linkList:{url:{url:d.zz}},children:g.ETranslations.update_follow_online_tutorial_to_proceed_manually})})}function useFirmwareUpdateErrors({error:e,onRetry:r,result:t,lastFirmwareTipMessage:n}){var i=(0,s.A)(),l=i.formatMessage({id:g.ETranslations.global_retry});return(0,a.useMemo)((function(){if((0,c.R4)({error:e,code:[o.HardwareErrorCode.PinCancelled,o.HardwareErrorCode.ActionCancelled,o.HardwareErrorCode.DeviceInterruptedFromOutside]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:g.ETranslations.update_operation_canceled}),message:i.formatMessage({id:g.ETranslations.update_operation_canceled_desc})}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateDownloadFailed}))return{content:(0,v.jsx)(CommonError,{icon:"DownloadOutline",title:i.formatMessage({id:g.ETranslations.update_download_failed}),message:i.formatMessage({id:g.ETranslations.update_check_connection_try_again})}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:o.HardwareErrorCode.PinInvalid}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",message:i.formatMessage({id:g.ETranslations.hardware_invalid_pin_error})}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot})||(0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure})||e&&n===f.rn.AutoRebootToBootloader)return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:g.ETranslations.update_manually_entering_bootloader_mode})}),detail:(0,v.jsx)(EnterBootModeGuide,{deviceType:t?.deviceType}),onRetryHandler:r,retryText:"mini"===t?.deviceType?i.formatMessage({id:g.ETranslations.update_verify_status_and_continue}):l};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeNetworkError]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:g.ETranslations.update_bridge_network_error}),message:i.formatMessage({id:g.ETranslations.update_unable_to_connect_to_bridge})}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeTimeoutError]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:g.ETranslations.update_bridge_timeout_error}),message:i.formatMessage({id:g.ETranslations.update_connection_to_bridge_timed_out})}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeNotInstalled,u.o.NeedOneKeyBridge]}))return{content:(0,v.jsx)(_.u,{icon:"CrossedLargeOutline",tone:"destructive",title:i.formatMessage({id:g.ETranslations.update_bridge_not_installed}),message:i.formatMessage({id:g.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:d.F3}}}),onRetryHandler:r,retryText:l};if((0,c.R4)({error:e,code:u.o.NeedOneKeyBridgeUpgrade}))return{content:(0,v.jsx)(ShouldUpdateBridge,{result:t}),retryText:l};if((0,c.R4)({error:e,code:u.o.NeedFirmwareUpgradeFromWeb}))return{content:(0,v.jsx)(ShouldUpdateByWeb,{}),retryText:l};if((0,c.R4)({error:e,code:o.HardwareErrorCode.UseDesktopToUpdateFirmware}))return{content:(0,v.jsx)(HowToUpdateFullResource,{}),retryText:l};if(e){var a=e?.message;return 4500===e.code&&(a=i.formatMessage({id:g.ETranslations.feedback_hw_polling_time_out})),{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",message:a,displayTroubleshooting:!0}),onRetryHandler:r,retryText:l}}return{content:null,retryText:l}}),[i,e,n,l,r,t])}var h={ShouldUpdateBridge,CommonError,EnterBootModeGuide,WorkflowErrors:function WorkflowErrors({onRetry:e,error:r,result:t}){var n=(0,s.A)(),{onRetryHandler:a,content:o,retryText:i}=useFirmwareUpdateErrors({error:r,onRetry:e,result:t,lastFirmwareTipMessage:void 0});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(x.nv,{onConfirm:a,onConfirmText:i||n.formatMessage({id:g.ETranslations.global_retry})}),o]})},InstallingErrors:function InstallingErrors({retryInfo:e,result:r,lastFirmwareTipMessage:t}){var o=(0,s.A)(),[,i]=(0,l.useFirmwareUpdateStepInfoAtom)(),d=(0,a.useCallback)((0,n.A)((function*(){if(!e)return null;i({step:l.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),yield m.A.serviceFirmwareUpdate.retryUpdateTask({id:e?.id,connectId:r?.updatingConnectId,releaseResult:r})})),[r,e,i]),{content:u,detail:c,onRetryHandler:p,retryText:f}=useFirmwareUpdateErrors({onRetry:d,result:r,lastFirmwareTipMessage:t,error:e?.error});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(x.nv,{onConfirm:p,onConfirmText:f||o.formatMessage({id:g.ETranslations.global_retry})}),u,c]})}}},336293:(e,r,t)=>{t.d(r,{X:()=>FirmwareUpdateExitPrevent,U:()=>ForceExtensionUpdatingFromExpandTab});var n=t(334025),a=t(908867),o=t(334439),s=t(514041),i=t(355931),l=t(493360),d=t(490343),u=t(663522),c=t(498356),g=t(326745),p=t(773831),f=!1;function ForceExtensionUpdatingFromExpandTab(){return function useExtensionUpdatingFromExpandTab(){var e=(0,g.u)(),r=(0,p.B)();(0,s.useEffect)((function(){u.Ay.isExtensionUiPopup&&(r.openChangeLogOfExtension(e.params),window.close())}),[r,e.params])}(),null}function FirmwareUpdateExitPrevent({shouldPreventRemove:e=!0}){var r=(0,a.A)(),t=r.formatMessage({id:o.ETranslations.update_quit_update}),g=r.formatMessage({id:o.ETranslations.update_quit_update_desc});return(0,n.Wg)(),function useModalExitPrevent({title:e,message:r,shouldPreventRemove:t=!0}){var n=(0,a.A)(),i=(0,c.A)(),l=(0,s.useCallback)((function({data:t}){f||(f=!0,d.Dialog.show({title:e,description:r,onConfirmText:n.formatMessage({id:o.ETranslations.global_quit}),onConfirm:function(){i.dispatch(t.action)},onCancelText:n.formatMessage({id:o.ETranslations.global_cancel}),onClose:function(){f=!1}}))}),[r,i,e,n]);(0,d.usePreventRemove)(t,l)}({shouldPreventRemove:e,title:t,message:g}),function useAppExitPrevent({message:e,title:r,shouldPreventExitOnAndroid:t=!0}){var n=(0,a.A)();(0,s.useEffect)((function(){if(u.Ay.isRuntimeBrowser&&!u.Ay.isExtensionUiPopup){var fn=function(r){return r.preventDefault(),r.returnValue=!0,e};return window.addEventListener("beforeunload",fn),function(){window.removeEventListener("beforeunload",fn)}}}),[e]),(0,s.useEffect)((function(){if(t){var a=l.A.addEventListener("hardwareBackPress",(function(){return i.A.alert(r,e,[{text:n.formatMessage({id:o.ETranslations.global_cancel}),onPress:function(){},style:"cancel"},{text:n.formatMessage({id:o.ETranslations.global_quit}),onPress:function(){return l.A.exitApp()}}],{cancelable:!1}),!0}));return function(){return a.remove()}}}),[e,r,n,t])}({title:t,message:g,shouldPreventExitOnAndroid:!1}),null}},225555:(e,r,t)=>{t.d(r,{nv:()=>l,oh:()=>FirmwareUpdatePageLayout});var n=t(908867),a=t(490343),o=t(334439),s=t(498356),i=t(831085);function FirmwareUpdatePageHeader(){var e=(0,n.A)();return(0,i.jsx)(a.Page.Header,{dismissOnOverlayPress:!1,title:e.formatMessage({id:o.ETranslations.update_hardware_update})})}var l=a.Page.Footer;function FirmwareUpdatePageLayout({children:e}){(0,s.A)();return(0,i.jsxs)(a.Stack,{children:[(0,i.jsx)(FirmwareUpdatePageHeader,{}),(0,i.jsx)(a.Page.Body,{children:(0,i.jsx)(a.Stack,{p:"$5",children:e})})]})}},99202:(e,r,t)=>{t.d(r,{D:()=>FirmwareUpdateProgressBar,w:()=>FirmwareUpdateProgressBarView});var n=t(460986),a=t.n(n),o=t(514041),s=t(908867),i=t(490343),l=t(259227),d=t(334439),u=t(284908),c=t(100645),g=t(610421),p=t(394764),f=t(443791),m=t(831085),w=10;function FirmwareUpdateProgressBarView({totalStep:e,currentStep:r,title:t,fromVersion:n,toVersion:a,progress:l,desc:u}){var c=(0,s.A)(),g=(0,o.useMemo)((function(){return e&&r?e<=1?null:(0,m.jsx)(i.SizableText,{size:"$bodyMd",color:"$textSubdued",children:c.formatMessage({id:d.ETranslations.global_step_str},{step:`${r}/${e}`})}):(0,m.jsx)(i.Skeleton,{width:120,height:16})}),[c,r,e]),p=(0,o.useMemo)((function(){return a?(0,m.jsx)(f.Y,{fromVersion:n,toVersion:a}):(0,m.jsx)(i.Skeleton,{width:80,height:16})}),[n,a]);return(0,m.jsxs)(i.Stack,{py:"$6",children:[g,(0,m.jsx)(i.SizableText,{size:"$heading2xl",my:"$3",children:t}),p,(0,m.jsx)(i.Stack,{mt:"$12",mb:"$3",children:(0,m.jsx)(i.Progress,{size:"medium",value:l})}),(0,m.jsx)(i.SizableText,{size:"$bodyLg",color:"$textSubdued",children:u})]})}function FirmwareUpdateProgressBar({lastFirmwareTipMessage:e,isDone:r}){var t=(0,s.A)(),[n]=(0,l.useFirmwareUpdateStepInfoAtom)(),[f]=(0,l.useHardwareUiStateAtom)(),[_]=(0,l.useHardwareUiStateCompletedAtom)(),[x,v]=(0,o.useState)(1),[h]=(0,l.useFirmwareUpdateRetryAtom)(),E=(0,o.useRef)(x);E.current=x;var T=(0,o.useRef)(w),b=(0,o.useCallback)((function(){return t.formatMessage({id:d.ETranslations.global_checking_device})}),[t]),[y,S]=(0,o.useState)(b()),j=(0,o.useMemo)((function(){if(n?.step===l.EFirmwareUpdateSteps.installing)return n.payload.installingTarget?.updateInfo?.firmwareType||void 0}),[n.payload,n?.step]),{totalStep:M,currentStep:A}=(0,o.useMemo)((function(){if(n?.step===l.EFirmwareUpdateSteps.installing){var e=n?.payload?.installingTarget;if(e)return{totalStep:e.totalPhase.length,currentStep:e.totalPhase.findIndex((function(r){return r===e.currentPhase}))+1}}return{totalPhase:null,currentPhase:null}}),[n.payload,n?.step]),k=(0,o.useMemo)((function(){if(n?.step===l.EFirmwareUpdateSteps.installing)return{fromVersion:n.payload.installingTarget?.updateInfo.fromVersion||void 0,toVersion:n.payload.installingTarget?.updateInfo.toVersion||void 0}}),[n.payload,n?.step]),C=f?.payload?.firmwareTipData?.message,F=f?.payload?.firmwareProgress,U=u.A.isConfirmOnDeviceAction(f),$=([c.rn.CheckLatestUiResource,c.rn.DownloadLatestUiResource,c.rn.DownloadLatestUiResourceSuccess,c.rn.UpdateSysResource,c.rn.UpdateSysResourceSuccess].includes(e),(0,p.Z)(j)),R=(0,o.useRef)(F);R.current=F;var I=(0,o.useRef)([]),L=(0,o.useMemo)((function(){var n=t.formatMessage({id:d.ETranslations.global_preparing});return e&&(n=t.formatMessage({id:d.ETranslations.global_updating})),j&&(n=t.formatMessage({id:d.ETranslations.global_updating_type},{type:j}),"ble"===j&&(n=t.formatMessage({id:d.ETranslations.global_updating_type},{type:t.formatMessage({id:d.ETranslations.global_bluetooth})}))),r&&(n=t.formatMessage({id:d.ETranslations.global_done})),n}),[t,j,r,e]),B=(0,o.useCallback)((function(e){var r=[{type:["checking"],progress:function(){return 1},progressMax:function(){return w},desc:function(){return t.formatMessage({id:d.ETranslations.update_checking_device_if_no_restart})}},{type:[c.rn.CheckLatestUiResource],progress:function(){return 2},desc:function(){return t.formatMessage({id:d.ETranslations.update_checking_latest_ui_resources})}},{type:[c.rn.DownloadLatestUiResource],progress:function(){return 3},desc:function(){return t.formatMessage({id:d.ETranslations.update_downloading_latest_ui_resources})}},{type:[c.rn.DownloadLatestUiResourceSuccess],progress:function(){return 5},desc:function(){return t.formatMessage({id:d.ETranslations.update_download_success})}},{type:[c.rn.UpdateSysResource],progress:function(){return 7},desc:function(){return t.formatMessage({id:d.ETranslations.update_updating_ui_resources})}},{type:[c.rn.UpdateSysResourceSuccess],progress:function(){return 9},desc:function(){return t.formatMessage({id:d.ETranslations.update_update_ui_resources_success})}},{type:[c.rn.AutoRebootToBootloader],progress:function(){return 10},desc:function(){return t.formatMessage({id:d.ETranslations.update_reboot_to_bootloader_mode})}},{type:[c.rn.GoToBootloaderSuccess],progress:function(){return 12},desc:function(){return t.formatMessage({id:d.ETranslations.update_reboot_success})}},{type:[c.rn.DownloadFirmware,c.rn.DownloadLatestBootloaderResource],progress:function(){return 14},desc:function(){return t.formatMessage({id:d.ETranslations.update_downloading})}},{type:[c.rn.DownloadFirmwareSuccess,c.rn.DownloadLatestBootloaderResourceSuccess],progress:function(){return 20},desc:function(){return t.formatMessage({id:d.ETranslations.update_download_success})}},{type:[c.rn.FirmwareEraseSuccess],progress:function(){return 25},desc:function(){return t.formatMessage({id:d.ETranslations.update_transferring_data})}},{type:["installing"],progress:function(){var e,r=30+.7*(null!=(e=R.current)?e:0);return r>=99&&(r=99),r},desc:function(){return 100===R.current?t.formatMessage({id:d.ETranslations.update_installing}):t.formatMessage({id:d.ETranslations.update_transferring_data})}},{type:["done"],progress:function(){return 100},desc:function(){return t.formatMessage({id:d.ETranslations.update_update_completed})}}],n=r.findIndex((function(r){return r.type.includes(e)}));if(n>=0){var a,o=r[n],s=o.progress(),i=E.current;v((function(){var e=Math.max(s,i);return E.current=e,e})),S(o.desc());var l=r[n+1],u=null!=(a=o?.progressMax?.())?a:l?.progress();T.current=u||99}}),[t]),z=(0,o.useRef)(B);z.current=B,(0,o.useEffect)((function(){h||j&&$&&j!==$&&(v(1),E.current=1,T.current=99,z.current("checking"))}),[j,$,h]),(0,o.useEffect)((function(){n?.step!==l.EFirmwareUpdateSteps.updateStart&&j||S(b())}),[b,j,n?.step]),(0,o.useEffect)((function(){var e=setInterval((function(){if(!h&&!r&&!U){var e=E.current;v((function(){if(e>=T.current)return T.current;if(e>=99)return 99;var r=Math.min(e+1,T.current,99);return E.current=r,r}))}}),2e3);return function(){clearInterval(e)}}),[j,U,r,h]),(0,o.useEffect)((function(){r&&setTimeout((function(){z.current("done")}),1e3)}),[r]),(0,o.useEffect)((function(){C&&I.current.push(C)}),[C]),(0,o.useEffect)((function(){a()(F)&&z.current("installing")}),[F]),(0,o.useEffect)((function(){_?.action===l.EHardwareUiStateAction.CLOSE_UI_WINDOW&&g.A.serviceHardwareUI.closeHardwareUiStateDialog({skipDeviceCancel:!0,connectId:void 0})}),[_?.action]),(0,o.useEffect)((function(){e&&z.current(e)}),[e]);var[D,P]=(0,o.useState)(!1),V=(0,o.useMemo)((function(){0}),[F,e,x,D]);return(0,m.jsxs)(i.Stack,{children:[(0,m.jsx)(FirmwareUpdateProgressBarView,{totalStep:M,currentStep:A,title:L,progress:x,desc:y,fromVersion:k?.fromVersion,toVersion:k?.toVersion}),V]})}},355422:(e,r,t)=>{t.d(r,{N:()=>FirmwareUpdateWalletProfile});var n=t(908867),a=t(490343),o=t(334439),s=t(593827),i=t(831085);function DeviceAvatar({deviceType:e,size:r}){return(0,i.jsx)(s.L,{img:e||"unknown",wallet:void 0,size:r})}function FirmwareUpdateWalletProfile({result:e}){var r=(0,n.A)();return(0,i.jsxs)(a.Stack,{onPress:function(){},children:[(0,i.jsx)(DeviceAvatar,{size:"$14",deviceType:e?.deviceType||"unknown"}),(0,i.jsxs)(a.SizableText,{mt:"$5",size:"$heading2xl",children:[r.formatMessage({id:o.ETranslations.update_new_hardware_updates})," "]})]})}},296437:(e,r,t)=>{t.d(r,{Y:()=>FirmwareUpdateWarningMessage});var n=t(908867),a=t(490343),o=t(334439),s=(t(663522),t(831085));function FirmwareUpdateWarningMessage(){var e=(0,n.A)();return(0,s.jsx)(a.Alert,{type:"warning",title:e.formatMessage({id:o.ETranslations.update_keep_usb_connected_and_app_active}),fullBleed:!0,mx:"$-5"})}},443791:(e,r,t)=>{t.d(r,{Y:()=>FirmwareVersionProgressBar});var n=t(514041),a=t(908867),o=t(302722),s=t.n(o),i=t(490343),l=t(334439),d=t(831085);function FirmwareVersionProgressBar({fromVersion:e="",toVersion:r=""}){var t=(0,a.A)().formatMessage({id:l.ETranslations.global_unknown}),o=(0,n.useCallback)((function(e){return!!e&&(!!s().valid(e)&&!s().eq(e,"0.0.0"))}),[]);return(0,d.jsxs)(i.XStack,{gap:"$2.5",alignItems:"center",children:[(0,d.jsx)(i.Badge,{badgeType:"default",badgeSize:"lg",children:o(e)?e:t}),(0,d.jsx)(i.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,d.jsx)(i.Badge,{badgeType:"info",badgeSize:"lg",children:r?.length>0?r:t})]})}},870264:(e,r,t)=>{t.r(r),t.d(r,{default:()=>w});var n=t(586330),a=t(514041),o=t(490343),s=t(259227),i=t(610421),l=t(498356),d=t(326745),u=t(88569),c=t(411252),g=t(336293),p=t(225555),f=t(296437),m=t(831085);const w=function PageFirmwareUpdateInstall(){var e=(0,d.u)(),{result:r}=e.params,t=(0,l.A)(),[w]=(0,s.useFirmwareUpdateStepInfoAtom)(),_=(0,a.useMemo)((function(){if(w.step===s.EFirmwareUpdateSteps.updateStart||w.step===s.EFirmwareUpdateSteps.installing||w.step===s.EFirmwareUpdateSteps.updateDone){var e=w.step===s.EFirmwareUpdateSteps.updateDone;return(0,m.jsxs)(m.Fragment,{children:[e?null:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(f.Y,{}),(0,m.jsx)(g.X,{})]}),(0,m.jsx)(u.m,{result:r,isDone:e})]})}return w.step===s.EFirmwareUpdateSteps.error?(requestAnimationFrame((function(){t.pop()})),(0,m.jsx)(g.X,{shouldPreventRemove:!1})):(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(c.p,{})})}),[w.step,r,t]);return(0,m.jsx)(o.Page,{scrollEnabled:!0,onUnmounted:(0,n.A)((function*(){yield i.A.serviceFirmwareUpdate.exitUpdateWorkflow()})),children:(0,m.jsxs)(p.oh,{children:[(0,m.jsx)(g.U,{}),_]})})}},334025:(e,r,t)=>{t.d(r,{Wg:()=>useKeepAwake});var n,a=t(586330),o=t(72631),s=t(514041),i=t(683180),l=t(34546);!function(e){e.RELEASE="release"}(n||(n={}));var d={};const u={isAvailableAsync:()=>(0,a.A)((function*(){return!!i.A.isDOMAvailable&&"wakeLock"in navigator}))(),activate:e=>(0,a.A)((function*(){if(i.A.isDOMAvailable){var r=yield navigator.wakeLock.request("screen");d[e]=r}}))(),deactivate:e=>(0,a.A)((function*(){if(i.A.isDOMAvailable){if(!d[e])throw new l.A("ERR_KEEP_AWAKE_TAG_INVALID",`The wake lock with tag ${e} has not activated yet`);d[e].release?.(),delete d[e]}}))(),addListenerForTag(e,r){var eventListener=function(){r({state:n.RELEASE})},t=d[e];return t&&("addEventListener"in t?t.addEventListener?.("release",eventListener):t.onrelease=eventListener),{remove:function(){var r=d[e];r&&(r.removeEventListener?r.removeEventListener("release",eventListener):r.onrelease=null)}}}};var c="ExpoKeepAwakeDefaultTag";function useKeepAwake(e=c,r){(0,s.useEffect)((function(){var t=!0;return activateKeepAwakeAsync(e).then((function(){t&&u.addListenerForTag&&r?.listener&&function addListener(e,r){if(!u.addListenerForTag)throw new o.V("ExpoKeepAwake","addListenerForTag");var t="string"==typeof e?e:c,n="function"==typeof e?e:r;return u.addListenerForTag(t,n)}(e,r.listener)})),function(){t=!1,r?.suppressDeactivateWarnings?deactivateKeepAwake(e).catch((function(){})):deactivateKeepAwake(e)}}),[e])}function activateKeepAwakeAsync(){return _activateKeepAwakeAsync.apply(this,arguments)}function _activateKeepAwakeAsync(){return(_activateKeepAwakeAsync=(0,a.A)((function*(e=c){yield u.activate?.(e)}))).apply(this,arguments)}function deactivateKeepAwake(){return _deactivateKeepAwake.apply(this,arguments)}function _deactivateKeepAwake(){return(_deactivateKeepAwake=(0,a.A)((function*(e=c){yield u.deactivate?.(e)}))).apply(this,arguments)}}}]);