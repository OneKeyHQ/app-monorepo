"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[14484],{696755:(e,t,n)=>{n.d(t,{A:()=>T});var r=n(586330),o=n(324586),a=n(514041),c=n(241440),s=n(490343),d=n(610421),i=n(298254),u=n(498356),l=n(564452),k=n(908867),f=n(353203),I=n(791088),p=n(391944),w=n(259227),b=n(625931),y=n(334439),m=n(392097),j=n(491180),x=n(553083),A=n(359395),g=n(911998),h=n(831085),v=(0,a.createContext)({}),NetworkContainer=function({networkIds:e,children:t}){var{result:{networks:n}}=(0,g.yk)((function(){return d.A.serviceNetwork.getNetworksByIds({networkIds:e})}),[e],{initResult:{networks:[]}}),r=(0,a.useMemo)((function(){return n.reduce((function(e,t){return e[t.id]=t,e}),{})}),[n]);return(0,h.jsx)(v.Provider,{value:r,children:t})},S=n(941230),keyExtractor=function(e){var t=e.address;return`${e.networkId}--${t||"main"}`},ListItemFiatToken=function({item:e,onPress:t}){var n=(0,k.A)(),{networkId:o,accountId:c}=(0,a.useContext)(S.T3),{createAddress:l}=(0,f.m)(),[g,O]=(0,a.useState)(!1),{account:P}=(0,i.b)({networkId:o,accountId:c}),T=function({networkId:e}){return(0,a.useContext)(v)[e]}({networkId:e.networkId}),{fiatMap:M}=(0,S.gZ)(),[{currencyInfo:{symbol:C}}]=(0,w.useSettingsPersistAtom)(),_=(0,u.A)(),$=(0,a.useCallback)((0,r.A)((function*(){var n;if(x.Ay.isAllNetwork({networkId:o})&&P?.indexedAccountId)if(e.networkId===(0,b.V)().btc)_.push(m.Mg.DeriveTypesAddress,{networkId:e.networkId,indexedAccountId:P.indexedAccountId,accountId:c,actionType:A.rI.Select,tokenMap:M,onSelected:(n=(0,r.A)((function*({account:n}){t?.({realAccountId:n.id,token:e})})),function onSelected(e){return n.apply(this,arguments)})});else{var a=yield d.A.serviceNetwork.getGlobalDeriveTypeOfNetwork({networkId:e.networkId});try{var s=yield d.A.serviceAccount.getNetworkAccount({accountId:void 0,indexedAccountId:P.indexedAccountId,networkId:e.networkId,deriveType:a});t?.({token:e,realAccountId:s.id})}catch{O(!0);try{var i=j.A.getWalletIdFromAccountId({accountId:P.indexedAccountId});yield l({selectAfterCreate:!0,num:0,account:{walletId:i,indexedAccountId:P.indexedAccountId,deriveType:a,networkId:e.networkId}});var u=yield d.A.serviceAccount.getNetworkAccount({accountId:void 0,indexedAccountId:P.indexedAccountId,networkId:e.networkId,deriveType:a});u&&t?.({token:e,realAccountId:u.id})}finally{O(!1)}}}else t?.({token:e,realAccountId:c})})),[t,e,o,P,c,_,M,l]);return(0,h.jsxs)(I.c,{userSelect:"none",onPress:$,children:[(0,h.jsx)(p.o,{size:"lg",tokenImageUri:e.icon,networkImageUri:T?.logoURI}),(0,h.jsx)(I.c.Text,{flex:1,primary:(0,h.jsxs)(s.XStack,{alignItems:"center",children:[(0,h.jsx)(s.SizableText,{size:"$bodyLgMedium",children:e.symbol}),(0,h.jsx)(s.Stack,{ml:"$2",children:(0,h.jsx)(s.Badge,{badgeType:"default",badgeSize:"sm",children:T?.name})})]}),secondary:e.name}),(0,h.jsx)(s.YStack,{alignItems:"flex-end",children:g?(0,h.jsxs)(s.XStack,{alignItems:"center",children:[(0,h.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",pr:"$2",children:n.formatMessage({id:y.ETranslations.global_creating_address})}),(0,h.jsx)(s.Spinner,{size:"small"})]}):(0,h.jsxs)(s.YStack,{alignItems:"flex-end",children:[e.balanceParsed?(0,h.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",children:e.balanceParsed}):null,e.fiatValue?(0,h.jsx)(s.NumberSizeableText,{size:"$bodyMd",formatter:"balance",color:"$textSubdued",formatterOptions:{currency:C},children:e.fiatValue}):null]})})]})},TokenList=function({items:e,onPress:t}){var[n,r]=(0,a.useState)(""),o=(0,a.useCallback)((function(e){r(e.trim())}),[]),c=(0,a.useMemo)((function(){var t=n.toLowerCase();return e.filter((function(e){return e.name.toLowerCase().includes(t)||e.symbol.toLowerCase().includes(n)}))}),[e,n]),d=(0,k.A)(),{bottom:i}=(0,s.useSafeAreaInsets)();return(0,h.jsxs)(s.Stack,{flex:1,children:[(0,h.jsx)(s.Stack,{px:"$5",pb:"$4",children:(0,h.jsx)(s.SearchBar,{placeholder:d.formatMessage({id:y.ETranslations.global_search_tokens}),value:n,onChangeText:o})}),(0,h.jsx)(s.Stack,{flex:1,children:(0,h.jsx)(s.ListView,{estimatedItemSize:60,data:c,renderItem:function({item:e}){return(0,h.jsx)(ListItemFiatToken,{item:e,onPress:t})},keyExtractor,ListFooterComponent:(0,h.jsx)(s.Stack,{h:i||"$2"}),ListEmptyComponent:(0,h.jsx)(s.Empty,{title:d.formatMessage({id:y.ETranslations.global_no_results}),icon:"SearchOutline"})})})]})},O=n(69531),P=n(117746);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const T=(0,l.k)((function({title:e,type:t,networkId:n,accountId:o}){var l,k=(0,u.A)(),{result:f,isLoading:I}=(0,O.ej)({networkId:n,accountId:o,type:t}),{getTokenFiatValue:p}=(0,S.gZ)(),{account:w}=(0,i.b)({networkId:n,accountId:o}),b=(0,a.useMemo)((function(){if(!x.Ay.isAllNetwork({networkId:n}))return f;var e=f.map((function(e){return _objectSpread(_objectSpread({},e),{},{fiatValue:p({networkId:e.networkId,tokenAddress:e.address.toLowerCase()})?.fiatValue,balanceParsed:p({networkId:e.networkId,tokenAddress:e.address.toLowerCase()})?.balanceParsed})}));return"sell"===t&&(e=e.filter((function(e){return e.balanceParsed&&0!==Number(e.balanceParsed)}))),w&&j.A.isOthersAccount({accountId:w.id})&&(e=e.filter((function(e){return j.A.isAccountCompatibleWithNetwork({account:w,networkId:e.networkId})}))),e.sort((function(e,t){var n,r,o=null!=(n=e.fiatValue)?n:"0",a=null!=(r=t.fiatValue)?r:"0";return(0,c.A)(o).gt(a)?-1:1}))}),[f,p,n,t,w]),y=(0,a.useCallback)((l=(0,r.A)((function*({token:e,realAccountId:n}){var{url:r}=yield d.A.serviceFiatCrypto.generateWidgetUrl({networkId:e.networkId,tokenAddress:e.address,accountId:n,type:t});(0,P.Dr)(r),k.popStack()})),function(e){return l.apply(this,arguments)}),[k,t]),m=(0,a.useMemo)((function(){return Array.from(new Set(b.map((function(e){return e.networkId}))))}),[b]);return(0,h.jsxs)(s.Page,{safeAreaEnabled:!1,children:[(0,h.jsx)(s.Page.Header,{title:e}),(0,h.jsx)(s.Page.Body,{children:(0,h.jsx)(NetworkContainer,{networkIds:m,children:I?(0,h.jsx)(s.Stack,{minHeight:300,justifyContent:"center",alignItems:"center",children:(0,h.jsx)(s.Spinner,{size:"large"})}):(0,h.jsx)(TokenList,{items:b,onPress:y})})})]})}))},941230:(e,t,n)=>{n.d(t,{T3:()=>d,gZ:()=>useTokenDataContext,jh:()=>TokenDataContainer});var r=n(324586),o=n(514041),a=n(384013),c=n(553083),s=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var buildAccountTokenIndexKey=function({networkId:e,tokenAddress:t}){return e?`${e}__${t}`:""};function buildAccountTokenMap({tokens:e,lastResult:t={}}){for(var n=_objectSpread({},t),r=0;r<e.length;r+=1){var o=e[r],a=buildAccountTokenIndexKey({networkId:o.networkId,tokenAddress:o.address});a&&(n[a]=o)}return n}var d=(0,o.createContext)({tokensMap:{},fiatMap:{},networkId:""}),useTokenDataContext=function(){var{tokensMap:e,fiatMap:t,networkId:n}=(0,o.useContext)(d);return{getTokenFiatValue:(0,o.useCallback)((function({networkId:r,tokenAddress:o}){if(c.Ay.isAllNetwork({networkId:n})){var a=buildAccountTokenIndexKey({networkId:r,tokenAddress:o}),s=e[a]?.$key;return s?t[s]:void 0}}),[e,t,n]),tokensMap:e,fiatMap:t}};function TokenDataContainer({children:e,initialMap:t,initialTokens:n,networkId:r,accountId:c}){var[i]=(0,a.Cg)(),[u]=(0,a.pz)(),[l]=(0,a.cV)(),[k]=(0,a.r9)(),f=(0,o.useMemo)((function(){return{tokensMap:buildAccountTokenMap({tokens:n.concat([...i.tokens,...u.smallBalanceTokens])}),fiatMap:_objectSpread(_objectSpread(_objectSpread({},t),l),k),networkId:r,accountId:c}}),[n,i.tokens,u.smallBalanceTokens,t,l,k,r,c]);return(0,s.jsx)(d.Provider,{value:f,children:e})}},814484:(e,t,n)=>{n.r(t),n.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var r=n(654266),o=n(908867),a=n(325809),c=n(334439),s=n(714191),d=n(208257),i=n(696755),u=n(941230),l=n(831085);const __WEBPACK_DEFAULT_EXPORT__=function(){var e=(0,r.lq)(),{networkId:t,accountId:n,tokens:k=[],map:f={}}=e.params,I=(0,o.A)();return(0,l.jsx)(a.b8,{config:{sceneName:s.Zs.home,sceneUrl:""},enabledNum:[0],children:(0,l.jsx)(d.p,{children:(0,l.jsx)(u.jh,{networkId:t,accountId:n,initialMap:f,initialTokens:k,children:(0,l.jsx)(i.A,{title:I.formatMessage({id:c.ETranslations.global_buy}),type:"buy",networkId:t,accountId:n})})})})}}}]);