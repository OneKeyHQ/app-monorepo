"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[42038,52596],{593827:(e,r,n)=>{n.d(r,{L:()=>WalletAvatar});var t=n(503668),o=n.n(t),a=n(490343),i=n(491180),s=n(258988),l=n(831085);function WalletAvatarBase({size:e,img:r,wallet:n}){var t,o,d=r||n?.avatarInfo?.img;return d?i.A.isHwHiddenWallet({wallet:n})?(0,l.jsx)(a.Icon,{size:"$10",name:"LockSolid",color:"$iconSubdued"}):(0,l.jsxs)(a.Image,{size:e,children:[(0,l.jsx)(a.Image.Source,{source:null!=(t=s.UO[d])?t:s.UO.bear}),(0,l.jsx)(a.Image.Fallback,{delayMs:300,justifyContent:"center",alignItems:"center",children:(0,l.jsx)(a.SizableText,{children:null!=(o=n?.avatarInfo?.emoji)?o:""})})]}):null}function WalletAvatar({size:e="$10",status:r,badge:n,img:t,wallet:i}){return(0,l.jsxs)(a.Stack,{w:e,h:e,justifyContent:"center",alignItems:"center",children:[(0,l.jsx)(WalletAvatarBase,{size:e,img:t,wallet:i}),"connected"===r?(0,l.jsx)(a.Stack,{position:"absolute",bottom:-2,right:-2,bg:"$bgSidebar",p:"$0.5",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(a.Stack,{borderRadius:"$full",w:"$2.5",h:"$2.5",bg:"$bgSuccessStrong"})}):null,o()(n)?null:(0,l.jsx)(a.Stack,{position:"absolute",h:"$4",px:"$0.5",justifyContent:"center",bottom:-2,right:-1,bg:"$bgSubdued",borderRadius:"$full",zIndex:"$1",children:(0,l.jsx)(a.SizableText,{size:"$bodySm",textAlign:"center",children:n})})]})}},57597:(e,r,n)=>{n.r(r),n.d(r,{FirmwareUpdateGalleryDemo:()=>FirmwareUpdateGalleryDemo,default:()=>stories_FirmwareUpdateGallery});var t=n(324586),o=n(586330),a=n(490343),i=n(610421),s=n(325809),l=n(162616),d=n(973066),c=n(139499),u=n(88569),p=n(411252),m=n(853748),g=n(99202),h=n(296437),f=n(349521),_=n(773831),w=n(282029),x={features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null},deviceType:"touch",deviceName:"OneKey Touch",deviceUUID:"TC01WBD202207290844270000046",hasUpgrade:!0,isBootloaderMode:!1,updateInfos:{firmware:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"4.9.0",toVersion:"4.9.1",releasePayload:{status:"outdated",changelog:[{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}],release:{required:!1,version:[4,9,1],bootloaderResource:"https://web.onekey-asset.com/hardware/touch/bootloader/v2.4.9/bootloader.2.4.9-Stable-0807-3e033eb.signed.bin",bootloaderVersion:[2,4,8],fullResource:"https://web.onekey-asset.com/hardware/touch/resource/res-4.9.0.zip",fullResourceRange:["3.5.0","4.0.0"],resource:"https://web.onekey-asset.com/hardware/touch/resource/resource-4.0.0-4.9.0.zip",url:"https://web.onekey-asset.com/hardware/touch/firmware/v4.9.0/touch.4.9.0-Stable-0410-fccbac8.signed.bin",fingerprint:"",changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}},bootloaderMode:!1,features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null}},changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing."},firmwareType:"firmware"},ble:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"2.1.0",toVersion:"2.1.1",releasePayload:{status:"outdated",changelog:[{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"}],release:{required:!1,version:[2,1,1],webUpdate:"https://common.onekey-asset.com/hw/touch/2.1.0/touch_ble_signed-2022-1102_2.1.0.bin",fingerprint:"",changelog:{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"}},bootloaderMode:!1,features:{vendor:"trezor.io",major_version:2,minor_version:99,patch_version:99,bootloader_mode:null,device_id:"851D737A09073D51A26A8EEB",pin_protection:!0,passphrase_protection:null,language:"zh_hk",label:"OneKey Touch",initialized:!0,revision:"fccbac81cef7877e6e3b761677ff0d83808380ad",bootloader_hash:null,imported:null,unlocked:!1,_passphrase_cached:null,firmware_present:null,needs_backup:null,flags:null,model:"T",fw_major:null,fw_minor:null,fw_patch:null,fw_vendor:null,unfinished_backup:null,no_backup:null,recovery_mode:null,capabilities:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17],sd_card_present:!0,sd_protection:null,wipe_code_protection:null,session_id:"47d8463911f0354f4dc1fa45d403984c43a921926f04bd7f6581c52e6973bd2d",passphrase_always_on_device:null,auto_lock_delay_ms:null,display_rotation:null,experimental_features:null,offset:null,ble_name:"Touch 3F3B",ble_ver:"2.1.0",ble_enable:!0,se_enable:null,se_ver:null,backup_only:null,onekey_version:"4.9.0",onekey_serial:null,bootloader_version:"2.4.9",serial_no:"TC01WBD202207290844270000046",spi_flash:null,initstates:null,NFT_voucher:null,cpu_info:null,pre_firmware:null,coin_switch:null,build_id:"746f7563682e342e392e302d537461626c652d303431302d66636362616338",boardloader_version:"1.0.0",busy:!1,onekey_device_type:"TOUCH",onekey_se_type:"SE608A",onekey_board_version:"1.0.0",onekey_board_hash:null,onekey_boot_version:"2.4.9",onekey_boot_hash:null,onekey_se01_version:null,onekey_se01_hash:null,onekey_se01_build_id:null,onekey_firmware_version:"4.9.0",onekey_firmware_hash:null,onekey_firmware_build_id:null,onekey_serial_no:"TC01WBD202207290844270000046",onekey_boot_build_id:null,onekey_ble_name:"Touch 3F3B",onekey_ble_version:"2.1.0",onekey_ble_build_id:null,onekey_ble_hash:null,onekey_se02_version:null,onekey_se03_version:null,onekey_se04_version:null}},changelog:{"zh-CN":"### 🐞 问题修复\r\n- 充电电量显示问题\r\n- 关闭蓝牙后，能够正确关机\r\n","en-US":"### 🐞 Bug Fixes\r\n- Fixed charging power display problem\r\n- After turning off bluetooth, it can shut down properly\r\n"},firmwareType:"ble"},bootloader:{hasUpgrade:!0,hasUpgradeForce:!1,fromVersion:"2.4.9",toVersion:"2.4.8",releasePayload:{status:"valid",changelog:[{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}],release:{required:!1,version:[4,9,1],bootloaderResource:"https://web.onekey-asset.com/hardware/touch/bootloader/v2.4.9/bootloader.2.4.9-Stable-0807-3e033eb.signed.bin",bootloaderVersion:[2,4,8],fullResource:"https://web.onekey-asset.com/hardware/touch/resource/res-4.9.0.zip",fullResourceRange:["3.5.0","4.0.0"],resource:"https://web.onekey-asset.com/hardware/touch/resource/resource-4.0.0-4.9.0.zip",url:"https://web.onekey-asset.com/hardware/touch/firmware/v4.9.0/touch.4.9.0-Stable-0410-fccbac8.signed.bin",fingerprint:"",changelog:{"zh-CN":"### ✨ 新功能\r\n- 支持 Manta, Neurai 以及 Nervos 网络\r\n- 支持 LNURL Auth 授权签名\r\n- 支持在设备信息中，查看固件版本号\r\n- 新增在 Celestia 网络下的精度展示\r\n\r\n### 🐞 问题修复\r\n- 修复在 Astar 网络下，查看转账数据卡死的问题\r\n- 修复在闪电网络下，签名信息页面文案缺失的问题\r\n- 修复在核对助记词过程中异常退出，再次进入未触发校验PIN码及退出锁屏失效的问题\r\n\r\n### 💎 改进\r\n- 优化在 Sui 网络下，分包处理签名数据的逻辑\r\n- 优化在 BTC 网络下的签名交易过程中，OP_RETURN 可展示原文\r\n- 优化在波卡网络下，将支持展示更多的签名信息细节\r\n","en-US":"### ✨ New Features\r\n- Support for Manta, Neurai, and Nervos networks.\r\n- Support for LNURL Auth authorization signing.\r\n- Ability to view firmware version in device information.\r\n- New precision display under the Celestia network.\r\n\r\n### 🐞 Bug Fixes\r\n- Fixed a freeze when viewing transfer data on the Astar network.\r\n- Fixed missing text on the signature information page on the Lightning network.\r\n- Fixed an issue where re-entering the app after an abnormal exit during recovery phrase verification did not trigger PIN verification and the lock screen was ineffective.\r\n\r\n### 💎 Improvements\r\n- Optimized packet handling logic for signing data on the Sui network.\r\n- Enhanced the display of original text in OP_RETURN during signing transactions on the BTC network.\r\n- Improved the display of detailed signature information on the Polkadot network.\r\n"}},bootloaderMode:!1,shouldUpdate:!1},changelog:{"zh-CN":"### 🐞 问题修复\r\n- xxxxx","en-US":"### 🐞 Bug Fixes\r\n- xxxx\r\n"},firmwareType:"bootloader"},bridge:{shouldUpdate:!1,status:"valid",releaseVersion:"2.2.0"}}},b=n(259227),v=n(507140),y=n(714191),S=n(100645),j=n(654004),k=n(831085);function ownKeys(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(n),!0).forEach((function(r){(0,t.A)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function ForceOpenHomeDeviceUpdateFirmwareModal(){var{activeAccount:e}=(0,l.LH)({num:0}),r=e.device?.connectId,n=(0,_.B)();return(0,k.jsx)(a.Button,{onPress:(0,o.A)((function*(){n.openChangeLogModal({connectId:r})})),children:"NormalModeUpdate"})}function ResetDetectTimeCheck(){var{activeAccount:e}=(0,l.LH)({num:0}),r=e.device?.connectId;return(0,k.jsx)(a.Button,{onPress:function(){r&&i.A.serviceFirmwareUpdate.resetShouldDetectTimeCheck({connectId:r})},children:"ResetDetectTimeCheck"})}function BootloaderModeUpdateButton(){var[e]=(0,b.useFirmwareUpdateRetryAtom)(),r=(0,_.B)();return(0,k.jsx)(a.Button,{onPress:function(){r.showBootloaderMode({connectId:void 0})},children:"BootloaderModeUpdate"})}function ClearUpdateInfoDetectCacheButton(){var[,e]=(0,b.useFirmwareUpdatesDetectStatusAtom)();return(0,k.jsx)(a.Button,{onPress:function(){e(void 0)},children:"ClearUpdateInfoDetectCache"})}function FirmwareUpdateGalleryDemo(){return(0,k.jsx)(s.b8,{config:{sceneName:y.Zs.home},enabledNum:[0],children:(0,k.jsx)(a.Stack,{gap:"$2",children:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(ForceOpenHomeDeviceUpdateFirmwareModal,{}),(0,k.jsx)(BootloaderModeUpdateButton,{}),(0,k.jsx)(ClearUpdateInfoDetectCacheButton,{}),(0,k.jsx)(ResetDetectTimeCheck,{})]})})})}function FirmwareUpdateErrorDemo({error:e,onRetry:r,result:n}){var{onRetryHandler:t,content:o,detail:a,retryText:i}=(0,m.RH)({error:e,onRetry:r,result:n,lastFirmwareTipMessage:void 0});return(0,k.jsxs)(k.Fragment,{children:[o,a]})}function StaticUIDialog(){var e=(0,a.useForm)({defaultValues:{contentType:w.g2.default}});return(0,k.jsxs)(a.Form,{form:e,children:[(0,k.jsx)(a.Form.Field,{name:"contentType",label:"contentType",children:(0,k.jsx)(a.Select,{title:"",items:Object.keys(w.g2).map((function(e){return{label:e,value:e}}))})}),(0,k.jsx)(a.Button,{onPress:function(){a.Dialog.show({showFooter:!1,renderContent:(0,k.jsx)(w.CN,_objectSpread(_objectSpread({},e.getValues()),{},{errorObj:{code:800},onActionPress:function(){alert("onActionPress")},onContinuePress:function(){alert("onContinuePress")}}))})},children:"FirmwareVerify UI Dialog"})]})}function FirmwareUpdateGalleryStaticUI(){var e=(0,_.B)();return(0,k.jsxs)(a.Stack,{mt:"$8",children:[(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 首页更新提示"}),(0,k.jsx)(f.F,{message:"Firmware 3.6.0 is available"}),(0,k.jsx)(a.Button,{onPress:function(){e.showBootloaderMode({connectId:void 0})},children:"Bootloader 模式更新提示"}),(0,k.jsx)(a.Button,{onPress:function(){e.showForceUpdate({connectId:void 0})},children:"强更提示"})]}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 更新检测中"}),(0,k.jsx)(c.k,{connectId:void 0})]}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 更新日志（有更新）"}),(0,k.jsx)(d.z,{result:x})]}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 已经是最新固件（无更新）"}),(0,k.jsx)(p.p,{})]}),(0,k.jsx)(a.Stack,{my:"$8",children:(0,k.jsx)(a.Button,{onPress:function(){e.showCheckList({result:x})},children:"* 升级前检查项"})}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 升级错误"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 通用错误（直接修改 Error 类型的 defaultMessage）"}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.CJ}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.kG}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 需要手动进入 boot 模式"}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.e9}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 手动进入 boot 模式(mini)"}),(0,k.jsx)(m._V,{deviceType:"mini"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 手动进入 boot 模式(classic)"}),(0,k.jsx)(m._V,{deviceType:"classic"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 需要安装或检查 bridge 状态"}),(0,k.jsx)(a.SizableText,{children:"TODO"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 需要手动升级 bridge"}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.J6}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 需要在网页端升级"}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.Kb}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 需要手动升级全量资源"}),(0,k.jsx)(FirmwareUpdateErrorDemo,{result:x,error:new v.Rw})]}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading5xl",children:"* 安装进度"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 安装提醒"}),(0,k.jsx)(h.Y,{}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 安装中"}),(0,k.jsx)(g.w,{currentStep:void 0,totalStep:void 0,title:"Preparing...",progress:12,desc:"Checking device...",fromVersion:"",toVersion:""}),(0,k.jsx)(g.w,{currentStep:1,totalStep:1,title:"Preparing...(Only One Step, no step text bar is displayed)",progress:12,desc:"Checking device...",fromVersion:"",toVersion:""}),(0,k.jsx)(g.w,{currentStep:1,totalStep:3,title:"Updating firmware...",progress:20,desc:"Downloading...",fromVersion:void 0,toVersion:"1.0.1"}),(0,k.jsx)(g.w,{currentStep:2,totalStep:3,title:"Updating bluetooth...",progress:50,desc:"Transferring...",fromVersion:"1.0.0",toVersion:"1.0.1"}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 安装出错重试(和前面的 Error 组件共享 UI)"}),(0,k.jsx)(u.V,{result:x,tipMessage:S.rn.FirmwareEraseSuccess,retryInfo:{id:0,error:new v.e9}}),(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"** 安装完成"}),(0,k.jsx)(u.V,{result:x,isDone:!0,tipMessage:S.rn.AutoRebootToBootloader,retryInfo:void 0})]}),(0,k.jsxs)(a.Stack,{my:"$8",children:[(0,k.jsx)(a.SizableText,{size:"$heading2xl",children:"* StaticUIDialog"}),(0,k.jsx)(StaticUIDialog,{})]})]})}const stories_FirmwareUpdateGallery=function(){return(0,k.jsx)(j.P,{description:"--",suggestions:["--"],boundaryConditions:["--"],elements:[{title:"--",element:(0,k.jsxs)(a.Stack,{gap:"$1",children:[(0,k.jsx)(FirmwareUpdateGalleryDemo,{}),(0,k.jsx)(FirmwareUpdateGalleryStaticUI,{})]})}]})}},654004:(e,r,n)=>{n.d(r,{P:()=>Layout});var t=n(586330),o=n(654266),a=n(490343),i=n(989375),s=n(610421),l=n(498356),d=n(392097),c=n(831085),FormattedText=function({text:e}){return"string"==typeof e?(0,c.jsx)(a.Stack,{children:(0,c.jsxs)(a.SizableText,{children:[e,"。 "]})}):Array.isArray(e)&&0===e.length?null:(0,c.jsx)(a.Stack,{children:(0,c.jsx)(a.Stack,{gap:"$1",children:e.map((function(r,n){return(0,c.jsx)(a.Stack,{children:(0,c.jsxs)(a.SizableText,{children:[n+1,". ",r,n===e.length-1?"。":"；"]})},n.toString())}))})})};function Layout({description:e="",suggestions:r=[],boundaryConditions:n=[],elements:u=[],scrollEnabled:p=!0,contentInsetAdjustmentBehavior:m="never",skipLoading:g=!1,children:h}){var f=(0,i.U6)(),_=(0,l.A)();return(0,c.jsx)(a.Page,{skipLoading:g,children:(0,c.jsx)(a.ScrollView,{maxWidth:"100%",scrollEnabled:p,flex:1,marginBottom:f,paddingHorizontal:"$5",contentContainerStyle:{paddingTop:20,paddingBottom:280},keyboardDismissMode:"on-drag",contentInsetAdjustmentBehavior:m,children:(0,c.jsxs)(a.Stack,{marginHorizontal:"auto",maxWidth:"100%",width:576,gap:"$6",children:[(0,c.jsxs)(a.XStack,{children:[(0,c.jsx)(a.IconButton,{icon:"HomeLineOutline",onPress:function(){_.dispatch(o.y9.replace(d.WP.Main,{screen:d.V4.Developer,params:{screen:d.f$.TabDeveloper}}))}}),(0,c.jsx)(a.Button,{ml:"$4",onPress:(0,t.A)((function*(){yield s.A.serviceSetting.setTheme("light")})),children:"Light Theme"}),(0,c.jsx)(a.Button,{ml:"$4",variant:"primary",onPress:(0,t.A)((function*(){yield s.A.serviceSetting.setTheme("dark")})),children:"Dark Theme"})]}),e?(0,c.jsxs)(a.Stack,{gap:"$2",children:[(0,c.jsx)(a.Stack,{children:(0,c.jsx)(a.SizableText,{size:"$headingXl",children:"使用说明"})}),(0,c.jsx)(a.Stack,{children:(0,c.jsx)(FormattedText,{text:e})})]}):null,r?(0,c.jsxs)(a.Stack,{gap:"$2",children:[(0,c.jsx)(a.Stack,{children:(0,c.jsx)(a.SizableText,{size:"$headingXl",children:"使用建议"})}),(0,c.jsx)(FormattedText,{text:r})]}):null,n?.length>0?(0,c.jsxs)(a.Stack,{gap:"$2",children:[(0,c.jsx)(a.Stack,{children:(0,c.jsx)(a.SizableText,{size:"$headingXl",children:"注意事项"})}),(0,c.jsx)(FormattedText,{text:n})]}):null,(0,c.jsxs)(a.Stack,{gap:"$2",children:[(0,c.jsx)(a.Stack,{children:(0,c.jsx)(a.SizableText,{size:"$headingXl",children:"组件案例"})}),(0,c.jsx)(a.Stack,{children:u?.map((function(e,r){return(0,c.jsxs)(a.Stack,{gap:"$2",pb:"$8",mb:"$8",borderBottomWidth:"$px",borderBottomColor:"$borderSubdued",children:[(0,c.jsxs)(a.Stack,{flexDirection:"column",children:[(0,c.jsx)(a.SizableText,{size:"$headingLg",children:e.title}),e.description?(0,c.jsx)(a.Stack,{paddingTop:1,children:(0,c.jsxs)(a.SizableText,{children:[e.description,"。"]})}):null]}),(0,c.jsx)(a.Stack,{children:"function"==typeof e.element?(0,c.jsx)(e.element,{}):e.element})]},`elements-${r}`)}))}),(0,c.jsx)(a.Stack,{children:h?(0,c.jsx)(a.Stack,{gap:"$3",children:h}):null})]})]})})})}},973066:(e,r,n)=>{n.d(r,{i:()=>FirmwareChangeLogContentView,z:()=>FirmwareChangeLogView});var t=n(586330),o=n(514041),a=n(908867),i=n(490343),s=n(610421),l=n(259227),d=n(334439),c=n(773831),u=n(225555),p=n(355422),m=n(443791),g=n(831085);function ChangeLogMarkdown({changelog:e}){var[{locale:r}]=(0,l.useSettingsPersistAtom)(),[n,a]=(0,o.useState)(r);return(0,o.useEffect)((function(){(0,t.A)((function*(){"system"===r&&a(yield s.A.serviceSetting.getCurrentLocale())}))()}),[r]),(0,g.jsx)(i.Markdown,{children:e?.["zh-CN"===n?"zh-CN":"en-US"]||"No change log found."})}function ChangeLogSection({title:e,icon:r,isDone:n,updateInfo:t}){var s=(0,a.A)(),[l,c]=(0,o.useState)(n),u=(0,o.useCallback)((function(){c(!l)}),[l]);return(0,g.jsxs)(i.Stack,{children:[(0,g.jsxs)(i.XStack,{gap:"$3",py:"$2",ai:"center",onPress:u,children:[(0,g.jsx)(i.Icon,{name:r,size:"$5"}),(0,g.jsxs)(i.Stack,{flex:1,children:[(0,g.jsx)(i.SizableText,{size:"$bodyLgMedium",children:e}),(0,g.jsx)(i.SizableText,{size:"$bodyMd",color:n?"$textSubdued":"$textInfo",children:n?s.formatMessage({id:d.ETranslations.update_updated_to_latest_version},{version:t?.toVersion||s.formatMessage({id:d.ETranslations.global_unknown})}):s.formatMessage({id:d.ETranslations.global_version_is_available},{version:t?.toVersion||s.formatMessage({id:d.ETranslations.global_unknown})})})]}),(0,g.jsx)(i.IconButton,{icon:l?"ChevronDownSmallOutline":"ChevronTopSmallOutline",variant:"tertiary",onPress:u})]}),l?null:(0,g.jsxs)(i.Stack,{bg:"$bgStrong",p:"$5",borderRadius:"$3",children:[(0,g.jsx)(m.Y,{fromVersion:t?.fromVersion,toVersion:t?.toVersion}),(0,g.jsx)(ChangeLogMarkdown,{changelog:t?.changelog})]})]})}function FirmwareChangeLogContentView({result:e,isDone:r}){var n=(0,a.A)();return(0,g.jsxs)(i.Stack,{mt:"$8",children:[e?.updateInfos?.bootloader?.hasUpgrade?(0,g.jsx)(ChangeLogSection,{title:n.formatMessage({id:d.ETranslations.global_bootloader}),icon:"StorageOutline",updateInfo:e?.updateInfos?.bootloader,isDone:r}):null,e?.updateInfos?.ble?.hasUpgrade?(0,g.jsx)(ChangeLogSection,{title:n.formatMessage({id:d.ETranslations.global_bluetooth}),icon:"BluetoothOutline",updateInfo:e?.updateInfos?.ble,isDone:r}):null,e?.updateInfos?.firmware?.hasUpgrade?(0,g.jsx)(ChangeLogSection,{title:n.formatMessage({id:d.ETranslations.global_firmware}),icon:"LaunchOutline",updateInfo:e?.updateInfos?.firmware,isDone:r}):null]})}function FirmwareChangeLogView({result:e}){var r=(0,a.A)(),[,n]=(0,l.useFirmwareUpdateStepInfoAtom)(),{showCheckList:t}=(0,c.B)();return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(u.nv,{onConfirmText:r.formatMessage({id:d.ETranslations.update_update_now}),onConfirm:function(){n({step:l.EFirmwareUpdateSteps.showCheckList,payload:void 0}),t({result:e})}}),(0,g.jsxs)(i.Stack,{children:[(0,g.jsx)(p.N,{result:e}),(0,g.jsx)(FirmwareChangeLogContentView,{result:e})]})]})}},139499:(e,r,n)=>{n.d(r,{k:()=>FirmwareCheckingLoading});var t=n(908867),o=n(490343),a=n(334439),i=n(831085);function FirmwareCheckingLoading({connectId:e}){var r=(0,t.A)();return(0,i.jsxs)(o.Stack,{ai:"center",jc:"center",h:500,children:[(0,i.jsx)(o.Spinner,{size:"large"}),(0,i.jsx)(o.SizableText,{my:"$6",size:"$headingLg",children:r.formatMessage({id:a.ETranslations.update_checking_for_updates})}),null]})}},88569:(e,r,n)=>{n.d(r,{m:()=>FirmwareInstallingView,V:()=>FirmwareInstallingViewBase});var t=n(514041),o=n(490343),a=n(259227),i=n(908867),s=n(334439),l=n(773831),d=n(973066),c=n(723337),u=n(225555),p=n(831085);function FirmwareUpdateDone({result:e}){var r=(0,i.A)(),n=(0,l.B)();return(0,p.jsxs)(o.Stack,{children:[(0,p.jsx)(c.u,{icon:"CheckRadioSolid",tone:"success",title:r.formatMessage({id:s.ETranslations.update_all_updates_complete})}),(0,p.jsx)(d.i,{result:e,isDone:!0}),(0,p.jsx)(u.nv,{onConfirmText:r.formatMessage({id:s.ETranslations.global_got_it}),onConfirm:function(){n.closeUpdateModal()}})]})}var m=n(853748),g=n(99202),h=n(355422);function FirmwareInstallingViewBase({result:e,isDone:r,tipMessage:n,retryInfo:a,progressBarKey:i}){(0,p.jsx)(h.N,{result:e});var s=(0,t.useMemo)((function(){return r?(0,p.jsx)(FirmwareUpdateDone,{result:e}):a?(0,p.jsx)(m.uH.InstallingErrors,{retryInfo:a,result:e,lastFirmwareTipMessage:n}):(0,p.jsx)(g.D,{lastFirmwareTipMessage:n,isDone:r},i)}),[r,i,e,a,n]);return(0,p.jsx)(o.Stack,{children:s})}function FirmwareInstallingView({result:e,isDone:r}){var[n]=(0,a.useFirmwareUpdateStepInfoAtom)(),[o]=(0,a.useFirmwareUpdateRetryAtom)(),[i]=(0,a.useHardwareUiStateAtom)(),s=(0,t.useRef)(0);n.step===a.EFirmwareUpdateSteps.updateStart&&(s.current=n.payload.startAtTime);var l=i?.payload?.firmwareTipData?.message,[d,c]=(0,t.useState)();return(0,t.useEffect)((function(){l&&c(l)}),[l]),(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(FirmwareInstallingViewBase,{result:e,isDone:r,tipMessage:d,retryInfo:o,progressBarKey:s.current})})}},411252:(e,r,n)=>{n.d(r,{p:()=>FirmwareLatestVersionInstalled});var t=n(908867),o=n(490343),a=n(334439),i=n(831085);function FirmwareLatestVersionInstalled(){var e=(0,t.A)();return(0,i.jsxs)(o.Stack,{ai:"center",jc:"center",h:500,children:[(0,i.jsx)(o.Icon,{size:"$14",name:"CheckRadioSolid",color:"$iconSuccess"}),(0,i.jsx)(o.SizableText,{my:"$6",size:"$headingLg",children:e.formatMessage({id:a.ETranslations.update_latest_version})})]})}},723337:(e,r,n)=>{n.d(r,{u:()=>FirmwareUpdateBaseMessageView});var t=n(514041),o=n(908867),a=n(490343),i=n(726130),s=n(334439),l=(n(663522),n(831085)),getColors=function(e){switch(e){case"destructive":return{iconWrapperBg:"$bgCritical",iconColor:"$iconCritical"};case"warning":return{iconWrapperBg:"$bgCaution",iconColor:"$iconCaution"};case"success":return{iconWrapperBg:"$bgSuccess",iconColor:"$iconSuccess"};default:return{iconWrapperBg:"$bgStrong",iconColor:"$icon"}}};function UpdateErrorTroubleshooting(){var e,r=(0,o.A)();e=s.ETranslations.update_troubleshoot_connection_issues;var n=r.formatMessage({id:e,defaultMessage:"If you have any questions, please refer to the troubleshooting guide."}).split("\n");return(0,l.jsx)(a.Stack,{children:n.map((function(e,r){return e.includes("<url>")?(0,l.jsx)(a.RichSizeableText,{size:"$bodyMd",color:"$textSubdued",linkList:{url:{url:i.ks}},children:e},r):(0,l.jsx)(a.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e},r)}))})}function FirmwareUpdateBaseMessageView({icon:e,title:r,tone:n,message:o,linkList:i,displayTroubleshooting:s}){var d=(0,t.useCallback)((function(){return e?.endsWith("Solid")?(0,l.jsx)(a.Icon,{name:e,size:"$14",color:getColors(n).iconColor}):(0,l.jsx)(a.Stack,{alignSelf:"flex-start",p:"$3",borderRadius:"$full",bg:getColors(n).iconWrapperBg,children:(0,l.jsx)(a.Icon,{name:e,size:"$7",color:getColors(n).iconColor})})}),[e,n]);return(0,l.jsxs)(a.Stack,{py:"$6",gap:"$5",children:[(0,l.jsxs)(a.Stack,{children:[e?d():null,r?(0,l.jsx)(a.SizableText,{my:"$4",size:"$heading2xl",children:r}):null,o?(0,l.jsx)(a.RichSizeableText,{size:"$bodyLg",color:"$textSubdued",linkList:i,children:o}):null]}),s?(0,l.jsx)(UpdateErrorTroubleshooting,{}):null]})}},853748:(e,r,n)=>{n.d(r,{_V:()=>EnterBootModeGuide,uH:()=>b,RH:()=>useFirmwareUpdateErrors});var t=n(586330),o=n(514041),a=n(813362),i=n(908867),s=n(490343),l=n(259227),d=n(726130),c=n(319357),u=n(514527),p=n(334439),m=n(117746),g=n(100645),h=n(610421);const f=n.p+"static/media/enter-boot-guide-mini.e82812de54d81a27fd02.png";var _=n(723337),w=n(225555),x=n(831085);function CommonError({message:e,title:r,icon:n,displayTroubleshooting:t}){var o=(0,i.A)();return(0,x.jsx)(_.u,{icon:n,tone:"destructive",title:r||o.formatMessage({id:p.ETranslations.global_an_error_occurred}),message:e,displayTroubleshooting:t})}function ShouldUpdateBridge({result:e}){var r=(0,i.A)();return(0,x.jsxs)(s.Stack,{children:[(0,x.jsx)(_.u,{icon:"InfoCircleOutline",title:r.formatMessage({id:p.ETranslations.update_outdated_version_detected}),message:r.formatMessage({id:p.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:d.F3}}}),(0,x.jsx)(w.nv,{onConfirm:function(){(0,m.Dr)(d.F3)},onConfirmText:r.formatMessage({id:p.ETranslations.global_view_tutorial})})]})}function ShouldUpdateByWeb(){var e=(0,i.A)();return(0,x.jsxs)(s.Stack,{children:[(0,x.jsx)(_.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:p.ETranslations.update_update_in_official_web_tool}),message:e.formatMessage({id:p.ETranslations.update_update_in_official_web_tool_desc}),linkList:{url:{url:d.BZ}}}),(0,x.jsx)(w.nv,{onConfirm:function(){(0,m.Dr)(d.BZ)},onConfirmText:e.formatMessage({id:p.ETranslations.global_visit_website})})]})}function HowToUpdateFullResource(){var e=(0,i.A)();return(0,x.jsxs)(s.Stack,{children:[(0,x.jsx)(_.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:p.ETranslations.update_outdated_version_detected}),message:e.formatMessage({id:p.ETranslations.update_outdated_version_detected_desc}),linkList:{url:{url:d.Kj}}}),(0,x.jsx)(w.nv,{onConfirm:function(){(0,m.Dr)(d.Kj)},onConfirmText:e.formatMessage({id:p.ETranslations.global_view_tutorial})})]})}function EnterBootModeGuide({deviceType:e}){var r=(0,i.A)();return"mini"===e?(0,x.jsxs)(s.Stack,{mb:"$6",children:[(0,x.jsx)(s.Image,{w:353,h:224,source:f}),(0,x.jsx)(s.SizableText,{size:"$headingMd",children:r.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode})}),(0,x.jsx)(s.SizableText,{mt:"$2",color:"$textSubdued",children:r.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode_desc})})]}):(0,x.jsx)(s.Stack,{mb:"$6",children:(0,x.jsx)(s.RichSizeableText,{mt:"$2",linkList:{url:{url:d.zz}},children:p.ETranslations.update_follow_online_tutorial_to_proceed_manually})})}function useFirmwareUpdateErrors({error:e,onRetry:r,result:n,lastFirmwareTipMessage:t}){var s=(0,i.A)(),l=s.formatMessage({id:p.ETranslations.global_retry});return(0,o.useMemo)((function(){if((0,u.R4)({error:e,code:[a.HardwareErrorCode.PinCancelled,a.HardwareErrorCode.ActionCancelled,a.HardwareErrorCode.DeviceInterruptedFromOutside]}))return{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",title:s.formatMessage({id:p.ETranslations.update_operation_canceled}),message:s.formatMessage({id:p.ETranslations.update_operation_canceled_desc})}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:a.HardwareErrorCode.FirmwareUpdateDownloadFailed}))return{content:(0,x.jsx)(CommonError,{icon:"DownloadOutline",title:s.formatMessage({id:p.ETranslations.update_download_failed}),message:s.formatMessage({id:p.ETranslations.update_check_connection_try_again})}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:a.HardwareErrorCode.PinInvalid}))return{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",message:s.formatMessage({id:p.ETranslations.hardware_invalid_pin_error})}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:a.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot})||(0,u.R4)({error:e,code:a.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure})||e&&t===g.rn.AutoRebootToBootloader)return{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",title:s.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode})}),detail:(0,x.jsx)(EnterBootModeGuide,{deviceType:n?.deviceType}),onRetryHandler:r,retryText:"mini"===n?.deviceType?s.formatMessage({id:p.ETranslations.update_verify_status_and_continue}):l};if((0,u.R4)({error:e,code:[a.HardwareErrorCode.BridgeNetworkError]}))return{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",title:s.formatMessage({id:p.ETranslations.update_bridge_network_error}),message:s.formatMessage({id:p.ETranslations.update_unable_to_connect_to_bridge})}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:[a.HardwareErrorCode.BridgeTimeoutError]}))return{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",title:s.formatMessage({id:p.ETranslations.update_bridge_timeout_error}),message:s.formatMessage({id:p.ETranslations.update_connection_to_bridge_timed_out})}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:[a.HardwareErrorCode.BridgeNotInstalled,c.o.NeedOneKeyBridge]}))return{content:(0,x.jsx)(_.u,{icon:"CrossedLargeOutline",tone:"destructive",title:s.formatMessage({id:p.ETranslations.update_bridge_not_installed}),message:s.formatMessage({id:p.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:d.F3}}}),onRetryHandler:r,retryText:l};if((0,u.R4)({error:e,code:c.o.NeedOneKeyBridgeUpgrade}))return{content:(0,x.jsx)(ShouldUpdateBridge,{result:n}),retryText:l};if((0,u.R4)({error:e,code:c.o.NeedFirmwareUpgradeFromWeb}))return{content:(0,x.jsx)(ShouldUpdateByWeb,{}),retryText:l};if((0,u.R4)({error:e,code:a.HardwareErrorCode.UseDesktopToUpdateFirmware}))return{content:(0,x.jsx)(HowToUpdateFullResource,{}),retryText:l};if(e){var o=e?.message;return 4500===e.code&&(o=s.formatMessage({id:p.ETranslations.feedback_hw_polling_time_out})),{content:(0,x.jsx)(CommonError,{icon:"CrossedLargeOutline",message:o,displayTroubleshooting:!0}),onRetryHandler:r,retryText:l}}return{content:null,retryText:l}}),[s,e,t,l,r,n])}var b={ShouldUpdateBridge,CommonError,EnterBootModeGuide,WorkflowErrors:function WorkflowErrors({onRetry:e,error:r,result:n}){var t=(0,i.A)(),{onRetryHandler:o,content:a,retryText:s}=useFirmwareUpdateErrors({error:r,onRetry:e,result:n,lastFirmwareTipMessage:void 0});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(w.nv,{onConfirm:o,onConfirmText:s||t.formatMessage({id:p.ETranslations.global_retry})}),a]})},InstallingErrors:function InstallingErrors({retryInfo:e,result:r,lastFirmwareTipMessage:n}){var a=(0,i.A)(),[,s]=(0,l.useFirmwareUpdateStepInfoAtom)(),d=(0,o.useCallback)((0,t.A)((function*(){if(!e)return null;s({step:l.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),yield h.A.serviceFirmwareUpdate.retryUpdateTask({id:e?.id,connectId:r?.updatingConnectId,releaseResult:r})})),[r,e,s]),{content:c,detail:u,onRetryHandler:m,retryText:g}=useFirmwareUpdateErrors({onRetry:d,result:r,lastFirmwareTipMessage:n,error:e?.error});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(w.nv,{onConfirm:m,onConfirmText:g||a.formatMessage({id:p.ETranslations.global_retry})}),c,u]})}}},225555:(e,r,n)=>{n.d(r,{nv:()=>l,oh:()=>FirmwareUpdatePageLayout});var t=n(908867),o=n(490343),a=n(334439),i=n(498356),s=n(831085);function FirmwareUpdatePageHeader(){var e=(0,t.A)();return(0,s.jsx)(o.Page.Header,{dismissOnOverlayPress:!1,title:e.formatMessage({id:a.ETranslations.update_hardware_update})})}var l=o.Page.Footer;function FirmwareUpdatePageLayout({children:e}){(0,i.A)();return(0,s.jsxs)(o.Stack,{children:[(0,s.jsx)(FirmwareUpdatePageHeader,{}),(0,s.jsx)(o.Page.Body,{children:(0,s.jsx)(o.Stack,{p:"$5",children:e})})]})}},99202:(e,r,n)=>{n.d(r,{D:()=>FirmwareUpdateProgressBar,w:()=>FirmwareUpdateProgressBarView});var t=n(460986),o=n.n(t),a=n(514041),i=n(908867),s=n(490343),l=n(259227),d=n(334439),c=n(284908),u=n(100645),p=n(610421),m=n(394764),g=n(443791),h=n(831085),f=10;function FirmwareUpdateProgressBarView({totalStep:e,currentStep:r,title:n,fromVersion:t,toVersion:o,progress:l,desc:c}){var u=(0,i.A)(),p=(0,a.useMemo)((function(){return e&&r?e<=1?null:(0,h.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:u.formatMessage({id:d.ETranslations.global_step_str},{step:`${r}/${e}`})}):(0,h.jsx)(s.Skeleton,{width:120,height:16})}),[u,r,e]),m=(0,a.useMemo)((function(){return o?(0,h.jsx)(g.Y,{fromVersion:t,toVersion:o}):(0,h.jsx)(s.Skeleton,{width:80,height:16})}),[t,o]);return(0,h.jsxs)(s.Stack,{py:"$6",children:[p,(0,h.jsx)(s.SizableText,{size:"$heading2xl",my:"$3",children:n}),m,(0,h.jsx)(s.Stack,{mt:"$12",mb:"$3",children:(0,h.jsx)(s.Progress,{size:"medium",value:l})}),(0,h.jsx)(s.SizableText,{size:"$bodyLg",color:"$textSubdued",children:c})]})}function FirmwareUpdateProgressBar({lastFirmwareTipMessage:e,isDone:r}){var n=(0,i.A)(),[t]=(0,l.useFirmwareUpdateStepInfoAtom)(),[g]=(0,l.useHardwareUiStateAtom)(),[_]=(0,l.useHardwareUiStateCompletedAtom)(),[w,x]=(0,a.useState)(1),[b]=(0,l.useFirmwareUpdateRetryAtom)(),v=(0,a.useRef)(w);v.current=w;var y=(0,a.useRef)(f),S=(0,a.useCallback)((function(){return n.formatMessage({id:d.ETranslations.global_checking_device})}),[n]),[j,k]=(0,a.useState)(S()),T=(0,a.useMemo)((function(){if(t?.step===l.EFirmwareUpdateSteps.installing)return t.payload.installingTarget?.updateInfo?.firmwareType||void 0}),[t.payload,t?.step]),{totalStep:F,currentStep:U}=(0,a.useMemo)((function(){if(t?.step===l.EFirmwareUpdateSteps.installing){var e=t?.payload?.installingTarget;if(e)return{totalStep:e.totalPhase.length,currentStep:e.totalPhase.findIndex((function(r){return r===e.currentPhase}))+1}}return{totalPhase:null,currentPhase:null}}),[t.payload,t?.step]),E=(0,a.useMemo)((function(){if(t?.step===l.EFirmwareUpdateSteps.installing)return{fromVersion:t.payload.installingTarget?.updateInfo.fromVersion||void 0,toVersion:t.payload.installingTarget?.updateInfo.toVersion||void 0}}),[t.payload,t?.step]),z=g?.payload?.firmwareTipData?.message,C=g?.payload?.firmwareProgress,M=c.A.isConfirmOnDeviceAction(g),$=([u.rn.CheckLatestUiResource,u.rn.DownloadLatestUiResource,u.rn.DownloadLatestUiResourceSuccess,u.rn.UpdateSysResource,u.rn.UpdateSysResourceSuccess].includes(e),(0,m.Z)(T)),I=(0,a.useRef)(C);I.current=C;var A=(0,a.useRef)([]),B=(0,a.useMemo)((function(){var t=n.formatMessage({id:d.ETranslations.global_preparing});return e&&(t=n.formatMessage({id:d.ETranslations.global_updating})),T&&(t=n.formatMessage({id:d.ETranslations.global_updating_type},{type:T}),"ble"===T&&(t=n.formatMessage({id:d.ETranslations.global_updating_type},{type:n.formatMessage({id:d.ETranslations.global_bluetooth})}))),r&&(t=n.formatMessage({id:d.ETranslations.global_done})),t}),[n,T,r,e]),R=(0,a.useCallback)((function(e){var r=[{type:["checking"],progress:function(){return 1},progressMax:function(){return f},desc:function(){return n.formatMessage({id:d.ETranslations.update_checking_device_if_no_restart})}},{type:[u.rn.CheckLatestUiResource],progress:function(){return 2},desc:function(){return n.formatMessage({id:d.ETranslations.update_checking_latest_ui_resources})}},{type:[u.rn.DownloadLatestUiResource],progress:function(){return 3},desc:function(){return n.formatMessage({id:d.ETranslations.update_downloading_latest_ui_resources})}},{type:[u.rn.DownloadLatestUiResourceSuccess],progress:function(){return 5},desc:function(){return n.formatMessage({id:d.ETranslations.update_download_success})}},{type:[u.rn.UpdateSysResource],progress:function(){return 7},desc:function(){return n.formatMessage({id:d.ETranslations.update_updating_ui_resources})}},{type:[u.rn.UpdateSysResourceSuccess],progress:function(){return 9},desc:function(){return n.formatMessage({id:d.ETranslations.update_update_ui_resources_success})}},{type:[u.rn.AutoRebootToBootloader],progress:function(){return 10},desc:function(){return n.formatMessage({id:d.ETranslations.update_reboot_to_bootloader_mode})}},{type:[u.rn.GoToBootloaderSuccess],progress:function(){return 12},desc:function(){return n.formatMessage({id:d.ETranslations.update_reboot_success})}},{type:[u.rn.DownloadFirmware,u.rn.DownloadLatestBootloaderResource],progress:function(){return 14},desc:function(){return n.formatMessage({id:d.ETranslations.update_downloading})}},{type:[u.rn.DownloadFirmwareSuccess,u.rn.DownloadLatestBootloaderResourceSuccess],progress:function(){return 20},desc:function(){return n.formatMessage({id:d.ETranslations.update_download_success})}},{type:[u.rn.FirmwareEraseSuccess],progress:function(){return 25},desc:function(){return n.formatMessage({id:d.ETranslations.update_transferring_data})}},{type:["installing"],progress:function(){var e,r=30+.7*(null!=(e=I.current)?e:0);return r>=99&&(r=99),r},desc:function(){return 100===I.current?n.formatMessage({id:d.ETranslations.update_installing}):n.formatMessage({id:d.ETranslations.update_transferring_data})}},{type:["done"],progress:function(){return 100},desc:function(){return n.formatMessage({id:d.ETranslations.update_update_completed})}}],t=r.findIndex((function(r){return r.type.includes(e)}));if(t>=0){var o,a=r[t],i=a.progress(),s=v.current;x((function(){var e=Math.max(i,s);return v.current=e,e})),k(a.desc());var l=r[t+1],c=null!=(o=a?.progressMax?.())?o:l?.progress();y.current=c||99}}),[n]),D=(0,a.useRef)(R);D.current=R,(0,a.useEffect)((function(){b||T&&$&&T!==$&&(x(1),v.current=1,y.current=99,D.current("checking"))}),[T,$,b]),(0,a.useEffect)((function(){t?.step!==l.EFirmwareUpdateSteps.updateStart&&T||k(S())}),[S,T,t?.step]),(0,a.useEffect)((function(){var e=setInterval((function(){if(!b&&!r&&!M){var e=v.current;x((function(){if(e>=y.current)return y.current;if(e>=99)return 99;var r=Math.min(e+1,y.current,99);return v.current=r,r}))}}),2e3);return function(){clearInterval(e)}}),[T,M,r,b]),(0,a.useEffect)((function(){r&&setTimeout((function(){D.current("done")}),1e3)}),[r]),(0,a.useEffect)((function(){z&&A.current.push(z)}),[z]),(0,a.useEffect)((function(){o()(C)&&D.current("installing")}),[C]),(0,a.useEffect)((function(){_?.action===l.EHardwareUiStateAction.CLOSE_UI_WINDOW&&p.A.serviceHardwareUI.closeHardwareUiStateDialog({skipDeviceCancel:!0,connectId:void 0})}),[_?.action]),(0,a.useEffect)((function(){e&&D.current(e)}),[e]);var[P,L]=(0,a.useState)(!1),N=(0,a.useMemo)((function(){0}),[C,e,w,P]);return(0,h.jsxs)(s.Stack,{children:[(0,h.jsx)(FirmwareUpdateProgressBarView,{totalStep:F,currentStep:U,title:B,progress:w,desc:j,fromVersion:E?.fromVersion,toVersion:E?.toVersion}),N]})}},355422:(e,r,n)=>{n.d(r,{N:()=>FirmwareUpdateWalletProfile});var t=n(908867),o=n(490343),a=n(334439),i=n(593827),s=n(831085);function DeviceAvatar({deviceType:e,size:r}){return(0,s.jsx)(i.L,{img:e||"unknown",wallet:void 0,size:r})}function FirmwareUpdateWalletProfile({result:e}){var r=(0,t.A)();return(0,s.jsxs)(o.Stack,{onPress:function(){},children:[(0,s.jsx)(DeviceAvatar,{size:"$14",deviceType:e?.deviceType||"unknown"}),(0,s.jsxs)(o.SizableText,{mt:"$5",size:"$heading2xl",children:[r.formatMessage({id:a.ETranslations.update_new_hardware_updates})," "]})]})}},296437:(e,r,n)=>{n.d(r,{Y:()=>FirmwareUpdateWarningMessage});var t=n(908867),o=n(490343),a=n(334439),i=(n(663522),n(831085));function FirmwareUpdateWarningMessage(){var e=(0,t.A)();return(0,i.jsx)(o.Alert,{type:"warning",title:e.formatMessage({id:a.ETranslations.update_keep_usb_connected_and_app_active}),fullBleed:!0,mx:"$-5"})}},443791:(e,r,n)=>{n.d(r,{Y:()=>FirmwareVersionProgressBar});var t=n(514041),o=n(908867),a=n(302722),i=n.n(a),s=n(490343),l=n(334439),d=n(831085);function FirmwareVersionProgressBar({fromVersion:e="",toVersion:r=""}){var n=(0,o.A)().formatMessage({id:l.ETranslations.global_unknown}),a=(0,t.useCallback)((function(e){return!!e&&(!!i().valid(e)&&!i().eq(e,"0.0.0"))}),[]);return(0,d.jsxs)(s.XStack,{gap:"$2.5",alignItems:"center",children:[(0,d.jsx)(s.Badge,{badgeType:"default",badgeSize:"lg",children:a(e)?e:n}),(0,d.jsx)(s.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,d.jsx)(s.Badge,{badgeType:"info",badgeSize:"lg",children:r?.length>0?r:n})]})}},349521:(e,r,n)=>{n.d(r,{F:()=>FirmwareUpdateReminderAlert,a:()=>HomeFirmwareUpdateReminder});var t=n(586330),o=n(514041),a=n(908867),i=n(490343),s=n(259227),l=n(334439),d=n(714191),c=n(610421),u=n(325809),p=n(498356),m=n(911998),g=n(162616),h=n(773831),f=n(318822);function BootloaderModeUpdateReminder(){var e=(0,p.A)(),r=(0,h.B)();return(0,o.useEffect)((function(){var fn=function(e){r.showBootloaderMode({connectId:e.connectId,existsFirmware:e.existsFirmware})};return f.iL.on(f.Tu.ShowFirmwareUpdateFromBootloaderMode,fn),function(){f.iL.off(f.Tu.ShowFirmwareUpdateFromBootloaderMode,fn)}}),[r,e]),null}var _=n(153763),w=n(491180),x=n(831085);function HomeFirmwareUpdateDetectCmp(){var{activeAccount:e}=(0,g.LH)({num:0}),r=e.device?.connectId,n=(0,_.E)(),t=(0,o.useMemo)((function(){return w.A.isHwWallet({walletId:e.wallet?.id})}),[e.wallet?.id]);return(0,o.useEffect)((function(){t&&r&&n&&c.A.serviceFirmwareUpdate.detectActiveAccountFirmwareUpdates({connectId:r})}),[t,r,n]),null}var b=(0,o.memo)((function HomeFirmwareUpdateDetectWithProvider(){var[e]=(0,s.useAppIsLockedAtom)();return e?null:(0,x.jsx)(u.b8,{config:{sceneName:d.Zs.home},enabledNum:[0],children:(0,x.jsx)(HomeFirmwareUpdateDetectCmp,{})})}));function FirmwareUpdateReminderAlert({message:e,onPress:r}){var n=(0,a.A)();return(0,x.jsxs)(i.XStack,{px:"$5",py:"$2",borderTopWidth:"$px",borderBottomWidth:"$px",bg:"$bgInfoSubdued",borderColor:"$borderInfoSubdued",alignItems:"center",gap:"$2",flex:1,children:[(0,x.jsx)(i.Icon,{size:"$4",name:"DownloadOutline",color:"$iconInfo"}),(0,x.jsx)(i.SizableText,{flex:1,size:"$bodyMdMedium",color:"$text",numberOfLines:1,children:e}),(0,x.jsx)(i.Button,{size:"small",onPress:r,children:n.formatMessage({id:l.ETranslations.global_view})})]})}function HomeFirmwareUpdateReminderCmp(){var e=(0,a.A)(),{activeAccount:r}=(0,g.LH)({num:0}),n=r.device?.connectId,d=(0,h.B)(),[u]=(0,s.useFirmwareUpdatesDetectStatusAtom)(),{result:f}=((0,p.A)(),(0,m.yk)((0,t.A)((function*(){if(n){var e=u?.[n],r=e?.connectId===n&&e?.hasUpgrade;yield c.A.serviceFirmwareUpdate.getFirmwareUpdateDetectInfo({connectId:n});return{shouldUpdate:r,detectResult:e}}})),[n,u])),_=(0,o.useMemo)((function(){if(f?.shouldUpdate){var r="New firmware is available";return f?.detectResult?.toVersion?r=e.formatMessage({id:l.ETranslations.update_firmware_version_available},{version:f?.detectResult?.toVersion}):f?.detectResult?.toVersionBle&&(r=e.formatMessage({id:l.ETranslations.update_bluetooth_version_available},{version:f?.detectResult?.toVersionBle})),(0,x.jsx)(FirmwareUpdateReminderAlert,{message:r,onPress:(0,t.A)((function*(){d.openChangeLogModal({connectId:n})}))})}return null}),[e,d,n,f]);return(0,x.jsxs)(i.XStack,{children:[(0,x.jsx)(b,{}),(0,x.jsx)(BootloaderModeUpdateReminder,{}),_]})}function HomeFirmwareUpdateReminder(){return(0,x.jsx)(u.b8,{config:{sceneName:d.Zs.home},enabledNum:[0],children:(0,x.jsx)(HomeFirmwareUpdateReminderCmp,{})})}},898915:(e,r,n)=>{n.r(r),n.d(r,{default:()=>u});var t=n(490343),o=n(324586),a=n(586330),i=n(514041),s=n(791088),l=n(57597),d=n(259227),c=n(831085);function ownKeys(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(n),!0).forEach((function(r){(0,o.A)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function FirmwareUpdateSectionFieldItem({name:e,title:r,titleProps:n={color:"$textCritical"},children:t,onValueChange:o,testID:l=""}){var u,[p,m]=(0,d.useFirmwareUpdateDevSettingsPersistAtom)(),g=i.Children.only(t),h=e?p?.[e]:"",f=(0,i.useCallback)((u=(0,a.A)((function*(r){e&&(m((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:r})})),o?.(r))})),function(e){return u.apply(this,arguments)}),[e,o,m]),_=g?(0,i.cloneElement)(g,_objectSpread(_objectSpread({},g.props),{},{value:h,onChange:f})):null;return(0,c.jsx)(s.c,{title:r,titleProps:n,testID:l,children:_})}function FirmwareUpdateDevSettings(){var[e]=(0,d.useFirmwareUpdateDevSettingsPersistAtom)();return(0,c.jsxs)(t.YStack,{children:[(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"lowBatteryLevel",title:"Low Battery",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateBridge",title:"Should Update Bridge",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateFullRes",title:"Should Update Full Resouces",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"shouldUpdateFromWeb",title:"Should Update from web",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"allIsUpToDate",title:"All is up to date",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"usePreReleaseConfig",title:"Use pre-release config",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"forceUpdateResEvenSameVersion",title:"Force update res even same version",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"forceUpdateFirmware",title:"Force update firmware",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"forceUpdateBle",title:"Force update bluetooth",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"forceUpdateBootloader",title:"Force update bootloader",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"showAutoCheckHardwareUpdatesToast",title:"Show Auto Check Hardware Updates Toast",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(FirmwareUpdateSectionFieldItem,{name:"showDeviceDebugLogs",title:"Show Device Debug Log",children:(0,c.jsx)(t.Switch,{size:t.ESwitchSize.small})}),(0,c.jsx)(t.SizableText,{children:JSON.stringify(e,null,2)}),(0,c.jsx)(l.FirmwareUpdateGalleryDemo,{})]})}const u=function PageFirmwareUpdateDevSettings(){return(0,c.jsxs)(t.Page,{scrollEnabled:!0,children:[(0,c.jsx)(t.Page.Header,{title:"FirmwareUpdateDevSettings"}),(0,c.jsx)(FirmwareUpdateDevSettings,{})]})}}}]);