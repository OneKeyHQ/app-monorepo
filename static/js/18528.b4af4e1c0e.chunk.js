"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[18528],{82506:(e,n,t)=>{t.d(n,{d:()=>useDebounce});var o=t(578104);function useDebounce(e,n,t){var[c]=(0,o.d7)(e,n,t);return c}},278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),c=t.n(o),r=t(324586),i=t(586330),a=t(514041),u=t(908867),s=t(17617),l=t(490343),d=t(610421),p=t(325809),m=t(237532),f=t(24284),g=t(911998),A=t(162616),h=t(226952),b=t(334439),y=(t(663522),t(584186)),I=t(714191),j=t(82506);var S=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,r.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function DAppAccountListInitFromHome({num:e,shouldSyncFromHome:n}){var[,t]=(0,A.K7)(),o=(0,A.z$)();return(0,a.useEffect)((function(){return(0,i.A)((function*(){try{t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!0}})})),yield y.A.wait(600),n&&(yield o.current.syncFromScene({from:{sceneName:I.Zs.home,sceneNum:0},num:e}))}finally{n&&(yield y.A.wait(300)),t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}))(),function(){t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}),[o,e,t,n]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:c,initFromHome:r,beforeShowTrigger:i,skeletonRenderDuration:u}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,A.LH)({num:e}),{selectedAccount:o}=(0,A.wz)({num:e}),c=(0,j.d)(t,200),r=(0,j.d)(o,200),i=(0,a.useRef)(t),u=(0,a.useRef)(o);(0,a.useEffect)((function(){i.current=t,u.current=o}),[t,o]),(0,a.useEffect)((function(){n&&(c.isOthersWallet&&c.account?.id===r.othersWalletAccountId||c.indexedAccount?.id===r.indexedAccountId)&&n({activeAccount:i.current,selectedAccount:u.current},e)}),[c,r,n,e])}({num:e,handleAccountChanged:n});var d=Boolean(r&&!t);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(l.YGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:s.A.hairlineWidth,separator:(0,S.jsx)(l.Divider,{}),disabled:t,children:[(0,S.jsx)(l.YGroup.Item,{children:(0,S.jsx)(p.jY,{num:e,beforeShowTrigger:i,disabled:o||t,loadingDuration:0})}),(0,S.jsx)(l.YGroup.Item,{children:(0,S.jsx)(m.Up,{num:e,compressionUiMode:c,beforeShowTrigger:i,loadingDuration:0})})]}),(0,S.jsx)(DAppAccountListInitFromHome,{num:e,shouldSyncFromHome:d})]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var o=(0,u.A)(),{serviceDApp:r,serviceNetwork:s}=d.A,{$sourceInfo:m}=(0,f.A)(),{result:A}=(0,g.yk)((0,i.A)((function*(){var e,n;if(!m?.origin||!m.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,h.zg)(m.scope),o=t?(yield s.getNetworkIdsByImpls({impls:t})).networkIds:null,c=yield r.getConnectedAccountsInfo({origin:m.origin,scope:null!=(e=m.scope)?e:"",isWalletConnectRequest:m.isWalletConnectRequest});return Array.isArray(c)&&c.length>0&&"number"==typeof c[0]?.num?{accountSelectorNum:c[0].num,networkIds:o,existConnectedAccount:!0}:{accountSelectorNum:yield r.getAccountSelectorNum({origin:m.origin,scope:null!=(n=m.scope)?n:"",isWalletConnectRequest:m.isWalletConnectRequest}),networkIds:o,existConnectedAccount:!1}})),[m?.origin,m?.scope,m?.isWalletConnectRequest,r,s]);return(0,a.useEffect)((function(){c()(A?.accountSelectorNum)&&t&&t({num:A.accountSelectorNum,existConnectedAccount:A.existConnectedAccount})}),[A?.accountSelectorNum,A?.existConnectedAccount,t]),(0,S.jsxs)(l.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,S.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:o.formatMessage({id:b.ETranslations.global_accounts})}),"number"==typeof A?.accountSelectorNum&&Array.isArray(A?.networkIds)?(0,S.jsx)(p.b8,{config:{sceneName:I.Zs.discover,sceneUrl:m?.origin},enabledNum:[A.accountSelectorNum],availableNetworksMap:{[A.accountSelectorNum]:{networkIds:A.networkIds}},children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!A?.existConnectedAccount,num:A?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){var e=(0,u.A)();return(0,S.jsxs)(l.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,S.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:e.formatMessage({id:b.ETranslations.global_accounts})}),(0,S.jsx)(p.b8,{config:{sceneName:I.Zs.home},enabledNum:[0],children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),c=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,S.jsxs)(l.YStack,{gap:"$2",children:[(0,S.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,S.jsx)(p.b8,{config:{sceneName:I.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:c,children:(0,S.jsx)(l.YStack,{gap:"$2",children:n.map((function(e){return(0,S.jsx)(l.Stack,{children:(0,S.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},618528:(e,n,t)=>{t.r(n),t.d(n,{default:()=>b});var o=t(586330),c=t(514041),r=t(908867),i=t(490343),a=t(334439),u=t(610421),s=t(911998),l=t(233693),d=t(324586),p=t(325809),m=t(928557),f=t(714191),g=t(278484),A=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,d.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const h=function ConnectionListItem({item:e,handleDisconnect:n,handleAccountChanged:t}){return(0,A.jsxs)(i.YStack,{gap:"$5",p:"$5",children:[(0,A.jsxs)(i.XStack,{alignItems:"center",justifyContent:"space-between",gap:"$3",children:[(0,A.jsxs)(i.XStack,{flex:1,alignItems:"center",gap:"$3",children:[(0,A.jsxs)(i.Image,{size:"$10",borderRadius:"$full",children:[(0,A.jsx)(i.Image.Source,{src:e.imageURL}),(0,A.jsx)(i.Image.Fallback,{children:(0,A.jsx)(i.Icon,{size:"$10",name:"GlobusOutline"})}),(0,A.jsx)(i.Image.Loading,{children:(0,A.jsx)(i.Skeleton,{width:"100%",height:"100%"})})]}),(0,A.jsx)(i.SizableText,{size:"$bodyLgMedium",color:"$text",numberOfLines:3,style:{wordBreak:"break-all"},children:new URL(e.origin).hostname})]}),(0,A.jsx)(i.XStack,{p:"$1.5",m:"-$1.5",borderRadius:"$2",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusVisibleStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid"},onPress:function(){n(e.origin,e.storageType)},children:(0,A.jsx)(i.Icon,{name:"BrokenLinkOutline",color:"$iconSubdued",size:"$6"})})]}),(0,A.jsx)(p.b8,{config:{sceneName:f.Zs.discover,sceneUrl:e.origin},enabledNum:Object.keys(e.connectionMap).map((function(e){return Number(e)})),availableNetworksMap:e.availableNetworksMap,children:(0,A.jsx)(i.YStack,{gap:"$2",children:Object.keys(e.connectionMap).map((function(n){return(0,A.jsx)(g.wI,{num:Number(n),handleAccountChanged:function(o){t({handleAccountChangedParams:o,num:Number(n),origin:e.origin,prevAccountInfo:_objectSpread(_objectSpread({},e.connectionMap[Number(n)]),{},{num:Number(n),storageType:e.storageType})})},readonly:(o=e.connectionMap[Number(n)],"walletConnect"===e.storageType&&o.networkImpl===m.bO)},n);var o}))})})]})};var ItemSeparatorComponent=function(){return(0,A.jsx)(i.Divider,{})};function ConnectionListEmpty(){var e=(0,r.A)();return(0,A.jsx)(i.Empty,{flex:1,icon:"LinkSolid",title:e.formatMessage({id:a.ETranslations.explore_no_dapps_connected}),description:e.formatMessage({id:a.ETranslations.explore_no_dapps_connected_message})})}const b=function ConnectionList(){var e=(0,r.A)(),{serviceDApp:n}=u.A,[t,d]=(0,c.useState)([]),[p,m]=(0,c.useState)(0),{result:f,run:g}=(0,s.yk)((0,o.A)((function*(){return n.getAllConnectedList()})),[n],{checkIsFocused:!1});(0,c.useEffect)((function(){d((function(){var e=6*p+6;return(null!=f?f:[]).slice(0,e)}))}),[f,p]);var b,y=(0,c.useCallback)((0,o.A)((function*(){var e=p+1,n=6*e,t=n+6,o=(null!=f?f:[]).slice(n,t);o.length>0&&(d((function(e){return[...e,...o]})),m(e))})),[f,p]),I=(0,c.useCallback)((b=(0,o.A)((function*(e,t){yield n.disconnectWebsite({origin:e,storageType:t,entry:"SettingModal"}),g()})),function(e,n){return b.apply(this,arguments)}),[g,n]),j=(0,c.useCallback)((function(){return(0,A.jsx)(i.Button,{variant:"tertiary",size:"medium",onPress:(0,o.A)((function*(){yield n.disconnectAllWebsites(),g()})),children:e.formatMessage({id:a.ETranslations.explore_remove_all})})}),[g,n,e]),{handleAccountInfoChanged:S}=(0,l.Q)();return(0,A.jsxs)(i.Page,{children:[(0,A.jsx)(i.Page.Header,{title:e.formatMessage({id:a.ETranslations.explore_dapp_connections}),headerRight:function(){return j()}}),(0,A.jsx)(i.Page.Body,{children:(0,A.jsx)(i.ListView,{contentContainerStyle:{flex:1},estimatedItemSize:199,scrollEnabled:!0,data:t,ListEmptyComponent:ConnectionListEmpty,keyExtractor:function(e){return e.origin},renderItem:function({item:e}){return(0,A.jsx)(h,{item:e,handleDisconnect:I,handleAccountChanged:function({origin:e,num:n,handleAccountChangedParams:t,prevAccountInfo:o}){S({origin:e,accountSelectorNum:n,prevAccountInfo:o,accountChangedParams:t,storageType:o.storageType,afterUpdate:function(){return g()}})}})},ItemSeparatorComponent,onEndReached:function(){y()},onEndReachedThreshold:1})})]})}},233693:(e,n,t)=>{t.d(n,{Q:()=>useShouldUpdateConnectedAccount});var o=t(586330),c=t(797331),r=t.n(c),i=t(514041);t(663522),t(392097);var a=t(553083),u=t(610421),s=(t(317522),t(394764),t(660015),t(574319),{"https://wallet.keplr.app":!0});r()((function(e,n){var t=new URL(e).origin;"domReady"===n&&s[t]||(u.A.serviceDApp.notifyDAppAccountsChanged(t),u.A.serviceDApp.notifyDAppChainChanged(t))}),800);function useShouldUpdateConnectedAccount(){var e,n=(0,i.useCallback)((function(e,n){var t=e.walletId!==n.walletId||e.indexedAccountId!==n.indexedAccountId||e.networkId!==n.networkId||e.accountId!==n.accountId||e.address!==n.address,o=n.accountId&&n.walletId&&(a.Ay.isLightningNetworkByNetworkId(n.networkId)||n.address)&&n.networkId;return e&&t&&o}),[]),t=(0,i.useCallback)((function({activeAccount:e,selectedAccount:n}){var t,o,c,r,i,a;return{walletId:null!=(t=e.wallet?.id)?t:"",indexedAccountId:null!=(o=e.indexedAccount?.id)?o:"",networkId:null!=(c=e.network?.id)?c:"",accountId:null!=(r=e.account?.id)?r:"",address:null!=(i=e.account?.address)?i:"",networkImpl:null!=(a=e.network?.impl)?a:"",deriveType:e.deriveType,focusedWallet:n.focusedWallet,othersWalletAccountId:n.othersWalletAccountId}}),[]),c=(0,i.useCallback)((e=(0,o.A)((function*({origin:e,accountSelectorNum:o,prevAccountInfo:c,accountChangedParams:r,storageType:i,afterUpdate:a}){var s=t(r);if(n(c,s)){var{serviceDApp:l}=u.A;yield u.A.serviceDApp.updateConnectionSession({origin:e,accountSelectorNum:o,updatedAccountInfo:s,storageType:i}),a(),c.accountId!==s.accountId&&l.notifyDAppAccountsChanged(e),c.networkId!==s.networkId&&l.notifyDAppChainChanged(e)}})),function(n){return e.apply(this,arguments)}),[t,n]);return{handleAccountInfoChanged:c}}}}]);