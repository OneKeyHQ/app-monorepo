"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3036],{424403:(e,t,n)=>{n.d(t,{KR:()=>useCheckAccountExist,Mo:()=>useAccountInfoForManageToken,YF:()=>useAddToken,yT:()=>useAddTokenForm});var o=n(586330),r=n(514041),s=n(241440),a=n(578104),c=n(490343),d=n(625931),i=n(553083),u=n(610421),l=n(911998);function useAddTokenForm({token:e,networkId:t}){var n=i.Ay.isAllNetwork({networkId:t}),o=(0,r.useCallback)((function(){return e&&e.networkId?e.networkId:n?(0,d.V)().eth:t}),[n,t,e]),a=(0,c.useForm)({values:{networkId:o(),contractAddress:e?.address||"",symbol:e?.symbol||"",decimals:e?.decimals?new s.A(e.decimals).toString():""},mode:"onChange",reValidateMode:"onBlur"}),u=a.watch("networkId"),l=a.watch("contractAddress"),k=a.watch("symbol"),m=a.watch("decimals"),[f,w]=(0,r.useState)(!1),I=(0,r.useRef)(!0),h=(0,r.useCallback)((function(t){I.current||(e?.address||l)&&w(t)}),[l,e?.address]);return(0,r.useEffect)((function(){I.current?I.current=!1:a.trigger("contractAddress")}),[f,a]),{form:a,isEmptyContract:f,setIsEmptyContractState:h,selectedNetworkIdValue:u,contractAddressValue:l,symbolValue:k,decimalsValue:m}}function useAddToken({token:e,walletId:t,networkId:n,form:c,selectedNetworkIdValue:d,contractAddressValue:i,setIsEmptyContractState:k}){var m,{result:f}=(0,l.yk)((0,o.A)((function*(){var t=(yield u.A.serviceNetwork.getCustomTokenEnabledNetworks({currentNetworkId:n})).map((function(e){return e.id})),o=yield u.A.serviceNetwork.getNetwork({networkId:n});return e?.networkId&&!t.includes(e.networkId)&&t.push(e.networkId),{networkIds:t,network:o}})),[n,e?.networkId]),w=(0,r.useRef)(),I=(0,a.YQ)((m=(0,o.A)((function*(n){var o;if(!e&&!n.value.trim())return c.setValue("symbol",""),c.setValue("decimals",""),void k(!0);var r=yield u.A.serviceCustomToken.searchTokenByContractAddress({walletId:t,networkId:n.networkId,contractAddress:n.value.trim(),isNative:null!=(o=e?.isNative)&&o});if(Array.isArray(r)&&r.length>0&&r[0]?.info){var[a]=r;c.setValue("symbol",a.info.symbol),c.setValue("decimals",new s.A(a.info.decimals).toString()),w.current=a.info,k(!1)}else c.setValue("symbol",""),c.setValue("decimals",""),k(!0)})),function(e){return m.apply(this,arguments)}),300);return(0,r.useEffect)((function(){I({value:i,networkId:d})}),[i,d,I]),{availableNetworks:f,searchedTokenRef:w}}function useAccountInfoForManageToken(){var e,t=(0,r.useCallback)((e=(0,o.A)((function*({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:o,deriveType:r,selectedNetworkId:s}){var{serviceAccount:a}=u.A,c=!1,d="";try{d=n?(yield a.getAccount({accountId:e,networkId:t})).id:(yield a.getNetworkAccount({accountId:void 0,indexedAccountId:o,networkId:s,deriveType:r})).id,c=!0}catch(e){c=!1}return{hasExistAccountFlag:c,accountIdForNetwork:d}})),function(t){return e.apply(this,arguments)}),[]);return{findAccountInfoForNetwork:t}}function useCheckAccountExist({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkIdValue:c}){var{findAccountInfoForNetwork:d}=useAccountInfoForManageToken(),i=(0,r.useCallback)((0,o.A)((function*(){return d({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkId:c})})),[e,s,t,n,a,c,d]),{result:u,run:k}=(0,l.yk)((0,o.A)((function*(){var{hasExistAccountFlag:e}=yield i();return e})),[i]);return{hasExistAccount:u,runCheckAccountExist:k,checkAccountIsExist:i}}},3036:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var o=n(324586),r=n(586330),s=n(514041),a=n(654266),c=n(908867),d=n(490343),i=n(625931),u=n(318822),l=n(334439),k=n(392097),m=n(610421),f=n(498356),w=n(208257),I=n(791088),h=n(562428),g=(n(663522),n(553083)),y=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ListHeaderComponent({onAddCustomToken:e}){var t=(0,c.A)();return(0,y.jsx)(I.c,{title:t.formatMessage({id:l.ETranslations.manage_token_custom_token_title}),drillIn:!0,onPress:e})}function ListEmptyComponent({onAddCustomToken:e,isLoading:t}){var n=(0,c.A)();return t?null:(0,y.jsx)(d.Empty,{flex:1,icon:"SearchOutline",title:n.formatMessage({id:l.ETranslations.global_no_results}),description:n.formatMessage({id:l.ETranslations.manage_token_empty_msg}),button:(0,y.jsx)(d.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return e()},children:n.formatMessage({id:l.ETranslations.manage_token_custom_token_button})})})}function ListFooterComponent({searchValue:e,searchResult:t,onAddCustomToken:n}){var o=(0,c.A)();return e.length&&Array.isArray(t)&&t.length?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(d.Divider,{pt:"$5"}),(0,y.jsxs)(d.YStack,{p:"$5",alignItems:"center",children:[(0,y.jsx)(d.SizableText,{textAlign:"center",size:"$bodyMd",maxWidth:void 0,children:o.formatMessage({id:l.ETranslations.manage_token_empty_msg})}),(0,y.jsx)(d.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return n()},children:o.formatMessage({id:l.ETranslations.manage_token_custom_token_button})})]})]}):null}function SkeletonList(){return Array.from({length:5}).map((function(e,t){return(0,y.jsx)(I.c,{children:(0,y.jsxs)(d.XStack,{alignItems:"center",gap:"$3",children:[(0,y.jsx)(d.Skeleton,{width:"$10",height:"$10",radius:"round"}),(0,y.jsxs)(d.YStack,{gap:"$2",children:[(0,y.jsx)(d.Skeleton,{w:120,h:12,borderRadius:"$3"}),(0,y.jsx)(d.Skeleton,{w:80,h:12,borderRadius:"$3"})]})]})},t)}))}function TokenManagerList({dataSource:e,onAddCustomToken:t,onHiddenToken:n,isLoadingRemoteData:o,isLoadingLocalData:r,networkId:s,isAllNetwork:a,networkMaps:i,checkTokenExistInTokenList:u,searchValue:k,searchResult:m,showListHeader:f=!0}){var w=(0,c.A)(),{bottom:p}=(0,d.useSafeAreaInsets)();return o||!e?(0,y.jsx)(SkeletonList,{}):(0,y.jsx)(d.SectionList,{ListHeaderComponent:f?(0,y.jsx)(ListHeaderComponent,{onAddCustomToken:t}):null,sections:e,estimatedItemSize:60,renderSectionHeader:function({section:{title:e,data:n}}){return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(d.SizableText,{mt:10,px:"$5",size:"$bodyMd",color:"$textSubdued",children:e}),Array.isArray(n)&&!n.length?(0,y.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}):null]})},keyExtractor:function(e){return e.$key},renderItem:function({item:e}){var o,r,c;return(0,y.jsxs)(I.c,{children:[(0,y.jsx)(h.G,{icon:e.logoURI,networkId:null!=(o=e.networkId)?o:s,isAllNetworks:!0}),(0,y.jsxs)(d.YStack,{flex:1,children:[(0,y.jsxs)(d.XStack,{gap:"$2",alignItems:"center",children:[(0,y.jsx)(d.SizableText,{size:"$bodyLgMedium",color:"$text",children:e.symbol}),a?(0,y.jsx)(d.Badge,{children:null!=(r=i?.[null!=(c=e.networkId)?c:""]?.name)?r:""}):null]}),(0,y.jsx)(d.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e.name})]}),(0,y.jsx)(I.c.IconButton,_objectSpread({disabled:!(!u(e)||!g.Ay.isBTCNetwork(e.networkId)),title:u(e)&&g.Ay.isBTCNetwork(e.networkId)?w.formatMessage({id:l.ETranslations.manage_token_native_token_cannot_removed}):void 0,icon:u(e)?"MinusCircleOutline":"PlusCircleOutline",onPress:function(){return u(e)?n(e):t(e)}},u(e)&&{iconProps:{color:"$iconCritical"}}))]})},ListFooterComponent:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ListFooterComponent,{searchValue:k,searchResult:m,onAddCustomToken:t}),(0,y.jsx)(d.Stack,{h:p||"$3"})]}),ListEmptyComponent:(0,y.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}),keyboardDismissMode:"on-drag"})}var p=n(424403),A=n(911998),T=n(384013);var b=n(712784),v=n.n(b);function TokenManagerModal_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function TokenManagerModal_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TokenManagerModal_ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TokenManagerModal_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TokenManagerModal(){var e,t=(0,c.A)(),n=(0,f.A)(),o=(0,a.lq)(),{walletId:w,isOthersWallet:I,indexedAccountId:h,networkId:g,accountId:b,deriveType:x}=o.params,j=g===(0,i.V)().onekeyall,{sectionTokens:M,refreshTokenLists:_,isLoadingLocalData:C,networkMaps:S,checkTokenExistInTokenList:L}=function useTokenManagement({networkId:e,accountId:t}){var n=(0,c.A)(),o=e===(0,i.V)().onekeyall,[a]=(0,T.RI)(),{result:d,run:u,isLoading:k}=(0,A.yk)((0,r.A)((function*(){var[r,s]=yield Promise.all([m.A.serviceCustomToken.getHiddenTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0}),m.A.serviceCustomToken.getCustomTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0})]),c=[...a.tokens,...s].filter((function(e,t,n){return t===n.findIndex((function(t){return t.networkId===e.networkId&&t.accountId===e.accountId&&t.address===e.address}))})).filter((function(e){return!r.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))})),d=[{title:n.formatMessage({id:l.ETranslations.manage_token_added_token}),data:c}];return r.length&&d.push({title:n.formatMessage({id:l.ETranslations.manage_token_popular_token}),data:r}),{sectionTokens:d,addedTokens:c}})),[a,t,e,o,n],{checkIsFocused:!1,watchLoading:!0}),{result:f}=(0,A.yk)((0,r.A)((function*(){return(yield m.A.serviceNetwork.getAllNetworks()).networks.reduce((function(e,t){return e[t.id]=t,e}),{})})),[],{initResult:{}}),w=(0,s.useCallback)((function(e){return d?.addedTokens?.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))}),[d?.addedTokens]);return{sectionTokens:d?.sectionTokens,tokenList:d?.addedTokens,refreshTokenLists:u,isLoadingLocalData:k,networkMaps:f,checkTokenExistInTokenList:w}}({networkId:g,accountId:b}),{searchValue:O,searchResult:E,isSearchMode:N,setSearchValue:$,isLoadingRemoteData:V}=function useTokenSearch({walletId:e,networkId:t,accountId:n}){var o,[a,c]=(0,s.useState)(!1),[d,i]=(0,s.useState)(""),[u,l]=(0,s.useState)(null),k=(0,s.useRef)(v()((o=(0,r.A)((function*(e){c(!0);try{var t=yield m.A.serviceCustomToken.searchTokenByKeywords({walletId:e.walletId,accountId:e.accountId,networkId:e.networkId,keywords:e.searchValue}),n=t?.map((function(e){var t,{price:n,price24h:o,info:r}=e;return{$key:`search__${null!=(t=r.networkId)?t:""}_${r.address}_${r.isNative?"native":"token"}`,address:r.address,decimals:r.decimals,isNative:r.isNative,logoURI:r.logoURI,name:r.name,symbol:r.symbol,riskLevel:r.riskLevel,networkId:r.networkId,price:n,price24h:o}}));l(n)}catch(e){}finally{c(!1)}})),function(e){return o.apply(this,arguments)}),500)).current;(0,s.useEffect)((function(){if(d)return k({walletId:e,networkId:t,accountId:n,searchValue:d}),function(){k.cancel()};l(null)}),[d,t,e,n,k]);var f=(0,s.useMemo)((function(){return d&&d.length>0}),[d]);return{searchValue:d,searchResult:u,isSearchMode:f,setSearchValue:i,isLoadingRemoteData:a}}({walletId:w,networkId:g,accountId:b}),P=(0,s.useMemo)((function(){return N&&Array.isArray(E)?[{title:"",data:E}]:M}),[N,E,M]),R=(0,s.useRef)(!1),F=(0,s.useCallback)((function(e){n.push(k.jX.AddCustomTokenModal,{walletId:w,isOthersWallet:I,indexedAccountId:h,networkId:g,accountId:b,deriveType:x,token:e,onSuccess:function(){_(),R.current=!0}})}),[n,w,I,h,g,b,x,_]),{findAccountInfoForNetwork:D}=(0,p.Mo)(),z=(0,s.useCallback)((e=(0,r.A)((function*(e){var n,o,{accountIdForNetwork:r}=yield D({accountId:b,networkId:g,isOthersWallet:I,indexedAccountId:h,deriveType:x,selectedNetworkId:null!=(n=e.networkId)?n:g});yield m.A.serviceCustomToken.hideToken({token:TokenManagerModal_objectSpread(TokenManagerModal_objectSpread({},e),{},{accountId:r,networkId:null!=(o=e.networkId)?o:g,allNetworkAccountId:j?b:void 0})}),R.current=!0,setTimeout((function(){_(),d.Toast.success({title:t.formatMessage({id:l.ETranslations.address_book_add_address_toast_delete_success})})}),200)})),function(t){return e.apply(this,arguments)}),[_,b,g,I,h,x,t,j,D]);return(0,y.jsxs)(d.Page,{safeAreaEnabled:!1,onClose:function(){R.current&&u.iL.emit(u.Tu.RefreshTokenList,void 0)},children:[(0,y.jsx)(d.Page.Header,{title:t.formatMessage({id:l.ETranslations.manage_token_title})}),(0,y.jsxs)(d.Page.Body,{children:[(0,y.jsx)(d.Stack,{px:"$5",pb:"$4",children:(0,y.jsx)(d.SearchBar,{placeholder:t.formatMessage({id:l.ETranslations.token_selector_search_placeholder}),autoFocus:!0,zIndex:20,selectTextOnFocus:!0,value:O,onSearchTextChange:$,onSubmitEditing:function(){}})}),(0,y.jsx)(TokenManagerList,{dataSource:P,onAddCustomToken:F,onHiddenToken:z,isLoadingRemoteData:V,isLoadingLocalData:C,networkId:g,isAllNetwork:j,networkMaps:S,checkTokenExistInTokenList:L,searchValue:O,searchResult:E,showListHeader:!N})]})]})}const x=function TokenManagerModalContainer(){return(0,y.jsx)(w.p,{children:(0,y.jsx)(TokenManagerModal,{})})}}}]);