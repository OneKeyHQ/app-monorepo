"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[81182],{424403:(e,t,n)=>{n.d(t,{KR:()=>useCheckAccountExist,Mo:()=>useAccountInfoForManageToken,YF:()=>useAddToken,yT:()=>useAddTokenForm});var r=n(586330),o=n(514041),s=n(241440),a=n(578104),d=n(490343),c=n(625931),i=n(553083),l=n(610421),u=n(911998);function useAddTokenForm({token:e,networkId:t}){var n=i.Ay.isAllNetwork({networkId:t}),r=(0,o.useCallback)((function(){return e&&e.networkId?e.networkId:n?(0,c.V)().eth:t}),[n,t,e]),a=(0,d.useForm)({values:{networkId:r(),contractAddress:e?.address||"",symbol:e?.symbol||"",decimals:e?.decimals?new s.A(e.decimals).toString():""},mode:"onChange",reValidateMode:"onBlur"}),l=a.watch("networkId"),u=a.watch("contractAddress"),k=a.watch("symbol"),m=a.watch("decimals"),[f,w]=(0,o.useState)(!1),I=(0,o.useRef)(!0),g=(0,o.useCallback)((function(t){I.current||(e?.address||u)&&w(t)}),[u,e?.address]);return(0,o.useEffect)((function(){I.current?I.current=!1:a.trigger("contractAddress")}),[f,a]),{form:a,isEmptyContract:f,setIsEmptyContractState:g,selectedNetworkIdValue:l,contractAddressValue:u,symbolValue:k,decimalsValue:m}}function useAddToken({token:e,walletId:t,networkId:n,form:d,selectedNetworkIdValue:c,contractAddressValue:i,setIsEmptyContractState:k}){var m,{result:f}=(0,u.yk)((0,r.A)((function*(){var t=(yield l.A.serviceNetwork.getCustomTokenEnabledNetworks({currentNetworkId:n})).map((function(e){return e.id})),r=yield l.A.serviceNetwork.getNetwork({networkId:n});return e?.networkId&&!t.includes(e.networkId)&&t.push(e.networkId),{networkIds:t,network:r}})),[n,e?.networkId]),w=(0,o.useRef)(),I=(0,a.YQ)((m=(0,r.A)((function*(n){var r;if(!e&&!n.value.trim())return d.setValue("symbol",""),d.setValue("decimals",""),void k(!0);var o=yield l.A.serviceCustomToken.searchTokenByContractAddress({walletId:t,networkId:n.networkId,contractAddress:n.value.trim(),isNative:null!=(r=e?.isNative)&&r});if(Array.isArray(o)&&o.length>0&&o[0]?.info){var[a]=o;d.setValue("symbol",a.info.symbol),d.setValue("decimals",new s.A(a.info.decimals).toString()),w.current=a.info,k(!1)}else d.setValue("symbol",""),d.setValue("decimals",""),k(!0)})),function(e){return m.apply(this,arguments)}),300);return(0,o.useEffect)((function(){I({value:i,networkId:c})}),[i,c,I]),{availableNetworks:f,searchedTokenRef:w}}function useAccountInfoForManageToken(){var e,t=(0,o.useCallback)((e=(0,r.A)((function*({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:r,deriveType:o,selectedNetworkId:s}){var{serviceAccount:a}=l.A,d=!1,c="";try{c=n?(yield a.getAccount({accountId:e,networkId:t})).id:(yield a.getNetworkAccount({accountId:void 0,indexedAccountId:r,networkId:s,deriveType:o})).id,d=!0}catch(e){d=!1}return{hasExistAccountFlag:d,accountIdForNetwork:c}})),function(t){return e.apply(this,arguments)}),[]);return{findAccountInfoForNetwork:t}}function useCheckAccountExist({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkIdValue:d}){var{findAccountInfoForNetwork:c}=useAccountInfoForManageToken(),i=(0,o.useCallback)((0,r.A)((function*(){return c({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkId:d})})),[e,s,t,n,a,d,c]),{result:l,run:k}=(0,u.yk)((0,r.A)((function*(){var{hasExistAccountFlag:e}=yield i();return e})),[i]);return{hasExistAccount:l,runCheckAccountExist:k,checkAccountIsExist:i}}},281182:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(586330),o=n(324586),s=n(514041),a=n(654266),d=n(241440),c=n(908867),i=n(490343),l=n(325809),u=n(525603),k=n(334439),m=n(553083),f=n(714191),w=n(610421),I=n(414375),g=n(911998),b=n(424403),A=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function CreateAddressButton(e){var t=(0,c.A)();return(0,A.jsx)(i.Button,_objectSpread(_objectSpread({$md:{flexGrow:1,flexBasis:0,size:"large"},variant:"primary"},e),{},{children:t.formatMessage({id:k.ETranslations.global_create_address})}))}function AddCustomTokenModal(){var e,t=(0,c.A)(),n=(0,a.lq)(),{walletId:o,networkId:f,indexedAccountId:y,accountId:p,isOthersWallet:h,deriveType:x,token:v,onSuccess:_}=n.params,T=m.Ay.isAllNetwork({networkId:f}),{form:j,isEmptyContract:E,setIsEmptyContractState:C,selectedNetworkIdValue:N,contractAddressValue:M,symbolValue:$,decimalsValue:S}=(0,b.yT)({token:v,networkId:f}),{hasExistAccount:F,runCheckAccountExist:V,checkAccountIsExist:O}=(0,b.KR)({accountId:p,networkId:f,isOthersWallet:h,indexedAccountId:y,deriveType:x,selectedNetworkIdValue:N}),{availableNetworks:z,searchedTokenRef:P}=(0,b.YF)({token:v,walletId:o,networkId:f,form:j,selectedNetworkIdValue:N,contractAddressValue:M,setIsEmptyContractState:C,checkAccountIsExist:O}),{result:D}=(0,g.yk)((function(){return w.A.serviceNetwork.getVaultSettings({networkId:N})}),[N]),[R,B]=(0,s.useState)(!1),W=(0,s.useMemo)((function(){return!F||(!!E||(!$||!new d.A(S).isInteger()||!!R))}),[$,S,E,R,F]),K=(0,s.useCallback)((e=(0,r.A)((function*(e){B(!0);var{hasExistAccountFlag:n,accountIdForNetwork:r}=yield O();if(n){var o=j.getValues(),{contractAddress:s,symbol:a,decimals:c}=o;if(!s&&!v?.isNative)return B(!1),void i.Toast.error({title:t.formatMessage({id:k.ETranslations.manger_token_custom_token_address_required})});if(!a||!new d.A(c).isInteger())return B(!1),void i.Toast.error({title:t.formatMessage({id:k.ETranslations.send_engine_incorrect_address})});try{var l,u,m=_objectSpread(_objectSpread({address:s,symbol:a,decimals:new d.A(c).toNumber()},P.current),{},{accountId:r,networkId:N,allNetworkAccountId:T?p:void 0,name:null!=(l=P.current?.name)?l:"",isNative:null!=(u=P.current?.isNative)&&u,$key:`${N}_${s}`});yield w.A.serviceCustomToken.activateToken({accountId:r,networkId:N,token:m}),yield w.A.serviceCustomToken.addCustomToken({token:m})}finally{B(!1)}i.Toast.success({title:t.formatMessage({id:k.ETranslations.address_book_add_address_toast_add_success})}),setTimeout((function(){_?.(),e?.()}),300)}else i.Toast.error({title:"Account not exist"})})),function(t){return e.apply(this,arguments)}),[j,O,N,v?.isNative,t,_,T,p,P]),Y=(0,s.useCallback)((function(){var e;return T?(0,A.jsx)(i.Form.Field,{label:t.formatMessage({id:k.ETranslations.global_chain}),name:"networkId",children:(0,A.jsx)(l.YS,{networkIds:z?.networkIds})}):(0,A.jsx)(i.Form.Field,{label:t.formatMessage({id:k.ETranslations.global_network}),name:"networkId",children:(0,A.jsxs)(i.Stack,{userSelect:"none",flexDirection:"row",alignItems:"center",borderRadius:"$3",borderWidth:1,borderCurve:"continuous",borderColor:"$borderStrong",px:"$3",py:"$2.5",$gtMd:{borderRadius:"$2",py:"$2"},testID:"network-selector-input",children:[(0,A.jsx)(I.um,{networkId:f,size:"$6"}),(0,A.jsx)(i.SizableText,{testID:"network-selector-input-text",px:14,flex:1,size:"$bodyLg",children:null!=(e=z?.network.name)?e:""})]})})}),[z,t,T,f]);return(0,A.jsxs)(i.Page,{children:[(0,A.jsx)(i.Page.Header,{title:t.formatMessage({id:k.ETranslations.manage_token_custom_token_title})}),(0,A.jsx)(i.Page.Body,{px:"$5",children:(0,A.jsxs)(i.Form,{form:j,children:[Y(),D?.isNativeTokenContractAddressEmpty?null:(0,A.jsx)(i.Form.Field,{label:t.formatMessage({id:k.ETranslations.manage_token_custom_token_contract_address}),rules:{validate:function(){if(E)return t.formatMessage({id:k.ETranslations.Token_manage_custom_token_address_faild})}},name:"contractAddress",children:(0,A.jsx)(i.Input,{size:"large",$gtMd:{size:"medium"},editable:!v?.isNative})}),(0,A.jsx)(i.Form.Field,{label:t.formatMessage({id:k.ETranslations.manage_token_custom_token_symbol}),name:"symbol",children:(0,A.jsx)(i.Input,{size:"large",$gtMd:{size:"medium"},editable:!1})}),(0,A.jsx)(i.Form.Field,{label:t.formatMessage({id:k.ETranslations.manage_token_custom_token_decimal}),name:"decimals",children:(0,A.jsx)(i.Input,{size:"large",$gtMd:{size:"medium"},editable:!1})})]})}),(0,A.jsx)(i.Page.Footer,{onConfirmText:t.formatMessage({id:k.ETranslations.manage_token_custom_token_add_btn}),onConfirm:K,confirmButtonProps:{loading:R,disabled:W},children:F?void 0:(0,A.jsx)(i.Stack,{testID:"add-custom-token-modal-footer",p:"$5",bg:"$bgApp",$md:{height:130},children:(0,A.jsxs)(i.Stack,{flex:1,$gtMd:{gap:"$2.5",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},$md:{gap:"$5"},children:[(0,A.jsxs)(i.XStack,{alignItems:"center",gap:"$2",children:[(0,A.jsx)(i.SizableText,{size:"$bodyMdMedium",color:"$text",children:t.formatMessage({id:k.ETranslations.manage_token_custom_token_create_address})}),(0,A.jsx)(i.Icon,{name:"ArrowRightOutline",color:"$iconSubdued",size:"$5"}),(0,A.jsx)(i.SizableText,{size:"$bodyMdMedium",color:"$textSubdued",children:t.formatMessage({id:k.ETranslations.manage_token_custom_token_add})})]}),(0,A.jsx)(u.J,{num:0,account:{walletId:o,indexedAccountId:y,networkId:N,deriveType:x},buttonRender:CreateAddressButton,onCreateDone:function(){setTimeout((function(){V()}))}})]})})})]})}const y=function AddCustomTokenModalWithMirror(){return(0,A.jsx)(l.b8,{config:{sceneName:f.Zs.home},enabledNum:[0],children:(0,A.jsx)(AddCustomTokenModal,{})})}}}]);