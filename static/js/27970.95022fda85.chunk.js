"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[27970],{27970:(e,n,t)=>{t.r(n),t.d(n,{default:()=>f});var i=t(586330),r=t(514041),a=t(654266),o=t(241440),s=t(908867),c=t(490343),l=t(259227),d=t(334439),u=t(392097),m=t(610421),g=t(498356),_=t(911998),p=t(831085);const f=function CreateInvoice(){var e,n=(0,s.A)(),t=(0,c.useMedia)(),f=(0,c.useForm)(),h=(0,a.lq)(),v=(0,g.A)(),{accountId:y,networkId:b}=h.params,[x]=(0,l.useSettingsPersistAtom)(),{serviceLightning:I}=m.A,[A,M]=(0,r.useState)(!1),T=f.watch("amount"),{result:k}=(0,_.yk)((function(){return I.getInvoiceConfig({networkId:b})}),[b,I]),{result:w}=(0,_.yk)((0,i.A)((function*(){yield m.A.serviceAccount.getAccountAddressForApi({networkId:b,accountId:y});return{price:(yield m.A.serviceToken.fetchTokensDetails({accountId:y,networkId:b,contractList:[""],withFrozenBalance:!1,withCheckInscription:!1}))[0].price}})),[b,y]),E=(0,r.useMemo)((function(){var e=new o.A(T||"0"),n=new o.A(w?.price||"0");return e.isInteger()&&n?e.multipliedBy(n).toFixed(2):"0.00"}),[T,w?.price]),j=(0,r.useCallback)((e=(0,i.A)((function*(e){try{M(!0);var n=yield I.createInvoice({accountId:y,networkId:b,amount:e.amount||"0",description:e.description});v.push(u.MD.ReceiveInvoice,{networkId:b,accountId:y,paymentHash:n.payment_hash,paymentRequest:n.payment_request})}finally{M(!1)}})),function(n){return e.apply(this,arguments)}),[y,b,I,v]);return(0,p.jsxs)(c.Page,{children:[(0,p.jsx)(c.Page.Header,{title:n.formatMessage({id:d.ETranslations.lighting_invoice})}),(0,p.jsx)(c.Page.Body,{p:"$5",children:(0,p.jsxs)(c.Form,{form:f,children:[(0,p.jsx)(c.Form.Field,{label:n.formatMessage({id:d.ETranslations.send_amount}),name:"amount",description:(0,p.jsx)(c.NumberSizeableText,{pt:"$1.5",size:"$bodyMd",color:"$textSubdued",formatter:"value",formatterOptions:{currency:x.currencyInfo.symbol},children:E}),rules:{min:{value:0,message:n.formatMessage({id:d.ETranslations.form_lighting_invoice_error_positive_integer_only})},pattern:{value:/^[0-9]*$/,message:n.formatMessage({id:d.ETranslations.form_lighting_invoice_error_positive_integer_only})},validate:function(e){if(e){var t=new o.A(e);return t.isInteger()?k?.maxReceiveAmount&&t.isGreaterThan(k?.maxReceiveAmount)?n.formatMessage({id:d.ETranslations.form_lighting_invoice_amount_error_max},{amount:k?.maxReceiveAmount}):void 0:n.formatMessage({id:d.ETranslations.form_lighting_invoice_error_positive_integer_only})}}},children:(0,p.jsx)(c.Input,{placeholder:n.formatMessage({id:d.ETranslations.form_amount_placeholder}),size:"large",$gtMd:{size:"medium"},keyboardType:"number-pad",addOns:[{label:"sats"}]})}),(0,p.jsx)(c.Form.Field,{label:n.formatMessage({id:d.ETranslations.global_description}),name:"description",rules:{maxLength:{value:40,message:n.formatMessage({id:d.ETranslations.dapp_connect_msg_description_can_be_up_to_int_characters},{number:"40"})}},children:(0,p.jsx)(c.TextArea,{size:t.gtMd?"medium":"large",$gtMd:{size:"medium"},placeholder:n.formatMessage({id:d.ETranslations.form_lighting_invoice_placeholder})})})]})}),(0,p.jsx)(c.Page.Footer,{onConfirmText:n.formatMessage({id:d.ETranslations.global_create_invoice}),onConfirm:function(){return f.handleSubmit(j)()},confirmButtonProps:{loading:A}})]})}}}]);