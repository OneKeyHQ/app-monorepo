"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[99855],{638731:(e,t,r)=>{r.d(t,{DL:()=>validateEvmAddress,Pm:()=>buildSignedTxFromSignatureEvm,TE:()=>packUnsignedTxForSignEvm,jI:()=>getPublicKeyFromPrivateKey});var n=r(586330),a=r(171277),i=r(705372),s=r(89729),o=r(757808),d=r(241440),c=r(401349),l=r(507140),u=r(825145),x=r(606777),p=r(424754),f=r(403144);function getPublicKeyFromPrivateKey(e){return _getPublicKeyFromPrivateKey.apply(this,arguments)}function _getPublicKeyFromPrivateKey(){return(_getPublicKeyFromPrivateKey=(0,n.A)((function*({privateKeyRaw:e}){if(!p.A.isHexString(e))throw new l.He("Invalid private key.");var t=x.A.toBuffer(e);if(32!==t.length)throw new l.He("Invalid private key.");var r=c.bI.publicFromPrivate(t).toString("hex");return Promise.resolve({publicKey:r})}))).apply(this,arguments)}function packUnsignedTxForSignEvm(e){var t=function packTransaction(e){var t,r={to:e.to||void 0,nonce:(0,f.Si)(new d.A((0,u.wT)(e.nonce))),gasLimit:(0,f.Si)(new d.A((0,u.wT)(null!=(t=e.gasLimit)?t:e.gas))),data:e?.data||"0x",value:e?.value||"0x0",chainId:new d.A((0,u.wT)(e.chainId)).toNumber()};return r.to||(r.value="0x0"),e?.maxFeePerGas||e?.maxPriorityFeePerGas?Object.assign(r,{type:o.TransactionTypes.eip1559,maxFeePerGas:(0,f.Si)(new d.A((0,u.wT)(e?.maxFeePerGas))),maxPriorityFeePerGas:(0,f.Si)(new d.A((0,u.wT)(e?.maxPriorityFeePerGas)))}):Object.assign(r,{gasPrice:(0,f.Si)(new d.A((0,u.wT)(e.gasPrice)))}),r}(e.encodedTx),r=(0,o.serialize)(t);return{digest:(0,s.keccak256)(r),tx:t,serializedTx:r,serializedTxWithout0x:p.A.stripHexPrefix(r)}}function validateEvmAddress(e){var t=!1,r="";try{t=42===(r=(0,a.getAddress)(e)).length}catch{return Promise.resolve({isValid:!1,normalizedAddress:"",displayAddress:""})}return Promise.resolve({normalizedAddress:r.toLowerCase()||"",displayAddress:r||"",isValid:t})}function buildSignedTxFromSignatureEvm({tx:e,signature:t}){var{r,s:n,v:a}=t,d=(0,i.splitSignature)({v:Number(a),r,s:n}),c=(0,o.serialize)(e,d);return{rawTx:c,txid:(0,s.keccak256)(c)}}},299855:(e,t,r)=>{r.r(t),r.d(t,{default:()=>stories_QRWalletGallery});var n=r(586330),a=r(573758),i=r.n(a),s=r(167612),o=r(490343),d=r(305719),c=r(742965),l=r(610421),u=r(325809),x=r(162616),p=r(834015),f=r(427249),h=r(213439),g=r(112850),A=r(318822),m=r(482407),b=r(584186),S=r(714191),T=r(654004),y=r(514041),v=r(613526),P=r(81318),j=r.n(P),k=r(498356),E=function(e){return e.standard="account.standard",e.ledger_live="account.ledger_live",e.ledger_legacy="account.ledger_legacy",e}({}),D=function(e){return e.hd="hd",e.pubkey="pubkey",e}({}),w=r(831085),H=r(901048).Buffer;function HdKeyImport(){var[e,t]=(0,y.useState)("UR:CRYPTO-HDKEY/PTAOWKAXHDCLAXLECXLTSNHYJZJPBBFYRYIHKPQZVTNEBBEHJTKTWDMYHLPFHLZTWMDADSNDGMSWESAAHDCXDICEBETLROYKCABAAAFMSWJZEMCHTNPTKNYNVYHPHFETHDSTKORHYTTAGAATHSRHAHTAADEHOEADCSFNAOAEAMTAADDYOTADLNCSDWYKCSFNYKAEYKAOCYSGWSYLBSAXAXATTAADDYOEADLRAEWKLAWKAXAEAYCYDKURZERDASIYGWJTIHGRIHKKBKJOHSIAIAJLKPJTJYDMJKJYHSJTIEHSJPIEHFKIDSWZ"),r=(0,p.A)();(0,k.A)();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.Button,{onPress:(0,n.A)((function*(){var e,a=(e=(0,n.A)((function*(){return(yield r.start({handlers:r.PARSE_HANDLER_NAMES.animation,autoHandleResult:!1,qrWalletScene:!0,showProTutorial:!0})).data.fullData})),function startAnimatedScan(){return e.apply(this,arguments)}),i=yield a();t(i||"")})),children:"Scan"}),(0,w.jsx)(o.TextArea,{value:e,onChangeText:t,placeholder:"qrcode data"}),(0,w.jsx)(o.Button,{onPress:(0,n.A)((function*(){var t=h.HA.createAnimatedURDecoder(),r=e.split("\n").map((function(e){return e.trim()})).filter(Boolean);for(var n of r)t.receivePart?.(n);var a=yield t.promiseResultUR,i=a.cbor.toString("hex");h.HA.decodeUrToDataItem(i);if("crypto-hdkey"===a.type){var s=h.xr.fromCBOR(H.from(i,"hex")),o=(s.getOrigin()?.getPath(),s.getOrigin()?.getSourceFingerprint()?.toString("hex"),s.getChildren()?.getPath()),d=o||"0/*",c=(s.getName(),s.getNote(),E.standard,D.hd);s.getNote()===E.standard?E.standard:s.getNote()===E.ledger_legacy&&E.ledger_legacy,s.getNote()===E.ledger_live&&E.ledger_live;for(var l=s.getBip32Key(),u=0;u<3;u+=1)if(c===D.hd){var x=j().fromExtendedKey(l),p=d.replace("*",String(u)).replace(/\*/g,"0"),f=`m/${p}`,g=x.derive(f),A=`0x${(0,v.publicToAddress)(g.publicKey,!0).toString("hex")}`;A=(0,v.toChecksumAddress)(A)}else{var m=Object.keys({})[u];if(!m)throw new Error("KeystoneError#pubkey_account.no_expected_account");(0,v.toChecksumAddress)(m)}}var b=(0,h.nB)(),S=b.parseHDKey(a);b.eth.generateAddressFromXpub({xpub:S.extendedPublicKey||"",derivePath:"m/0/0"})})),children:"crypto-hdkey (EVM)"})]})}function HdKeyImportMultiAccounts(){return(0,w.jsx)(o.Button,{children:"crypto-multi-accounts (TODO)"})}function QRWalletGalleryImportAccount(){return(0,w.jsxs)(o.Stack,{gap:"$2",children:[(0,w.jsx)(HdKeyImport,{}),(0,w.jsx)(HdKeyImportMultiAccounts,{})]})}var O=r(324586),K=r(83219),R=r.n(K),B=r(309276),I=r(653980),F=r(638731),C=r(404727),L=r(606777),M=r(424754),G=r(901048).Buffer;function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,O.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var N={to:"0x02bA7fd1b0aCdd0E4F8c6DA7C4bA8Fd7F963bA50",gasLimit:"0x8a10",maxPriorityFeePerGas:"0x128ed",maxFeePerGas:"0x1d1ac",data:"0x",nonce:"0x1",value:"0x12a05f200",chainId:"0x1",type:"0x2"},W=_objectSpread({from:"0x02bA7fd1b0aCdd0E4F8c6DA7C4bA8Fd7F963bA50"},N),z=_objectSpread({},N);function QRWalletGallerySignTx(){var{start:e}=(0,p.A)();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.Button,{onPress:function(){var{digest:e,serializedTx:t,serializedTxWithout0x:r}=(0,F.TE)({encodedTx:W}),n=new(R())({chain:K.Chain.Mainnet,hardfork:K.Hardfork.London}),a=(B.Transaction.fromTxData(z,{common:n}),B.FeeMarketEIP1559Transaction.fromTxData(z,{common:n})),i=(G.from(a.getMessageToSign(!1)).toString("hex"),B.FeeMarketEIP1559Transaction.fromTxData(z)),s=(G.from(i.getMessageToSign(!1)).toString("hex"),{requestId:(0,m.lk)(),signData:r,dataType:h.q1.typedTransaction,path:"m/44'/60'/0'/0/0",xfp:"aaaff70f",chainId:1,origin:"MetaMask"}),d=(0,h.nB)(),c=(h.LI.ETH_SIGN_REQUEST,h.RF.EthSignature,h.LI.ETH_SIGNATURE,d.eth.generateSignRequest(s)),l=I.UREncoder.encodeSinglePart(c).toUpperCase(),u=(new I.UREncoder(c,200,0).nextPart(),I.URDecoder.decode(l));h.iq.fromCBOR(u.cbor);o.Dialog.show({title:l,renderContent:(0,w.jsx)(o.QRCode,{size:300,value:l,drawType:"line"})})},children:"eth-sign-request (EVM signTx EIP-1559 )"}),(0,w.jsx)(o.Button,{children:"eth-sign-request (EVM signTx legacy TODO)"}),(0,w.jsx)(o.Button,{children:"eth-sign-request (EVM personal_sign TODO)"}),(0,w.jsx)(o.Button,{children:"eth-sign-request (EVM signTypedData_v1 v3 v4 TODO)"}),(0,w.jsx)(o.Button,{onPress:(0,n.A)((function*(){var e=(0,h.nB)(),t=yield(0,d.U7)({network:s.o8.bitcoin,unsignedTx:{encodedTx:{inputs:[{address:"bc1pw8tt6lrnkwva9l3twexqzl857pgga9uq570nmgemvhfr7c5hhlkq33puph",path:"m/86'/0'/0'/0/0",vout:1,txid:"606b35ac8b72a7e04faaabf28a31e6df7526f8316ecddc9a66997c9cfbd7914c",value:"84744"}],outputs:[{address:"bc1pw8tt6lrnkwva9l3twexqzl857pgga9uq570nmgemvhfr7c5hhlkq33puph",value:"34000"},{address:"bc1pw8tt6lrnkwva9l3twexqzl857pgga9uq570nmgemvhfr7c5hhlkq33puph",value:"45000",payload:{isChange:!0,bip44Path:"m/86'/0'/0'/0/0"}}],fee:"5744"}},btcExtraInfo:{inputAddressesEncodings:[C.EAddressEncodings.P2TR,C.EAddressEncodings.P2TR],pathToAddresses:{},addressToPath:{}},buildInputMixinInfo:function(){return Promise.resolve({pubkey:L.A.toBuffer("0286211e179c218d3dfd345271f92fcaa95d2d7491ee3d44db2da016f17953b71b","hex"),bip32Derivation:[{leafHashes:[],pubkey:L.A.toBuffer("0286211e179c218d3dfd345271f92fcaa95d2d7491ee3d44db2da016f17953b71b","hex"),masterFingerprint:L.A.toBuffer("fc885a5e","hex"),path:"m/86'/0'/0'/0/0"}]})}}),r=(t.toHex(),(0,d.ow)({psbt:t,psbtNetwork:s.o8.bitcoin}),s.iL.fromHex("70736274ff01008902000000014c91d7fb9c7c99669adccd6e31f82675dfe6318af2abaa4fe0a7728bac356b600100000000ffffffff02b80b00000000000022512071d6bd7c73b399d2fe2b764c017cf4f0508e9780a79f3da33b65d23f6297bfec202a01000000000022512071d6bd7c73b399d2fe2b764c017cf4f0508e9780a79f3da33b65d23f6297bfec000000000001012b084b01000000000022512071d6bd7c73b399d2fe2b764c017cf4f0508e9780a79f3da33b65d23f6297bfec01172086211e179c218d3dfd345271f92fcaa95d2d7491ee3d44db2da016f17953b71b000000",{network:s.o8.bitcoin})),n=((0,d.ow)({psbt:r,psbtNetwork:s.o8.bitcoin}),e.btc.generatePSBT(t.toBuffer()));o.Dialog.show({title:"PSBT QRCode",renderContent:(0,w.jsx)(o.QRCode,{size:300,valueUr:h.HA.urToJson({ur:n}),drawType:"animated"})})})),children:"btc signPSBT"}),(0,w.jsx)(o.Input,{}),(0,w.jsx)(o.Button,{onPress:(0,n.A)((function*(){var e=(0,h.nB)(),t=h.HA.createAnimatedURDecoder();t?.receivePart?.("UR:ETH-SIGNATURE/OTADTPDAGDTOFNGRPKSBMNFXJERSCMGLZOSOPMWEFRAOHDFPOLDEOSHEEOGOONVDIHNBUOTDLRGLLRDAFGADSKHYADZMLPCWSEMNKOJZJTDWDPWPKGSGHDVSVLJLCAEMDTSSKGCPRLSFATMSEHKKGYWDDKEOIMCNMNBSJOJLIEAATLWPAEAXIYGWJTIHGRIHKKLGENRKKT");var r=yield t?.promiseResultUR,n=e.eth.parseSignature(r),{signature:a}=n,i=a.slice(0,64),s=a.slice(64,128),o=a.slice(128),d=B.TransactionFactory.fromTxData(_objectSpread(_objectSpread({},N),{},{type:N.type,r:M.A.addHexPrefix(i),s:M.A.addHexPrefix(s),v:M.A.addHexPrefix(o)}));M.A.addHexPrefix(d.hash().toString("hex")),M.A.addHexPrefix(d.serialize().toString("hex"))})),children:"eth-signature (EVM scan sign result)"})]})}function CustomAppRequestDeviceQR(){var{start:e}=(0,p.A)();return(0,w.jsxs)(o.Stack,{gap:"$2",children:[(0,w.jsx)(o.Button,{onPress:function(){var e=new g._({requestId:(0,m.lk)(),xfp:"5c9e228d",deviceId:"CLA8888",origin:"OneKey iOS",method:"getMultiAccounts",params:[{chain:"ETH",paths:i()(0,5).map((function(e){return`m/44'/60'/${e}'`}))}]}).toUR();A.iL.emit(A.Tu.ShowQrcode,{drawType:"animated",valueUr:h.HA.urToJson({ur:e})})},children:"onekey-app-call-device getMultiAccounts()"}),(0,w.jsx)(o.Button,{onPress:function(){var e=new g._({requestId:(0,m.lk)(),xfp:"5c9e228d",origin:"OneKey Wallet",method:"verifyAddress",params:[{chain:"ETH",path:"m/44'/60'/1'/0/0",address:"",chainId:"1"}]}).toUR();A.iL.emit(A.Tu.ShowQrcode,{drawType:"animated",valueUr:h.HA.urToJson({ur:e})})},children:"onekey-app-call-device verifyAddress()"}),(0,w.jsx)(o.Button,{onPress:(0,n.A)((function*(){var t=yield e({handlers:[f.A.animation],qrWalletScene:!0,autoHandleResult:!1}),r=t.data.fullData||t.raw||"",n=yield h.HA.qrcodeToUr(r),a=(0,h.nB)();if(n){if("onekey-app-call-device"===n.type)g._.fromUR(n);if("crypto-psbt"===n.type){var i=s.o8.bitcoin,o=a.btc.parsePSBT(n),l=s.iL.fromHex(o);yield b.A.wait(1e3);(0,d.ow)({psbt:l,psbtNetwork:i}),yield c.A.btc.hd.extractPsbtToSignedTx({psbt:l})}}})),children:"Decode qrcode"})]})}function QRWalletGalleryDemo(){var{activeAccount:e}=(0,x.LH)({num:0});return(0,w.jsxs)(o.Stack,{gap:"$2",children:[(0,w.jsx)(o.Button,{onPress:function(){l.A.serviceDemo.clearQrWalletAirGapAccountKeys({walletId:e?.wallet?.id||""})},children:"clear wallet airgap account keys"}),(0,w.jsx)(QRWalletGalleryImportAccount,{}),(0,w.jsx)(QRWalletGallerySignTx,{}),(0,w.jsx)(CustomAppRequestDeviceQR,{})]})}const stories_QRWalletGallery=function(){return(0,w.jsx)(T.P,{description:"--",suggestions:["--"],boundaryConditions:["--"],elements:[{title:"--",element:(0,w.jsx)(u.b8,{config:{sceneName:S.Zs.home,sceneUrl:""},enabledNum:[0],children:(0,w.jsx)(o.Stack,{gap:"$1",children:(0,w.jsx)(QRWalletGalleryDemo,{})})})}]})}},654004:(e,t,r)=>{r.d(t,{P:()=>Layout});var n=r(586330),a=r(654266),i=r(490343),s=r(989375),o=r(610421),d=r(498356),c=r(392097),l=r(831085),FormattedText=function({text:e}){return"string"==typeof e?(0,l.jsx)(i.Stack,{children:(0,l.jsxs)(i.SizableText,{children:[e,"。 "]})}):Array.isArray(e)&&0===e.length?null:(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.Stack,{gap:"$1",children:e.map((function(t,r){return(0,l.jsx)(i.Stack,{children:(0,l.jsxs)(i.SizableText,{children:[r+1,". ",t,r===e.length-1?"。":"；"]})},r.toString())}))})})};function Layout({description:e="",suggestions:t=[],boundaryConditions:r=[],elements:u=[],scrollEnabled:x=!0,contentInsetAdjustmentBehavior:p="never",skipLoading:f=!1,children:h}){var g=(0,s.U6)(),A=(0,d.A)();return(0,l.jsx)(i.Page,{skipLoading:f,children:(0,l.jsx)(i.ScrollView,{maxWidth:"100%",scrollEnabled:x,flex:1,marginBottom:g,paddingHorizontal:"$5",contentContainerStyle:{paddingTop:20,paddingBottom:280},keyboardDismissMode:"on-drag",contentInsetAdjustmentBehavior:p,children:(0,l.jsxs)(i.Stack,{marginHorizontal:"auto",maxWidth:"100%",width:576,gap:"$6",children:[(0,l.jsxs)(i.XStack,{children:[(0,l.jsx)(i.IconButton,{icon:"HomeLineOutline",onPress:function(){A.dispatch(a.y9.replace(c.WP.Main,{screen:c.V4.Developer,params:{screen:c.f$.TabDeveloper}}))}}),(0,l.jsx)(i.Button,{ml:"$4",onPress:(0,n.A)((function*(){yield o.A.serviceSetting.setTheme("light")})),children:"Light Theme"}),(0,l.jsx)(i.Button,{ml:"$4",variant:"primary",onPress:(0,n.A)((function*(){yield o.A.serviceSetting.setTheme("dark")})),children:"Dark Theme"})]}),e?(0,l.jsxs)(i.Stack,{gap:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"使用说明"})}),(0,l.jsx)(i.Stack,{children:(0,l.jsx)(FormattedText,{text:e})})]}):null,t?(0,l.jsxs)(i.Stack,{gap:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"使用建议"})}),(0,l.jsx)(FormattedText,{text:t})]}):null,r?.length>0?(0,l.jsxs)(i.Stack,{gap:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"注意事项"})}),(0,l.jsx)(FormattedText,{text:r})]}):null,(0,l.jsxs)(i.Stack,{gap:"$2",children:[(0,l.jsx)(i.Stack,{children:(0,l.jsx)(i.SizableText,{size:"$headingXl",children:"组件案例"})}),(0,l.jsx)(i.Stack,{children:u?.map((function(e,t){return(0,l.jsxs)(i.Stack,{gap:"$2",pb:"$8",mb:"$8",borderBottomWidth:"$px",borderBottomColor:"$borderSubdued",children:[(0,l.jsxs)(i.Stack,{flexDirection:"column",children:[(0,l.jsx)(i.SizableText,{size:"$headingLg",children:e.title}),e.description?(0,l.jsx)(i.Stack,{paddingTop:1,children:(0,l.jsxs)(i.SizableText,{children:[e.description,"。"]})}):null]}),(0,l.jsx)(i.Stack,{children:"function"==typeof e.element?(0,l.jsx)(e.element,{}):e.element})]},`elements-${t}`)}))}),(0,l.jsx)(i.Stack,{children:h?(0,l.jsx)(i.Stack,{gap:"$3",children:h}):null})]})]})})})}}}]);