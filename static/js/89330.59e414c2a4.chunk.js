"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[89330],{304695:(e,t,n)=>{n.d(t,{V:()=>NetworksFilterItem});var r=n(324586),o=n(839850),c=n(17617),a=n(490343),i=n(831085),s=["networkImageUri","networkName","isSelected","tooltipContent","disabled"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function NetworksFilterItem(e){var{networkImageUri:t,networkName:n,isSelected:r,tooltipContent:u,disabled:d}=e,l=(0,o.A)(e,s),f=(0,i.jsxs)(a.XStack,_objectSpread(_objectSpread(_objectSpread(_objectSpread({justifyContent:"center",px:"$3",py:"$1.5",borderRadius:"$2",userSelect:"none",borderWidth:c.A.hairlineWidth,borderColor:r?"$borderActive":"$border"},!r&&!d&&{focusable:!0,hoverStyle:{bg:"$bgStrongHover"},pressStyle:{bg:"$bgStrongActive"},focusVisibleStyle:{outlineWidth:2,outlineStyle:"solid",outlineColor:"$focusRing"}}),d&&{opacity:.5}),l),{},{children:[t?(0,i.jsx)(a.Image,{height:"$6",width:"$6",borderRadius:"$full",$gtMd:{height:"$5",width:"$5"},children:(0,i.jsx)(a.Image.Source,{source:{uri:t}})}):null,n?(0,i.jsx)(a.SizableText,{numberOfLines:1,color:r?"$textOnColor":"$textSubdued",size:"$bodyLgMedium",$gtMd:{size:"$bodyMdMedium"},children:n}):null]}));return u?(0,i.jsx)(a.Tooltip,{renderContent:u,placement:"top",renderTrigger:f}):f}},771821:(e,t,n)=>{n.d(t,{v:()=>TokenListItem});var r=n(324586),o=n(839850),c=n(490343),a=n(791088),i=n(491180),s=n(391944),u=n(831085),d=["tokenImageSrc","networkImageSrc","tokenName","isSearch","tokenSymbol","tokenContrastAddress","balance","valueProps","disabled","titleMatchStr","moreComponent"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TokenListItem(e){var t,{tokenImageSrc:n,networkImageSrc:r,tokenName:l,isSearch:f,tokenSymbol:w,tokenContrastAddress:p,balance:k,valueProps:b,disabled:I,titleMatchStr:m,moreComponent:S}=e,y=(0,o.A)(e,d);return(0,u.jsxs)(a.c,_objectSpread(_objectSpread(_objectSpread({userSelect:"none"},f&&{$md:{alignItems:"flex-start"}}),y),{},{children:[(0,u.jsx)(s.o,_objectSpread(_objectSpread({},I&&{opacity:.5}),{},{tokenImageUri:n,networkImageUri:r})),(0,u.jsx)(a.c.Text,_objectSpread(_objectSpread({},I&&{opacity:.5}),{},{flex:1,primary:w,primaryMatch:m,primaryTextProps:{numberOfLines:1},secondary:f?(0,u.jsxs)(c.Stack,{gap:"$0.5",$gtMd:{flexDirection:"row",gap:"$1"},children:[(0,u.jsx)(c.SizableText,{numberOfLines:1,color:"$textSubdued",size:"$bodyMd",children:l}),(0,u.jsx)(c.SizableText,{color:"$textDisabled",size:"$bodyMd",children:i.A.shortenAddress({address:p,leadingLength:8,trailingLength:6})})]}):null!=l?l:""})),(0,u.jsx)(a.c.Text,_objectSpread(_objectSpread({},I&&{opacity:.5}),{},{align:"right",primary:(0,u.jsx)(c.NumberSizeableText,{textAlign:"right",color:"$text",formatter:"balance",size:"$bodyLgMedium",children:k}),secondary:b?.value?(0,u.jsx)(c.NumberSizeableText,{textAlign:"right",size:"$bodyMd",formatter:"value",color:"$textSubdued",formatterOptions:{currency:null!=(t=b?.currency)?t:"$"},children:b.value}):null})),S]}))}},82506:(e,t,n)=>{n.d(t,{d:()=>useDebounce});var r=n(578104);function useDebounce(e,t,n){var[o]=(0,r.d7)(e,t,n);return o}},20322:(e,t,n)=>{n.d(t,{Gr:()=>useSwapRecipientAddressInfo,jA:()=>useSwapFromAccountNetworkSync,zf:()=>useSwapAddressInfo});var r=n(324586),o=n(586330),c=n(712784),a=n.n(c),i=n(514041),s=n(490343),u=n(153763),d=n(259227),l=n(392097),f=n(491180),w=n(619390),p=n(610421),k=n(317522),b=n(911998),I=n(162616),m=n(325529);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useSwapFromAccountNetworkSync(){var{updateSelectedAccountNetwork:e}=(0,I.z$)().current,[t]=(0,m.NE)(),{activeAccount:n}=(0,I.LH)({num:1}),{activeAccount:r}=(0,I.LH)({num:0}),[c,f]=(0,m.rv)(),[w]=(0,m.dF)(),[,p]=(0,d.useSettingsAtom)(),[b]=(0,m.Q8)(),S=(0,i.useRef)(),y=(0,i.useRef)(),g=(0,i.useRef)(),A=(0,i.useRef)(c),h=(0,i.useRef)(n),v=(0,i.useRef)(r);h.current!==n&&(h.current=n),v.current!==r&&(v.current=r),S.current!==t&&(S.current=t),y.current!==b&&(y.current=b),A.current!==c&&(A.current=c),g.current!==w&&(g.current=w);var j,O=(0,i.useCallback)(a()((0,o.A)((function*(){S.current&&(yield e({num:0,networkId:S.current?.networkId})),y.current&&(yield e({num:1,networkId:y.current?.networkId})),S.current&&y.current&&(A.current?.networkId&&y.current?.networkId!==A.current?.networkId||!A.current?.networkId&&!h.current?.account&&h.current?.wallet||!1===g.current||!A.current.address&&h.current.account?.id!==v.current.account?.id)&&(p((function(e){return _objectSpread(_objectSpread({},e),{},{swapToAnotherAccountSwitchOn:!1})})),f((function(e){return _objectSpread(_objectSpread({},e),{},{address:void 0})})),setTimeout((function(){y.current?.networkId&&h.current.network?.id&&y.current?.networkId!==h.current.network.id&&e({num:1,networkId:y.current?.networkId})}),500))})),100),[p,e]),T=(0,s.usePageType)();(0,k.A)(l.V4.Swap,(j=(0,o.A)((function*(e,t){if(T!==s.EPageType.modal){if(t)return;e&&(yield O())}})),function(e,t){return j.apply(this,arguments)})),(0,i.useEffect)((function(){T!==s.EPageType.modal&&(0,o.A)((function*(){yield O()}))()}),[O,t?.networkId,t?.contractAddress,b?.networkId,b?.contractAddress,w,T]);var x=(0,u.E)();(0,i.useEffect)((function(){T===s.EPageType.modal&&x&&(0,o.A)((function*(){yield O()}))()}),[O,x,T,t?.networkId,t?.contractAddress,b?.networkId,b?.contractAddress,w])}function useSwapAddressInfo(e){var{activeAccount:t}=(0,I.LH)({num:e===w.En.FROM?0:1}),[{swapToAnotherAccountSwitchOn:n}]=(0,d.useSettingsAtom)(),[r]=(0,m.rv)();return(0,i.useMemo)((function(){var o={networkId:void 0,address:void 0,accountInfo:void 0,activeAccount:void 0};return e===w.En.TO&&n&&r.address&&r.networkId&&t&&t.network?.id===r.networkId?_objectSpread(_objectSpread({},o),{},{address:r.address,networkId:r.networkId,accountInfo:r.accountInfo,activeAccount:_objectSpread({},t)}):t?_objectSpread(_objectSpread({},o),{},{address:t.account?.address,networkId:t.network?.id,accountInfo:_objectSpread({},t),activeAccount:_objectSpread({},t)}):o}),[e,n,r,t])}function useSwapRecipientAddressInfo(e){var t=useSwapAddressInfo(w.En.FROM),n=useSwapAddressInfo(w.En.TO),[r]=(0,m.Zr)(),[{swapToAnotherAccountSwitchOn:c}]=(0,d.useSettingsAtom)(),[a]=(0,m.rv)(),i=(0,b.yk)((0,o.A)((function*(){return e?n.networkId&&t.accountInfo?.account?.id&&t.accountInfo?.indexedAccount?.id?yield p.A.serviceStaking.getEarnAccount({accountId:t.accountInfo?.account?.id,networkId:n.networkId,indexedAccountId:t.accountInfo?.indexedAccount?.id}):void 0:null})),[e,n.networkId,t.accountInfo?.account?.id,t.accountInfo?.indexedAccount?.id],{}),s=(0,b.yk)((0,o.A)((function*(){if(a.networkId&&a.address){var e=yield p.A.serviceAccount.getAccountNameFromAddress({networkId:a.networkId,address:a.address});if(e.length>0)return e[0]}})),[a.address,a.networkId],{});if(n.address===a.address&&c&&i?.result?.accountAddress&&i?.result?.accountAddress!==a.address&&a.networkId===r?.toTokenInfo.networkId)return{accountInfo:a.accountInfo?.account?.address===a.address?{walletName:a.accountInfo?.wallet?.name,accountName:a.accountInfo?.accountName,accountId:a.accountInfo?.account?.id}:s.result,showAddress:f.A.shortenAddress({address:a.address,leadingLength:6,trailingLength:6}),isExtAccount:a.accountInfo?.account?.address!==a.address&&!s.result}}},866063:(e,t,n)=>{n.d(t,{FI:()=>useSwapInit,GM:()=>useSwapTokenList,ZF:()=>useSwapSelectedTokenInfo});var r=n(324586),o=n(503668),c=n.n(o),a=n(586330),i=n(514041),s=n(241440),u=n(490343),d=n(153763),l=n(259227),f=n(625931),w=n(22937),p=n(392097),k=n(553083),b=n(734818),I=n(58546),m=n(619390),S=n(610421),y=n(317522),g=n(162616),A=n(325529),h=n(20322);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useSwapInit(e){var[t,n]=(0,A.ZM)(),[r,o]=(0,A.NE)(),[s,d]=(0,A.Q8)(),[,w]=(0,l.useInAppNotificationAtom)(),{syncNetworksSort:b}=(0,A.eR)().current,v=(0,h.zf)(m.En.FROM),{updateSelectedAccountNetwork:j}=(0,g.z$)().current,[O,T]=(0,i.useState)(!0),[x,N]=(0,i.useState)(!1),$=(0,i.useRef)(),[P]=(0,A.sK)(),{swapTypeSwitchAction:E}=(0,A.eR)().current;$.current!==v&&($.current=v);var _=(0,i.useRef)([]);_.current!==t&&(_.current=t);var R=(0,i.useRef)();R.current!==r&&(R.current=r);var M=(0,i.useRef)();M.current!==s&&(M.current=s);var C=(0,i.useCallback)((0,a.A)((function*(){if(t.length)T(!1);else{var e=yield S.A.simpleDb.swapNetworksSort.getRawData();if(e?.data?.length){var r=e?.data.every((function(e){return c()(e.supportCrossChainSwap)&&c()(e.supportSingleSwap)}));r?(e=null,S.A.simpleDb.swapNetworksSort.setRawData({data:[]})):(n(e.data),T(!1))}var o=[],a=yield S.A.serviceSwap.fetchSwapNetworks();if(o=[...a],e?.data?.length&&a?.length){var i=e.data;o=i.filter((function(e){return a.find((function(t){return t.networkId===e.networkId}))})).map((function(e){var t=a.find((function(t){return t.networkId===e.networkId}));return _objectSpread(_objectSpread({},e),t)})).concat(a.filter((function(e){return!i.find((function(t){return t.networkId===e.networkId}))})))}o.length&&(yield S.A.simpleDb.swapNetworksSort.setRawData({data:o}),e?.data?.length&&e?.data?.length===o.length||(n(o),T(!1)))}})),[n,t.length]),D=(0,i.useCallback)((function(n,r){var o=t.find((function(e){return e.networkId===n.networkId})),c=[];if(o&&(o.supportSingleSwap&&(c=[...c,m.qX.SWAP]),o.supportCrossChainSwap&&(c=[...c,m.qX.BRIDGE])),!e?.swapTabSwitchType&&r&&c.length>0&&!c.includes(P)){var a,i=c.find((function(e){return e!==P}));if(i)E(i,null!=(a=$.current?.networkId)?a:R.current?.networkId)}return c}),[e?.swapTabSwitchType,t,P,E]),F=(0,i.useCallback)((0,a.A)((function*(){if(!R.current&&!M.current)if(e?.importFromToken&&_.current.find((function(t){return t.networkId===e?.importFromToken?.networkId}))||e?.importToToken&&_.current.find((function(t){return t.networkId===e?.importFromToken?.networkId}))){var t,n;if(e?.importFromToken){var r=D(e?.importFromToken);e?.swapTabSwitchType&&r.includes(e?.swapTabSwitchType)&&o(e?.importFromToken)}if(e?.importToToken){var a=D(e?.importToToken);e?.swapTabSwitchType&&a.includes(e?.swapTabSwitchType)&&d(e?.importToToken)}if(e?.importFromToken&&!e?.importToToken&&!e?.importFromToken?.isNative){var i=I.sI[e?.importFromToken.networkId];if(i){var s=D(i);e?.swapTabSwitchType&&s.includes(e?.swapTabSwitchType)&&d(i)}}b(null!=(t=null!=(n=e?.importFromToken?.networkId)?n:e?.importToToken?.networkId)?t:(0,f.V)().onekeyall)}else if($.current?.accountInfo?.ready&&$.current?.networkId&&_.current.length&&(!e?.importNetworkId||!$.current?.networkId||e?.importNetworkId===$.current?.networkId)&&!x){var u=k.Ay.isAllNetwork({networkId:$.current?.networkId}),l=_.current.find((function(e){return e.networkId===$.current?.networkId})),w=l,p=l?.networkId;if(u){p=(0,f.V)().onekeyall;var m=I.TW[p]?.fromToken;w=_.current.find((function(e){return e.networkId===m?.networkId}))}if(w&&p&&(!c()(I.TW[p]?.fromToken)||!c()(I.TW[p]?.toToken))){var S=I.TW[p]?.fromToken,y=I.TW[p]?.toToken;S&&(o(_objectSpread(_objectSpread({},S),{},{networkLogoURI:u?S.networkLogoURI:w?.logoURI})),b(S.networkId)),y&&(d(_objectSpread(_objectSpread({},y),{},{networkLogoURI:u?y.networkLogoURI:w?.logoURI})),b(y.networkId)),S&&D(S,!0)}}})),[e?.importFromToken,e?.importToToken,e?.importNetworkId,e?.swapTabSwitchType,x,b,D,o,d]);(0,i.useEffect)((function(){(0,a.A)((function*(){yield S.A.serviceSwap.swapRecentTokenSync()}))()}),[w]),(0,i.useEffect)((function(){(0,a.A)((function*(){yield C()}))()}),[C,t.length]),(0,i.useEffect)((function(){(0,a.A)((function*(){e?.importNetworkId&&$.current?.networkId&&e?.importNetworkId!==$.current.networkId&&(yield j({num:0,networkId:e?.importNetworkId}))}))()}),[e?.importNetworkId,j]),(0,i.useEffect)((function(){(0,a.A)((function*(){yield F()}))()}),[v.accountInfo?.ready,t.length,v.networkId,e?.importFromToken,e?.importToToken,e?.importNetworkId]);var L=(0,u.usePageType)();return(0,y.A)(p.V4.Swap,(function(e,t){L!==u.EPageType.modal&&e&&N(!!t)})),{fetchLoading:O}}function useSwapTokenList(e,t,n){var[r,o]=(0,i.useState)([]),[{tokenCatch:c}]=(0,A.PQ)(),[u]=(0,A.Yb)(),[d,l]=(0,i.useState)([]),[f]=(0,A.ZM)(),[p]=(0,A.qv)(),{tokenListFetchAction:I,swapLoadAllNetworkTokenList:m}=(0,A.eR)().current,y=(0,h.zf)(e),[g]=(0,A.Hb)();(0,i.useEffect)((function(){(0,a.A)((function*(){var e,{swapSupportAccounts:t}=yield S.A.serviceSwap.getSupportSwapAllAccounts({indexedAccountId:y?.accountInfo?.indexedAccount?.id,otherWalletTypeAccountId:y?.accountInfo?.indexedAccount?.id?void 0:null!=(e=y?.accountInfo?.account?.id)?e:y?.accountInfo?.dbAccount?.id,swapSupportNetworks:f});l(t)}))()}),[y?.accountInfo?.account?.id,y?.accountInfo?.dbAccount?.id,y?.accountInfo?.indexedAccount?.id,f]);var v=(0,i.useMemo)((function(){var e=d.find((function(e){return e.networkId===t}));return y.networkId===t?{networkId:t,keywords:n,accountAddress:y?.address,accountNetworkId:y?.networkId,accountId:y?.accountInfo?.account?.id}:{networkId:t,keywords:n,accountAddress:e?.apiAddress,accountNetworkId:e?.networkId,accountId:e?.accountId}}),[t,y.networkId,y?.address,y?.accountInfo?.account?.id,d,n]),j=(0,i.useMemo)((function(){var e,t,n;return u[null!=(e=null!=(t=null!=(n=y?.accountInfo?.indexedAccount?.id)?n:y?.accountInfo?.account?.id)?t:y?.accountInfo?.dbAccount?.id)?e:"noAccountId"]}),[u,y?.accountInfo?.indexedAccount?.id,y?.accountInfo?.account?.id,y?.accountInfo?.dbAccount?.id]),O=(0,i.useCallback)((function(e){var t=e.filter((function(e){var t,n=new s.A(null!=(t=e.price)?t:"0");return!n.isNaN()&&!n.isZero()}))?.sort((function(e,t){var n,r,o=new s.A(null!=(n=e.fiatValue)?n:"0");return new s.A(null!=(r=t.fiatValue)?r:"0").comparedTo(o)})),n=e.filter((function(e){var t,n=new s.A(null!=(t=e.price)?t:"0");return n.isNaN()||n.isZero()}))?.sort((function(e,t){var n,r,o=new s.A(null!=(n=e.fiatValue)?n:"0");return new s.A(null!=(r=t.fiatValue)?r:"0").comparedTo(o)}));return[...t,...n]}),[]),T=(0,i.useCallback)((function({swapAllNetRecommend:e,swapSearchTokens:t}){var n,r;if(e?.length&&!j)return[];var o=null!=(n=j?.map((function(e){var t=f.find((function(t){return t.networkId===e.networkId}));return t?_objectSpread(_objectSpread({},e),{},{networkLogoURI:t.logoURI}):e}))?.filter((function(e){return p.find((function(t){return t.networkId===e.networkId}))})))?n:[],c=null!=(r=o?.filter((function(e){var t,n=new s.A(null!=(t=e?.balanceParsed)?t:"0");return!n.isNaN()&&!n.isZero()})))?r:[];if(e){var a,i=null!=(a=e?.filter((function(e){return!c?.find((function(t){return(0,b.BQ)({token1:{networkId:t?.networkId,contractAddress:t?.contractAddress},token2:{networkId:e?.networkId,contractAddress:e?.contractAddress}})}))}))?.filter((function(e){return p.find((function(t){return t.networkId===e.networkId}))})))?a:[],u=[...c,...i];return O(null!=u?u:[])}if(t){var d=t.map((function(e){if(p.find((function(t){return t.networkId===e.networkId}))){var t=c.find((function(t){return t?.contractAddress===e?.contractAddress&&t?.networkId===e?.networkId}));return t||e}})).filter((function(e){return e}));return O(null!=d?d:[])}return[]}),[O,j,f,p]),x=(0,w.bJ)(k.Ay.isAllNetwork({networkId:v.networkId})&&n?T({swapSearchTokens:c?.[JSON.stringify(v)]?.data||[]}):c?.[JSON.stringify(v)]?.data||[],{shouldSort:!1,keys:["symbol","contractAddress"]}),N=(0,i.useRef)(x);return N.current!==x&&(N.current=x),(0,i.useEffect)((function(){var e;v.networkId&&!n&&k.Ay.isAllNetwork({networkId:v.networkId})&&m(y?.accountInfo?.indexedAccount?.id,y?.accountInfo?.indexedAccount?.id?void 0:null!=(e=y?.accountInfo?.account?.id)?e:y?.accountInfo?.dbAccount?.id);I(v)}),[y?.accountInfo?.account?.id,y?.accountInfo?.dbAccount?.id,y?.accountInfo?.indexedAccount?.id,m,v,I,n]),(0,i.useEffect)((function(){n&&N.current?o(N.current.search(n)):o(k.Ay.isAllNetwork({networkId:v.networkId})?T({swapAllNetRecommend:c?.[JSON.stringify(v)]?.data||[]}):c?.[JSON.stringify(v)]?.data||[])}),[c,v,t,n,T]),{fetchLoading:g&&0===r.length||k.Ay.isAllNetwork({networkId:v.networkId})&&!j,currentTokens:r}}function useSwapSelectedTokenInfo({token:e,type:t}){var n=(0,h.zf)(t),[r,o]=(0,i.useState)(0),[{swapHistoryPendingList:c}]=(0,l.useInAppNotificationAtom)(),{loadSwapSelectTokenDetail:a}=(0,A.eR)().current,s=(0,i.useRef)(c);s.current!==c&&(s.current=c);var f=(0,i.useRef)(r);f.current!==r&&(f.current=r);var w=(0,i.useRef)(n);w.current!==n&&(w.current=n);var k=(0,d.E)(),b=(0,i.useRef)(k);b.current!==k&&(b.current=k),(0,i.useEffect)((function(){if(b.current&&c.length){var e=c.filter((function(e){return e.status===m.lr.SUCCESS})).length;e>f.current&&(a(t,w.current,!0),o(e))}}),[a,c,t]),(0,i.useEffect)((function(){a(t,w.current,!e?.reservationValue&&e?.isNative)}),[t,n,e?.networkId,e?.contractAddress,a,e?.reservationValue,e?.isNative]);var I=(0,u.usePageType)();(0,y.A)(p.V4.Swap,(function(e,n){if(I!==u.EPageType.modal&&e&&!n&&s.current.length){var r=s.current.filter((function(e){return e.status===m.lr.SUCCESS})).length;r>f.current&&(a(t,w.current,!0),o(r))}}))}},309008:(e,t,n)=>{n.d(t,{o:()=>d});var r=n(324586),o=n(514041),c=n(325529),a=n(2577),i=n(597102),s=n(829561),u=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=(0,o.memo)((function(e){var{children:t,storeName:n}=e,r=(0,s.x6)(n),o=a.A.getOrCreateStore(r);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(i.H,_objectSpread({},r)),(0,u.jsx)(c.BY,{store:o,children:t})]})}));d.displayName="SwapProviderMirror"},89330:(e,t,n)=>{n.r(t),n.d(t,{default:()=>SwapTokenSelectModal});var r=n(324586),o=n(586330),c=n(514041),a=n(654266),i=n(241440),s=n(908867),u=n(490343),d=n(610421),l=n(325809),f=n(791088),w=n(771821),p=n(498356),k=n(82506),b=n(162616),I=n(325529),m=n(259227),S=n(334439),y=n(663522),g=n(628380),A=n(491180),h=n(117746),v=n(734818),j=n(714191),O=n(58546),T=n(619390),x=n(885127),N=n(812715),$=n(304695),P=n(831085);const E=(0,c.memo)((function({networks:e,selectedNetwork:t,onSelectNetwork:n,disableMoreNetworks:r,disableNetworks:o,moreNetworksCount:a,onMoreNetwork:i}){var{width:d}=(0,N.A)(),l=(0,s.A)(),f=d>380,w=(0,c.useMemo)((function(){return f?e:e.slice(0,4)}),[e,f]);return(0,P.jsxs)(u.XStack,{px:"$5",pt:"$1",pb:"$3",gap:"$2",children:[w.map((function(e){return(0,P.jsx)($.V,{disabled:Boolean(o?.includes(e.networkId)),networkImageUri:e.logoURI,tooltipContent:e.isAllNetworks?l.formatMessage({id:S.ETranslations.global_all_networks}):e.name,isSelected:e?.networkId===t?.networkId,onPress:o?.includes(e.networkId)?void 0:function(){n(e)}},e.networkId)})),a&&a>0?(0,P.jsx)($.V,{disabled:r,networkName:`${a}+`,flex:1,onPress:r?void 0:i}):null]})}));var _=n(17617);const R=(0,c.memo)((function({onSelectToken:e,selectedToken:t,tokens:n}){return(0,P.jsx)(u.XStack,{pt:"$1",pb:"$3",gap:"$1.5",flexWrap:"wrap",children:n.map((function(n){return(0,P.jsxs)(u.XStack,{role:"button",userSelect:"none",alignItems:"center",px:"$1.5",py:"$1",bg:"$bg",borderRadius:"$4",borderWidth:_.A.hairlineWidth,borderColor:"$borderSubdued",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusVisibleStyle:{outlineColor:"$focusRing",outlineStyle:"solid",outlineWidth:2,outlineOffset:2},disabled:!!(0,v.BQ)({token1:t,token2:n}),onPress:function(){e(n)},disabledStyle:{opacity:.5},children:[(0,P.jsx)(u.Image,{height:"$4.5",width:"$4.5",borderRadius:"$full",children:(0,P.jsx)(u.Image.Source,{source:{uri:n.logoURI}})}),(0,P.jsx)(u.SizableText,{pl:"$1",size:"$bodyLgMedium",children:n.symbol})]},n.contractAddress)}))})}));var M=n(20322),C=n(866063),D=n(309008);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var SwapTokenSelectPage=function(){var e=(0,p.A)(),t=(0,a.lq)(),n=(0,c.useMemo)((function(){var e;return null!=(e=t.params?.type)?e:T.En.FROM}),[t.params?.type]),r=(0,s.A)(),[l,j]=(0,c.useState)(""),N=(0,k.d)(l,500),[$]=(0,I.qv)(),[_]=(0,I.qv)(),[D]=(0,I.NE)(),[F]=(0,I.sK)(),L=(0,M.zf)(T.En.FROM),z=(0,M.zf)(T.En.TO),[U]=(0,I.Q8)(),[V]=(0,m.useSettingsPersistAtom)(),{selectFromToken:K,selectToToken:B,syncNetworksSort:W}=(0,I.eR)().current,{updateSelectedAccountNetwork:X}=(0,b.z$)().current,q=(0,c.useCallback)((function(){if(n===T.En.FROM){var e,t;if(D?.networkId)return null!=(e=_.find((function(e){return e.networkId===D.networkId})))?e:_?.[0];if(U?.networkId&&F===T.qX.SWAP)return null!=(t=_.find((function(e){return e.networkId===U.networkId})))?t:_?.[0]}else{var r,o;if(U?.networkId)return null!=(r=_.find((function(e){return e.networkId===U.networkId})))?r:_?.[0];if(D?.networkId&&F===T.qX.SWAP)return null!=(o=_.find((function(e){return e.networkId===D.networkId})))?o:_?.[0]}return _?.[0]}),[D?.networkId,_,F,U?.networkId,n]),[Z,H]=(0,c.useState)(q),Q=(0,c.useRef)(null);(0,c.useEffect)((function(){var e=n===T.En.FROM?L.networkId:z.networkId;Z?.networkId&&Z?.networkId!==e&&X({num:n===T.En.FROM?0:1,networkId:Z?.networkId})}),[]);var Y,G,{fetchLoading:J,currentTokens:ee}=(0,C.GM)(n,Z?.networkId,N),te=(0,c.useMemo)((function(){return ee.findIndex((function(e){var t=e.item?e.item:e;return!t.price||new i.A(t.price).isZero()}))}),[ee]),ne=(0,c.useCallback)((Y=(0,o.A)((function*(e){var t=!e.isPopular&&(!e.price||new i.A(e.price).isZero()||e.riskLevel===T.eU.SPAM||e.riskLevel===T.eU.MALICIOUS);return t?!!V.tokenRiskReminder&&!(yield d.A.serviceSetting.checkConfirmedRiskToken(`${e.networkId}_${e.contractAddress}`)):t})),function(e){return Y.apply(this,arguments)}),[V.tokenRiskReminder]),re=(0,c.useCallback)((function(t){e.popStack(),n===T.En.FROM?K(t):B(t)}),[e,K,B,n]),oe=(0,c.useCallback)((G=(0,o.A)((function*(n){(yield ne(n))?e.push(g.u.TokenRiskReminder,{storeName:t.params.storeName,token:n,onConfirm:function(){re(n)}}):re(n)})),function(e){return G.apply(this,arguments)}),[ne,e,t.params.storeName,re]),ce=(0,c.useCallback)((function(e){H(e),Q.current?.scrollToOffset({offset:0,animated:!1})}),[]),ae=(0,c.useCallback)((function(e){return(0,v.BQ)({token1:{networkId:n===T.En.FROM?U?.networkId:D?.networkId,contractAddress:n===T.En.FROM?U?.contractAddress:D?.contractAddress},token2:{networkId:e.networkId,contractAddress:e.contractAddress}})}),[D?.contractAddress,D?.networkId,U?.contractAddress,U?.networkId,n]),{md:ie}=(0,u.useMedia)(),{copyText:se}=(0,u.useClipboard)(),ue=(0,c.useMemo)((function(){var e=[],t=_.map((function(e){return e.networkId}));return F===T.qX.SWAP&&n===T.En.TO&&D&&(e=t.filter((function(e){return e!==D?.networkId}))),n===T.En.TO&&D&&F===T.qX.BRIDGE&&(e=t.filter((function(e){return e===D?.networkId}))),n===T.En.FROM&&F===T.qX.BRIDGE&&U&&(e=t.filter((function(e){return e===U?.networkId}))),e}),[D,_,F,U,n]),de=(0,c.useCallback)((function({item:e,index:t}){var n,c,a,s,l=e.item?e.item:e,p=new i.A(null!=(n=l.balanceParsed)?n:0),k=new i.A(null!=(c=l.fiatValue)?c:0),b=ie?A.A.shortenAddress({address:l.contractAddress}):l.contractAddress,I={isSearch:!!N,tokenImageSrc:l.logoURI,tokenName:l.name,tokenSymbol:l.symbol,networkImageSrc:l.networkLogoURI,tokenContrastAddress:N?b:void 0,balance:p.isZero()?void 0:l.balanceParsed,valueProps:l.fiatValue&&!k.isZero()?{value:l.fiatValue,currency:V.currencyInfo.symbol}:void 0,onPress:ae(l)||ue.includes(l.networkId)?void 0:function(){return oe(l)},disabled:ae(l)||ue.includes(l.networkId),titleMatchStr:e.matches?.find((function(e){return"symbol"===e.key}))};return(0,P.jsxs)(P.Fragment,{children:[te===t?(0,P.jsx)(u.Stack,{pt:"$3",pb:"$2",children:(0,P.jsx)(u.Alert,{fullBleed:!0,type:"default",title:r.formatMessage({id:S.ETranslations.token_selector_unverified_token_warning}),icon:"InfoCircleOutline"})}):null,(0,P.jsx)(w.v,_objectSpread(_objectSpread({},I),{},{moreComponent:(0,P.jsx)(u.Stack,{alignSelf:"center",children:(0,P.jsx)(u.ActionList,{title:null!=(a=I.tokenSymbol)?a:"",disabled:l.isNative,renderTrigger:(0,P.jsx)(f.c.IconButton,{icon:"DotVerSolid",variant:"tertiary"}),items:[{icon:"Copy3Outline",label:r.formatMessage({id:S.ETranslations.global_copy_token_contract}),onPress:function(){se(l.contractAddress)},disabled:l.isNative},{icon:"OpenOutline",label:r.formatMessage({id:S.ETranslations.swap_token_selector_contract_info}),onPress:(s=(0,o.A)((function*(){var e=yield d.A.serviceExplorer.buildExplorerUrl({networkId:l.networkId,type:"token",param:l.contractAddress});(0,h.Dr)(e)})),function onPress(){return s.apply(this,arguments)}),disabled:l.isNative}]})})}))]})}),[te,se,ue,r,ie,oe,ae,N,V.currencyInfo.symbol]),le=(0,c.useMemo)((function(){var e=!1,t=_.length-ue.length;return ie?t<=O.ck&&(e=!0):t<=O.BT&&(e=!0),e}),[ue.length,ie,_.length]),fe=(0,c.useMemo)((function(){var e,t=[];return _&&_.length&&(ie?(t=_.length>O.ck?_.slice(0,O.ck):_,e=_.length-O.ck>0?_.length-O.ck:void 0):(t=_.length>O.BT?_.slice(0,O.BT):_,e=_.length-O.BT>0?_.length-O.BT:void 0)),{swapNetworksCommon:t,swapNetworksMoreCount:e}}),[ie,_]),we=(0,x.A)(),{bottom:pe}=(0,u.useSafeAreaInsets)(),ke=(0,c.useMemo)((function(){var e;return Z?.networkId&&null!=(e=O.hm[Z?.networkId])?e:[]}),[Z?.networkId]);return(0,P.jsxs)(u.Page,{skipLoading:y.Ay.isNativeIOS,safeAreaEnabled:!1,children:[(0,P.jsx)(u.Page.Header,{title:r.formatMessage({id:S.ETranslations.token_selector_title}),headerSearchBarOptions:{placeholder:r.formatMessage({id:S.ETranslations.token_selector_search_placeholder}),onChangeText:function({nativeEvent:e}){var t=e.text.trim();j(t)}}}),(0,P.jsxs)(u.Page.Body,{children:[(0,P.jsxs)(u.XStack,{px:"$5",pb:"$2",children:[(0,P.jsx)(u.SizableText,{size:"$bodyMd",color:"$textSubdued",pr:"$2",children:`${r.formatMessage({id:S.ETranslations.token_selector_network})}`}),(0,P.jsx)(u.XStack,{children:(0,P.jsx)(u.SizableText,{size:"$bodyMd",children:Z?.isAllNetworks?r.formatMessage({id:S.ETranslations.global_all_networks}):Z?.name})})]}),(0,P.jsx)(E,{onMoreNetwork:function(){we({defaultNetworkId:Z?.networkId,networkIds:$.filter((function(e){return!e.isAllNetworks})).filter((function(e){return!ue.includes(e.networkId)})).map((function(e){return e.networkId})),grouped:!1,onSelect:function(e){if(e){var t=$.find((function(t){return t.networkId===e.id}));t&&(ce(t),W(t.networkId))}}})},networks:fe.swapNetworksCommon,moreNetworksCount:fe.swapNetworksMoreCount,selectedNetwork:Z,disableNetworks:ue,disableMoreNetworks:le,onSelectNetwork:ce}),ke.length>0&&!N?(0,P.jsx)(u.Divider,{mt:"$2"}):null,(0,P.jsx)(u.YStack,{flex:1,children:(0,P.jsx)(u.ListView,{ref:Q,data:ee,renderItem:de,estimatedItemSize:60,ListHeaderComponent:ke.length>0&&!N?(0,P.jsxs)(u.YStack,{px:"$5",pt:"$3",gap:"$2",children:[(0,P.jsx)(u.SizableText,{size:"$bodyMd",color:"$textSubdued",pr:"$2",children:`${r.formatMessage({id:S.ETranslations.swap_token_selector_popular_token})}`}),(0,P.jsx)(R,{onSelectToken:oe,selectedToken:n===T.En.FROM?U:D,tokens:ke})]}):null,ListFooterComponent:(0,P.jsx)(u.Stack,{h:pe||"$2"}),ListEmptyComponent:J?(0,P.jsx)(P.Fragment,{children:Array.from({length:5}).map((function(e,t){return(0,P.jsxs)(f.c,{children:[(0,P.jsx)(u.Skeleton,{w:"$10",h:"$10",radius:"round"}),(0,P.jsxs)(u.YStack,{children:[(0,P.jsx)(u.YStack,{py:"$1",children:(0,P.jsx)(u.Skeleton,{h:"$4",w:"$32"})}),(0,P.jsx)(u.YStack,{py:"$1",children:(0,P.jsx)(u.Skeleton,{h:"$3",w:"$24"})})]})]},t)}))}):(0,P.jsx)(u.Empty,{icon:"SearchOutline",title:r.formatMessage({id:S.ETranslations.global_no_results}),description:r.formatMessage({id:S.ETranslations.token_no_search_results_desc})})})})]})]})},SwapTokenSelectPageWithProvider=function(){var e=(0,a.lq)(),{storeName:t}=e.params;return(0,P.jsx)(D.o,{storeName:t,children:(0,P.jsx)(SwapTokenSelectPage,{})})};function SwapTokenSelectModal(){return(0,P.jsx)(l.b8,{config:{sceneName:j.Zs.swap},enabledNum:[0,1],children:(0,P.jsx)(SwapTokenSelectPageWithProvider,{})})}}}]);