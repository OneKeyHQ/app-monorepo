"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[45222],{326745:(e,t,n)=>{n.d(t,{u:()=>useAppRoute});var a=n(654266);function useAppRoute(){return(0,a.lq)()}},925771:(e,t,n)=>{n.d(t,{$:()=>CalculationListItem,k:()=>CalculationList});var a=n(324586),r=n(839850),i=n(490343),s=n(831085),o=["children"],l=["children"],c=["children"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function CalculationList({children:e}){return(0,s.jsx)(i.YStack,{gap:"$4",children:e})}function CalculationListItem(e){var{children:t}=e,n=(0,r.A)(e,o);return(0,s.jsx)(i.XStack,_objectSpread(_objectSpread({animation:"quick",enterStyle:{opacity:0},justifyContent:"space-between",alignItems:"center"},n),{},{children:t}))}CalculationList.Item=CalculationListItem,CalculationListItem.Label=function CalculationListItemLabel(e){var{children:t}=e,n=(0,r.A)(e,l);return(0,s.jsx)(i.SizableText,_objectSpread(_objectSpread({color:"$textSubdued"},n),{},{children:t}))},CalculationListItem.Value=function CalculationListItemValue(e){var{children:t}=e,n=(0,r.A)(e,c);return(0,s.jsx)(i.SizableText,_objectSpread(_objectSpread({size:"$bodyLgMedium"},n),{},{children:t}))}},713989:(e,t,n)=>{n.d(t,{G:()=>StakeShouldUnderstand,a:()=>WithdrawShouldUnderstand});var a=n(908867),r=n(490343),i=n(334439),s=n(831085),ShouldUnderstandListItemListItem=function({title:e,description:t,index:n}){return(0,s.jsxs)(r.YStack,{children:[(0,s.jsxs)(r.XStack,{children:[(0,s.jsx)(r.Stack,{w:"$5",children:(0,s.jsxs)(r.SizableText,{children:[n,"."]})}),(0,s.jsx)(r.Stack,{flex:1,children:(0,s.jsx)(r.SizableText,{children:e})})]}),t?(0,s.jsx)(r.XStack,{pl:"$5",children:(0,s.jsx)(r.SizableText,{children:t})}):null]})},ShouldUnderstand=function({items:e}){return(0,s.jsx)(r.YStack,{flex:1,children:(0,s.jsx)(r.ScrollView,{maxHeight:560,children:(0,s.jsx)(r.YStack,{gap:"$5",children:e.map((function(e,t){return(0,s.jsx)(ShouldUnderstandListItemListItem,{index:t+1,title:e.title,description:e.description},t)}))})})})},createTypography=function(e,t){return t?e:""},StakeShouldUnderstand=function({provider:e,symbol:t,apr:n,updateFrequency:o,receiveSymbol:l,unstakingPeriod:c}){var u=(0,a.A)(),d=[];return d="everstake"===e&&["sol","eth","apt"].includes(t)?[createTypography(u.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[n,"%"]})}),n),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:o})}),o),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:u.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(u.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:c}),c)]:"everstake"===e&&["atom","matic"].includes(t)?[createTypography(u.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[n,"%"]})}),{number:n}),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:o})}),o),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_manually_restaked},{manually:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:u.formatMessage({id:i.ETranslations.earn_manually})})}),!0),createTypography(u.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:c}),c)]:"lido"===e&&["eth","matic"].includes(t)?[createTypography(u.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[n,"%"]})}),n),createTypography(u.formatMessage({id:i.ETranslations.earn_receive_token_trade_anytime},{token:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:l})}),l),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:o})}),o),createTypography(u.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:u.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(u.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:c}),c)]:"babylon"===e?[u.formatMessage({id:i.ETranslations.earn_stake_through_onekey_earn_points}),u.formatMessage({id:i.ETranslations.earn_check_staking_results_overflow}),createTypography(u.formatMessage({id:i.ETranslations.earn_early_withdraw_stake_unstaking_period},{number:c}),c)]:[createTypography(u.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:null!=n?n:4})}),!0)],(0,s.jsx)(ShouldUnderstand,{items:d.filter((function(e){return!!e})).map((function(e){return{title:e}}))})},WithdrawShouldUnderstand=function({withdrawalPeriod:e}){var t=(0,a.A)();return(0,s.jsx)(ShouldUnderstand,{items:[{title:t.formatMessage({id:i.ETranslations.earn_withdrawal_take_up_to_number_days},{number:e})},{title:t.formatMessage({id:i.ETranslations.earn_claim_assets_after_processing})}]})}},286192:(e,t,n)=>{n.d(t,{BA:()=>EstimateNetworkFee,QL:()=>useShowClaimEstimateGasAlert,fH:()=>calcDaysSpent,sM:()=>useShowStakeEstimateGasAlert});var a=n(514041),r=n(241440),i=n(908867),s=n(490343),o=n(259227),l=n(334439),c=n(925771),u=n(831085),useShowStakeEstimateGasAlert=function(){var e=(0,i.A)(),[{currencyInfo:{symbol:t}}]=(0,o.useSettingsPersistAtom)();return(0,a.useCallback)((function({daysConsumed:n,estFiatValue:a,onConfirm:r}){var i=n?e.formatMessage({id:l.ETranslations.earn_transaction_loss_when_stake},{number:(0,u.jsx)(s.SizableText,{size:"$bodyLgMedium",color:"$textCaution",children:n})}):void 0;s.Dialog.show({title:e.formatMessage({id:l.ETranslations.earn_transaction_loss}),icon:"InfoCircleOutline",description:i,renderContent:(0,u.jsxs)(s.XStack,{children:[(0,u.jsxs)(s.SizableText,{size:"$bodyLg",mr:"$1",children:[e.formatMessage({id:l.ETranslations.global_est_network_fee}),":"]}),(0,u.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:t},children:a})]}),onConfirm:r})}),[e,t])},useShowClaimEstimateGasAlert=function(){var e=(0,i.A)(),[{currencyInfo:{symbol:t}}]=(0,o.useSettingsPersistAtom)();return(0,a.useCallback)((function({claimTokenFiatValue:n,estFiatValue:a,onConfirm:i}){var o=(0,r.A)(n).minus(a).absoluteValue().toFixed(),c=e.formatMessage({id:l.ETranslations.earn_transaction_loss_when_claim},{number:(0,u.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",color:"$textCaution",formatterOptions:{currency:t},children:o})});s.Dialog.show({title:e.formatMessage({id:l.ETranslations.earn_transaction_loss}),icon:"InfoCircleOutline",description:c,renderContent:(0,u.jsxs)(s.YStack,{children:[(0,u.jsxs)(s.XStack,{children:[(0,u.jsxs)(s.SizableText,{size:"$bodyLg",mr:"$1",children:[e.formatMessage({id:l.ETranslations.global_est_network_fee}),":"]}),(0,u.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:t},children:a})]}),(0,u.jsxs)(s.XStack,{children:[(0,u.jsxs)(s.SizableText,{size:"$bodyLg",mr:"$1",children:[e.formatMessage({id:l.ETranslations.earn_reward_value}),":"]}),(0,u.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:t},children:n})]})]}),onConfirm:i})}),[e,t])},EstimateNetworkFeeListItem=function({estFiatValue:e,onPress:t}){var n=(0,i.A)(),[{currencyInfo:{symbol:a}}]=(0,o.useSettingsPersistAtom)();return Number(e)>0?(0,u.jsxs)(c.$,{onPress:t,children:[(0,u.jsx)(c.$.Label,{children:n.formatMessage({id:l.ETranslations.global_est_network_fee})}),(0,u.jsxs)(s.XStack,{alignItems:"center",cursor:t?"pointer":void 0,mr:t?-6:void 0,children:[(0,u.jsx)(s.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:a},children:e}),t?(0,u.jsx)(s.Icon,{name:"ChevronRightSmallOutline",size:24}):null]})]}):null},calcDaysSpent=function(e,t){var n=(0,r.A)(t).div(e).multipliedBy(365);return n.isNaN()?void 0:Math.ceil(n.toNumber())},EstimateNetworkFee=function({estimateFeeResp:e,onPress:t,isVisible:n}){return e&&n?(0,u.jsx)(EstimateNetworkFeeListItem,{estFiatValue:e.feeFiatValue,onPress:t}):null}},87474:(e,t,n)=>{n.d(t,{A:()=>StakingFormWrapper});var a=n(324586),r=n(839850),i=n(490343),s=n(831085),o=["children"];function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function StakingFormWrapper(e){var{children:t}=e,n=(0,r.A)(e,o);return(0,s.jsx)(i.YStack,_objectSpread(_objectSpread({p:"$5",gap:"$5"},n),{},{children:t}))}},939799:(e,t,n)=>{n.d(t,{A:()=>ValuePriceListItem});var a=n(490343),r=n(831085),ValuePriceListItem=function({amount:e,tokenSymbol:t,fiatSymbol:n,fiatValue:i}){return(0,r.jsxs)(a.XStack,{gap:"$1",maxWidth:"$56",justifyContent:"flex-end",flexWrap:"wrap",children:[(0,r.jsx)(a.XStack,{children:(0,r.jsx)(a.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:t},children:e})}),(0,r.jsx)(a.XStack,{maxWidth:"$56",children:i?(0,r.jsxs)(a.SizableText,{children:["(",(0,r.jsx)(a.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:n},children:i}),")"]}):null})]})}},90393:(e,t,n)=>{n.d(t,{Z:()=>useProviderLabel});var a=n(908867),r=n(334439),useProviderLabel=function(e){var t=(0,a.A)(),n=t.formatMessage({id:r.ETranslations.global_protocol});return"everstake"===e.toLowerCase()?n=t.formatMessage({id:r.ETranslations.earn_validator}):"babylogn"===e.toLowerCase()&&(n=t.formatMessage({id:r.ETranslations.earn_finality_provider})),n}},653913:(e,t,n)=>{n.d(t,{B8:()=>useUniversalStake,D0:()=>useUniversalClaim,Pg:()=>useUniversalWithdraw});var a=n(586330),r=n(514041),i=n(241440),s=n(610421),o=n(927799),l=n(553083),c=n(161024),u=n(286192);function useUniversalStake({networkId:e,accountId:t}){var n,{navigationToSendConfirm:i}=(0,o.E)({accountId:t,networkId:e});return(0,r.useCallback)((n=(0,a.A)((function*({amount:n,symbol:a,term:r,feeRate:o,provider:c,stakingInfo:u,onSuccess:d,onFail:m}){var f,b,p=yield s.A.serviceStaking.buildStakeTransaction({amount:n,networkId:e,accountId:t,symbol:a,term:r,provider:c,feeRate:o}),g=yield s.A.serviceStaking.buildEarnTx({networkId:e,accountId:t,tx:p});l.Ay.isBTCNetwork(e)&&g.fee&&(f=!0,b=!1),yield i({encodedTx:g,stakingInfo:u,onSuccess:d,onFail:m,useFeeInTx:f,feeInfoEditable:b})})),function(e){return n.apply(this,arguments)}),[i,t,e])}function useUniversalWithdraw({networkId:e,accountId:t}){var n,{navigationToSendConfirm:i}=(0,o.E)({accountId:t,networkId:e});return(0,r.useCallback)((n=(0,a.A)((function*({amount:n,symbol:r,provider:o,identity:u,stakingInfo:d,onSuccess:m,onFail:f}){var b,p=yield s.A.serviceStaking.getStakingConfigs({networkId:e,symbol:r,provider:o});if(!p)throw new Error("Staking config not found");if(p?.unstakeWithSignMessage){var g=yield s.A.serviceAccount.getAccount({accountId:t,networkId:e}),{message:x,deadline:y}=yield s.A.serviceStaking.buildLidoEthPermitMessageData({accountId:t,networkId:e,amount:n}),k=yield s.A.serviceDApp.openSignMessageModal({accountId:t,networkId:e,request:{origin:"https://lido.fi/",scope:"ethereum"},unsignedMessage:{type:c.$.TYPED_DATA_V4,message:x,payload:[g.address,x]},walletInternalSign:!0});b=yield s.A.serviceStaking.buildUnstakeTransaction({amount:n,networkId:e,accountId:t,symbol:r,provider:o,signature:k,deadline:y})}else b=yield s.A.serviceStaking.buildUnstakeTransaction({amount:n,identity:u,networkId:e,accountId:t,symbol:r,provider:o});var h,_,v,S=yield s.A.serviceStaking.buildEarnTx({networkId:e,accountId:t,tx:b});l.Ay.isBTCNetwork(e)&&S.fee&&(h=!0,_=!1),yield i({encodedTx:S,stakingInfo:d,signOnly:p?.withdrawSignOnly,useFeeInTx:h,feeInfoEditable:_,onSuccess:(v=(0,a.A)((function*(n){if(p?.withdrawSignOnly){var a=n[0].signedTx.finalizedPsbtHex;a&&u&&(yield s.A.serviceStaking.unstakePush({txId:u,networkId:e,accountId:t,symbol:r,provider:o,unstakeTxHex:a}),m?.(n))}else m?.(n)})),function onSuccess(e){return v.apply(this,arguments)}),onFail:f})})),function(e){return n.apply(this,arguments)}),[t,e,i])}function useUniversalClaim({networkId:e,accountId:t}){var n,{navigationToSendConfirm:c}=(0,o.E)({accountId:t,networkId:e}),d=(0,u.QL)();return(0,r.useCallback)((n=(0,a.A)((function*({identity:n,amount:r,provider:o,symbol:u,stakingInfo:m,onSuccess:f,onFail:b}){var p,g=(p=(0,a.A)((function*(){var a,i,d=yield s.A.serviceStaking.buildClaimTransaction({networkId:e,accountId:t,symbol:u,provider:o,amount:r,identity:n}),p=yield s.A.serviceStaking.buildEarnTx({networkId:e,accountId:t,tx:d});l.Ay.isBTCNetwork(e)&&p.fee&&(a=!0,i=!1),yield c({encodedTx:p,stakingInfo:m,onSuccess:f,onFail:b,useFeeInTx:a,feeInfoEditable:i})})),function continueClaim(){return p.apply(this,arguments)});if(Number(r)>0){var x=yield s.A.serviceStaking.estimateFee({networkId:e,provider:o,symbol:u,action:"claim",amount:r}),y=(0,i.A)(x.token.price).multipliedBy(r);if(y.lt(x.feeFiatValue))return void d({claimTokenFiatValue:y.toFixed(),estFiatValue:x.feeFiatValue,onConfirm:g})}yield g()})),function(e){return n.apply(this,arguments)}),[c,t,e,d])}},545222:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Stake});var a=n(586330),r=n(514041),i=n(908867),s=n(490343),o=n(610421),l=n(498356),c=n(326745),u=n(911998),d=n(334439),m=n(948675),f=n(567807),b=n(553083),p=n(73197),g=n(550082),x=n(241440),y=n(728046),k=n(88803),h=n(259227),_=n(905817),v=n(925771),S=n(831085),T=1e6,BtcFeeRateInputDialogContent=function({estimateFeeUTXO:e,feeRate:t,onSaveFeeRate:n}){var a,o=(0,i.A)(),l=(0,s.useDialogInstance)(),[c,u]=(0,r.useState)(t.feeType),[m,f]=(0,r.useState)(null!=(a=t.value)?a:"1"),b=(0,r.useMemo)((function(){return[{label:o.formatMessage({id:d.ETranslations.transaction_slow}),type:"slow"},{label:o.formatMessage({id:d.ETranslations.transaction_normal}),type:"normal"},{label:o.formatMessage({id:d.ETranslations.transaction_fast}),type:"fast"},{label:o.formatMessage({id:d.ETranslations.transaction_custom}),type:"custom"}]}),[o]),p=(0,r.useMemo)((function(){if(["slow","normal","fast"].includes(c)){var t=b.findIndex((function(e){return e.type===c})),n=e[t].feeRate;return{feeType:c,value:n}}return{feeType:"custom",value:m}}),[c,e,b,m]),g=(0,r.useMemo)((function(){var e=new x.A(m);if(e.isNaN()||e.isLessThan(1)||e.isGreaterThan(T))return o.formatMessage({id:d.ETranslations.form_ree_rate_error_out_of_range},{min:1,max:T})}),[o,m]),y=(0,r.useCallback)((function(){l.close(),n?.(p)}),[l,n,p]),k=Boolean("custom"===c&&g);return(0,S.jsxs)(s.Stack,{children:[(0,S.jsx)(s.SegmentControl,{fullWidth:!0,value:c,onChange:function(e){u(e)},options:b.map((function(e){return{value:e.type,label:(0,S.jsx)(s.SizableText,{color:c===e.type?"$textInteractive":"$textSubdued",size:"$bodyMdMedium",textAlign:"center",children:e.label})}}))}),(0,S.jsx)(s.Divider,{my:"$5"}),"custom"===c?(0,S.jsxs)(s.YStack,{children:[(0,S.jsx)(s.Input,{addOns:[{label:"sat/vB"}],value:m,onChangeText:function(e){var t=(0,x.A)(e);""!==e&&t.isNaN()||f(e)}}),g?(0,S.jsx)(s.SizableText,{pt:"$1.5",animation:"quick",enterStyle:{opacity:0,y:-6},exitStyle:{opacity:0,y:-6},children:(0,S.jsx)(s.SizableText,{color:"$textCritical",size:"$bodyMd",children:g})}):null]}):(0,S.jsxs)(s.XStack,{jc:"space-between",children:[(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:o.formatMessage({id:d.ETranslations.fee_fee_rate})}),(0,S.jsxs)(s.SizableText,{size:"$bodyMdMedium",children:[p.value," sat/vB"]})]}),(0,S.jsx)(s.Stack,{pt:"$5",children:(0,S.jsx)(s.Button,{size:"large",variant:"primary",onPress:y,disabled:k,children:o.formatMessage({id:d.ETranslations.action_save})})})]})},BtcFeeRateInput=function({estimateFeeUTXO:e,onFeeRateChange:t}){var n,a,o=(0,i.A)(),[,l]=null!=e?e:[],[c,u]=(0,r.useState)({feeType:"normal",value:null!=(n=l?.feeRate)?n:"1"}),m=(0,r.useMemo)((function(){return{slow:o.formatMessage({id:d.ETranslations.transaction_slow}),normal:o.formatMessage({id:d.ETranslations.transaction_normal}),fast:o.formatMessage({id:d.ETranslations.transaction_fast}),custom:o.formatMessage({id:d.ETranslations.transaction_custom})}}),[o]);(0,r.useEffect)((function(){t?.(c.value)}),[c,t]);var f=(0,r.useCallback)((function(){e&&s.Dialog.show({title:o.formatMessage({id:d.ETranslations.fee_fee_rate}),renderContent:(0,S.jsx)(BtcFeeRateInputDialogContent,{estimateFeeUTXO:e,onSaveFeeRate:u,feeRate:c}),showFooter:!1})}),[o,e,c]);return e?(0,S.jsxs)(v.$,{onPress:f,children:[(0,S.jsx)(v.$.Label,{children:o.formatMessage({id:d.ETranslations.fee_fee_rate})}),(0,S.jsxs)(s.XStack,{alignItems:"center",cursor:"pointer",mr:-6,children:[(0,S.jsxs)(s.XStack,{gap:"$1",children:[(0,S.jsx)(s.SizableText,{size:"$bodyLgMedium",children:null!=(a=m[c.feeType])?a:c.feeType}),(0,S.jsxs)(s.SizableText,{size:"$bodyLgMedium",children:["(",c.value,"sat/vB)"]})]}),(0,S.jsx)(s.Icon,{name:"ChevronRightSmallOutline",size:24})]})]}):null},j=n(713989),w=n(286192),M=n(87474),I=n(939799),UniversalStake=function({price:e,balance:t,apr:n,details:o,decimals:l,minAmount:c="0",minTransactionFee:u="0",providerLabel:m,minStakeTerm:b,minStakeBlocks:g,tokenImageUri:T,tokenSymbol:A,providerName:C,providerLogo:$,isReachBabylonCap:E,showEstReceive:F,estReceiveToken:z,estReceiveTokenRate:L="1",estimateFeeResp:O,estimateFeeUTXO:P,isDisabled:N,maxAmount:V,onConfirm:R,onFeeRateChange:B}){var D=(0,i.A)(),U=(0,w.sM)(),[X,Y]=(0,r.useState)(!1),[q,W]=(0,r.useState)(""),[{currencyInfo:{symbol:G}}]=(0,h.useSettingsPersistAtom)(),H=(0,r.useCallback)((function(e){if(new x.A(e).isNaN())""===e&&W("");else{var t=Boolean(l&&Number(l)>0&&(0,_.FZ)(e)>l);W(t?function(e){return e}:e)}}),[l]),K=(0,r.useCallback)((function(){var e=new x.A(t).minus(u);e.gt(0)?H(e.toFixed()):H(t)}),[H,t,u]),Z=(0,r.useMemo)((function(){if(Number(q)>0&&Number(e)>0)return new x.A(q).multipliedBy(e).toFixed()}),[q,e]),Q=(0,r.useMemo)((function(){return new x.A(q).gt(t)}),[q,t]),J=(0,r.useMemo)((function(){var e=new x.A(c),t=new x.A(q);return!(!e.isGreaterThan(0)||!t.isGreaterThan(0))&&t.isLessThan(e)}),[c,q]),ee=(0,r.useMemo)((function(){return!!(V&&Number(V)>0&&Number(q)>0)&&new x.A(q).isGreaterThan(V)}),[V,q]),te=(0,r.useMemo)((function(){var e=(0,x.A)(q);return e.isNaN()||e.isLessThanOrEqualTo(0)||Q||J||ee||E}),[q,Q,J,ee,E]),ne=(0,r.useMemo)((function(){if(Number(q)>0&&Number(n)>0){var t=(0,x.A)(q).multipliedBy(null!=n?n:0).dividedBy(100);return{amount:t.toFixed(),fiatValue:Number(e)>0?t.multipliedBy(e).toFixed():void 0}}}),[q,n,e]),ae=(0,r.useMemo)((function(){if(b&&Number(b)>0&&g){var e=Math.ceil(b/864e5);return D.formatMessage({id:d.ETranslations.earn_number_days_number_block},{number_days:e,number:g})}return null}),[b,g,D]),re=(0,r.useMemo)((function(){if(b){var e=new Date,t=new Date(e.getTime()+b);return(0,f.Yq)(t,{hideTimeForever:!0})}return null}),[b]),ie=(0,r.useMemo)((function(){if(ne?.fiatValue&&O?.feeFiatValue)return(0,w.fH)(ne?.fiatValue,O.feeFiatValue)}),[O?.feeFiatValue,ne?.fiatValue]),se=(0,r.useCallback)((0,a.A)((function*(){y.A.dismiss();var showDialog=function(){var e;s.Dialog.show({renderIcon:(0,S.jsx)(s.Image,{width:"$14",height:"$14",src:o.token.info.logoURI}),title:D.formatMessage({id:d.ETranslations.earn_provider_asset_staking},{provider:(0,_.c)(o.provider.name.toLowerCase()),asset:o.token.info.symbol.toUpperCase()}),renderContent:(0,S.jsx)(j.G,{provider:o.provider.name.toLowerCase(),symbol:o.token.info.symbol.toLowerCase(),apr:o.provider.apr,updateFrequency:o.updateFrequency,unstakingPeriod:o.unstakingPeriod,receiveSymbol:o.rewardToken}),onConfirm:(e=(0,a.A)((function*(e){try{Y(!0),yield e.close(),yield R?.(q)}finally{Y(!1)}})),function onConfirm(t){return e.apply(this,arguments)}),onConfirmText:D.formatMessage({id:d.ETranslations.earn_stake}),showCancelButton:!1})};if(ne?.fiatValue&&O){var e=(0,w.fH)(ne.fiatValue,O.feeFiatValue);if(e&&e>5)return void U({daysConsumed:e,estFiatValue:O.feeFiatValue,onConfirm:showDialog})}showDialog()})),[R,q,o,D,ne?.fiatValue,O,U]);return(0,S.jsxs)(M.A,{children:[(0,S.jsxs)(s.Stack,{position:"relative",opacity:N?.7:1,children:[(0,S.jsx)(k.J,{bg:N?"$bgDisabled":"$bgApp",hasError:Q||J,value:q,onChange:H,tokenSelectorTriggerProps:{selectedTokenImageUri:T,selectedTokenSymbol:A?.toUpperCase()},balanceProps:{value:t,onPress:K},inputProps:{placeholder:"0",autoFocus:!N},valueProps:{value:Z,currency:Z?G:void 0},enableMaxAmount:!0}),N?(0,S.jsx)(s.Stack,{position:"absolute",w:"100%",h:"100%",zIndex:1}):null]}),J?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:D.formatMessage({id:d.ETranslations.earn_minimum_amount},{number:c,symbol:A})}):null,Q?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:D.formatMessage({id:d.ETranslations.earn_insufficient_balance})}):null,ee?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:D.formatMessage({id:d.ETranslations.earn_maximum_staking_alert},{number:null!=V?V:"",symbol:A})}):null,E?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:D.formatMessage({id:d.ETranslations.earn_reaching_staking_cap})}):null,(0,S.jsxs)(v.k,{children:[ne?(0,S.jsxs)(v.$,{children:[(0,S.jsx)(v.$.Label,{children:D.formatMessage({id:d.ETranslations.earn_est_annual_rewards})}),(0,S.jsx)(v.$.Value,{children:(0,S.jsx)(I.A,{tokenSymbol:null!=A?A:"",fiatSymbol:G,amount:ne.amount,fiatValue:ne.fiatValue})})]}):null,F&&z&&Number(q)>0?(0,S.jsxs)(v.$,{children:[(0,S.jsx)(v.$.Label,{children:D.formatMessage({id:d.ETranslations.earn_est_receive})}),(0,S.jsx)(v.$.Value,{children:(0,S.jsx)(s.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:z},children:(0,x.A)(q).multipliedBy(L).toFixed()})})]}):null,n&&Number(n)>0?(0,S.jsxs)(v.$,{children:[(0,S.jsx)(v.$.Label,{children:D.formatMessage({id:d.ETranslations.global_apr})}),(0,S.jsx)(v.$.Value,{color:"$textSuccess",children:`${n}%`})]}):null,ae?(0,S.jsxs)(v.$,{children:[(0,S.jsxs)(s.XStack,{flex:1,alignItems:"center",gap:"$1",children:[(0,S.jsx)(v.$.Label,{children:D.formatMessage({id:d.ETranslations.earn_term})}),(0,S.jsx)(s.Popover,{title:D.formatMessage({id:d.ETranslations.earn_term}),placement:"bottom-start",renderTrigger:(0,S.jsx)(s.IconButton,{iconColor:"$iconSubdued",size:"small",icon:"InfoCircleOutline",variant:"tertiary"}),renderContent:(0,S.jsx)(s.Stack,{p:"$5",children:(0,S.jsx)(s.SizableText,{children:D.formatMessage({id:d.ETranslations.earn_term_tooltip})})})})]}),(0,S.jsx)(v.$.Value,{children:ae})]}):null,re?(0,S.jsxs)(v.$,{children:[(0,S.jsx)(v.$.Label,{children:D.formatMessage({id:d.ETranslations.earn_unlock_time})}),(0,S.jsx)(v.$.Value,{children:re})]}):null,$&&C?(0,S.jsxs)(v.$,{children:[(0,S.jsx)(v.$.Label,{children:null!=m?m:D.formatMessage({id:d.ETranslations.global_protocol})}),(0,S.jsx)(v.$.Value,{children:(0,S.jsxs)(s.XStack,{gap:"$2",alignItems:"center",children:[(0,S.jsx)(s.Image,{width:"$5",height:"$5",src:$,borderRadius:"$2"}),(0,S.jsx)(s.SizableText,{size:"$bodyLgMedium",children:(0,_.c)(C)})]})})]}):null,O?(0,S.jsx)(w.BA,{estimateFeeResp:O,isVisible:!!ne?.fiatValue,onPress:function(){U({daysConsumed:ie,estFiatValue:O.feeFiatValue})}}):null,C?.toLowerCase()===p.e.Babylon.toLowerCase()&&P?(0,S.jsx)(BtcFeeRateInput,{estimateFeeUTXO:P,onFeeRateChange:B}):null]}),(0,S.jsx)(s.Page.Footer,{onConfirmText:D.formatMessage({id:d.ETranslations.global_continue}),confirmButtonProps:{onPress:se,loading:X,disabled:te}})]})},A=n(90393),C=n(653913);const Stake=function(){var e,t=(0,c.u)(),{accountId:n,networkId:x,details:y,onSuccess:k}=t.params,{token:h,provider:v,rewardToken:T}=y,{balanceParsed:j,price:w}=h,M=h.info,I=(0,_.Y)(y),[$,E]=(0,r.useState)(),F=(0,r.useRef)(!1),z=(0,r.useMemo)((function(){if(v.name.toLowerCase()===p.e.Babylon.toLowerCase())return function(e){return E(e)}}),[v.name]),L=(0,r.useMemo)((function(){if(v?.minStakeTerm)return(0,f.XG)(v.minStakeTerm)}),[v]),O=(0,C.B8)({accountId:n,networkId:x}),P=(0,l.A)(),N=(0,r.useCallback)((e=(0,a.A)((function*(e){var t;yield O({amount:e,symbol:M.symbol.toUpperCase(),provider:v.name,stakingInfo:{label:g.D.Stake,protocol:v.name,protocolLogoURI:v.logoURI,send:{token:M,amount:e},tags:[I]},term:L,feeRate:Number($)>0?Number($):void 0,onSuccess:(t=(0,a.A)((function*(t){P.pop(),m.U.staking.page.staking({token:M,stakingProtocol:v.name});var a=t[0];a&&v.name.toLowerCase()===p.e.Babylon.toLowerCase()&&(yield o.A.serviceStaking.addBabylonTrackingItem({txId:a.decodedTx.txid,action:"stake",createAt:Date.now(),accountId:n,networkId:x,amount:e,minStakeTerm:v.minStakeTerm})),k?.()})),function onSuccess(e){return t.apply(this,arguments)})})})),function(t){return e.apply(this,arguments)}),[O,P,M,v,I,k,L,n,x,$]),V=(0,i.A)(),R=(0,A.Z)(v.name),B=(0,r.useMemo)((function(){return!(!v||v.name!==p.e.Babylon.toLowerCase())&&v.stakeDisable}),[v]),D=(0,r.useMemo)((function(){return v.name.toLowerCase()===p.e.Lido.toLowerCase()}),[v]),{result:U}=(0,u.yk)((0,a.A)((function*(){return yield o.A.serviceStaking.estimateFee({networkId:x,provider:v.name,symbol:M.symbol,action:"stake",amount:"1"})})),[x,v.name,M.symbol]),{result:X}=(0,u.yk)((0,a.A)((function*(){if(b.Ay.isBTCNetwork(x)){var e=(yield o.A.serviceAccount.getAccount({accountId:n,networkId:x})).address,t=yield o.A.serviceGas.estimateFee({accountId:n,networkId:x,accountAddress:e});return t.feeUTXO?.filter((function(e){return void 0!==e.feeRate}))}})),[n,x]);return(0,r.useEffect)((function(){if(X&&3===X.length&&!F.current){var[,e]=X;E(e.feeRate),F.current=!0}}),[X]),(0,S.jsxs)(s.Page,{scrollEnabled:!0,children:[(0,S.jsx)(s.Page.Header,{title:V.formatMessage({id:d.ETranslations.earn_stake_token},{token:M.symbol})}),(0,S.jsx)(s.Page.Body,{children:(0,S.jsx)(UniversalStake,{decimals:y.token.info.decimals,details:y,apr:Number(v.apr)>0?v.apr:void 0,price:w,balance:j,minAmount:v.minStakeAmount,maxAmount:v.maxStakeAmount,minStakeTerm:v.minStakeTerm,minStakeBlocks:v.minStakeBlocks,tokenImageUri:M.logoURI,tokenSymbol:M.symbol,providerLogo:v.logoURI,providerName:v.name,providerLabel:R,isReachBabylonCap:B,isDisabled:B,showEstReceive:D,estReceiveToken:T,estReceiveTokenRate:v.lidoStTokenRate,onConfirm:N,minTransactionFee:v.minTransactionFee,estimateFeeResp:U,estimateFeeUTXO:X,onFeeRateChange:z})})]})}},905817:(e,t,n)=>{n.d(t,{FZ:()=>countDecimalPlaces,Y:()=>buildLocalTxStatusSyncId,c:()=>capitalizeString});var a=n(241440),buildLocalTxStatusSyncId=function(e){return`${e.provider.name.toLowerCase()}-${e.token.info.symbol.toLowerCase()}`};function capitalizeString(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function countDecimalPlaces(e){var t="string"==typeof e?Number(e):e;if(Number.isNaN(t))return 0;var n="string"==typeof e?e:(0,a.A)(e).toFixed(),r=n.indexOf(".");return-1===r?0:n.length-r-1}}}]);